---
phase: 15-production-operations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/08-module-8/10-binlog-lag-monitoring.mdx
  - labs/monitoring/grafana/dashboards/debezium-mysql.json
autonomous: true

must_haves:
  truths:
    - "Learner can explain JMX metrics for MySQL binlog lag (MilliSecondsBehindSource, SecondsBehindMaster)"
    - "Learner understands AuroraBinlogReplicaLag CloudWatch metric and when to use it"
    - "Learner can configure Prometheus alert rules for lag thresholds"
    - "Learner can use Grafana dashboard to visualize MySQL CDC health"
  artifacts:
    - path: "src/content/course/08-module-8/10-binlog-lag-monitoring.mdx"
      provides: "Binlog lag monitoring lesson with JMX and CloudWatch coverage"
      min_lines: 400
      contains: ["MilliSecondsBehindSource", "AuroraBinlogReplicaLag", "prometheus"]
    - path: "labs/monitoring/grafana/dashboards/debezium-mysql.json"
      provides: "MySQL-specific Grafana dashboard panels"
      contains: ["BinlogPosition", "IsGtidModeEnabled"]
  key_links:
    - from: "10-binlog-lag-monitoring.mdx"
      to: "labs/monitoring/prometheus.yml"
      via: "references existing prometheus scrape config"
      pattern: "connect:9404"
    - from: "debezium-mysql.json"
      to: "prometheus"
      via: "datasource queries"
      pattern: "debezium_metrics"
---

<objective>
Create binlog lag monitoring lesson covering JMX metrics, Aurora CloudWatch metrics, Prometheus alert configuration, and MySQL-specific Grafana dashboard

Purpose: Enable learners to monitor MySQL CDC health in production with real-time lag detection and alerting
Output: Lesson 10 in Module 8 + MySQL-specific Grafana dashboard
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-production-operations/15-RESEARCH.md

# Prior phase context
@.planning/phases/14-aurora-mysql-specifics/14-03-SUMMARY.md

# Existing infrastructure
@labs/docker-compose.yml
@labs/monitoring/prometheus.yml
@labs/monitoring/grafana/dashboards/debezium-production.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create binlog lag monitoring lesson</name>
  <files>src/content/course/08-module-8/10-binlog-lag-monitoring.mdx</files>
  <action>
Create comprehensive lesson on MySQL binlog lag monitoring with the following sections:

1. **Introduction** - Why lag monitoring is critical for MySQL CDC (data freshness, replication health)

2. **Three-Tier Monitoring Architecture** (Mermaid diagram)
   - Tier 1: JMX metrics (connector health - MilliSecondsBehindSource, SecondsBehindMaster, BinlogPosition, IsGtidModeEnabled)
   - Tier 2: CloudWatch metrics (Aurora infrastructure - AuroraBinlogReplicaLag)
   - Tier 3: Operational signals (heartbeat events, signal table)

3. **JMX Metrics Deep Dive**
   - `MilliSecondsBehindSource` vs `SecondsBehindMaster` - explain difference (Debezium-calculated vs MySQL SHOW SLAVE STATUS)
   - `BinlogPosition` and `BinlogFilename` for position tracking
   - `IsGtidModeEnabled` for GTID status
   - `Connected` for connection health
   - `QueueRemainingCapacity` for backpressure detection
   - `SecondsSinceLastEvent` for idle detection

4. **Aurora CloudWatch Metrics**
   - `AuroraBinlogReplicaLag` - cross-region replication lag (seconds)
   - When to use CloudWatch vs JMX (infrastructure vs connector level)
   - Reference Enhanced Binlog metrics from Phase 14 (ChangeLogBytesUsed, ChangeLogReadIOPs)

5. **Prometheus Alert Rules** (code examples from 15-RESEARCH.md)
   - DebeziumHighBinlogLag (>60s for 5m)
   - DebeziumConnectorDisconnected (Connected==0 for 2m)
   - DebeziumNoRecentEvents (SecondsSinceLastEvent >60 for 2m)
   - Aurora-specific: AuroraBinlogLagHigh (>300s for 5m)
   - Include grace period explanation for failover scenarios

6. **Grafana Dashboard Configuration**
   - Dashboard panels overview (what to visualize)
   - PromQL queries for MySQL-specific metrics
   - Reference official Debezium MySQL dashboard (ID 11523)

7. **Common Monitoring Pitfalls** (from 15-RESEARCH.md Pitfall 1, 6)
   - SecondsBehindMaster returning -1 during failover (not an error)
   - Heartbeat interval too high for idle table detection
   - Single-layer monitoring (missing infrastructure-level issues)

8. **Hands-on Exercises**
   - Configure Prometheus alert for 30-second lag threshold
   - Query JMX metrics via curl to connect:9404
   - Create CloudWatch alarm for AuroraBinlogReplicaLag (AWS Console walkthrough)

Use callout components:
- type="warning": SecondsBehindMaster=-1 during failover is normal
- type="tip": MilliSecondsBehindSource preferred over SecondsBehindMaster
- type="warning": Heartbeat interval must be <60s for reliable idle detection

Include Mermaid diagram for three-tier architecture.
Include table comparing JMX vs CloudWatch metrics (when to use each).

Follow established patterns:
- Russian text / English code
- Pedagogical structure matching prior Module 8 lessons
- Use Callout component from src/components/Callout.astro
  </action>
  <verify>
Build passes: `cd /Users/levoely/debezium\ course && npm run build`
File exists with min 400 lines
Contains MilliSecondsBehindSource, AuroraBinlogReplicaLag, prometheus keywords
  </verify>
  <done>
Lesson 10 created with complete binlog lag monitoring coverage including JMX metrics, CloudWatch metrics, Prometheus alerts, and Grafana dashboard guidance
  </done>
</task>

<task type="auto">
  <name>Task 2: Create MySQL-specific Grafana dashboard</name>
  <files>labs/monitoring/grafana/dashboards/debezium-mysql.json</files>
  <action>
Create Grafana dashboard JSON for MySQL CDC monitoring with the following panels:

1. **Row 1: Connection Health**
   - Connected status (gauge: 0/1)
   - GTID Mode Enabled (gauge: 0/1)
   - Seconds Since Last Event (stat with threshold coloring)

2. **Row 2: Lag Metrics**
   - MilliSecondsBehindSource (time series graph)
   - SecondsBehindMaster (time series graph with annotation for -1 values)
   - Queue Remaining Capacity (gauge with % fill)

3. **Row 3: Position Tracking**
   - Binlog Position (stat - current position)
   - Binlog Filename (text panel showing current file)
   - Events Processed (counter with rate)

4. **Row 4: Snapshot Status**
   - Snapshot Running (gauge 0/1)
   - Snapshot Completed (gauge 0/1)
   - Snapshot Progress (if available)

Dashboard settings:
- Title: "Debezium MySQL Connector"
- Datasource: prometheus (match existing debezium-production.json pattern)
- Refresh: 10s
- Time range: Last 1 hour default
- Tags: ["debezium", "mysql", "cdc"]

Use PromQL queries matching JMX exporter metric naming:
- debezium_metrics_MilliSecondsBehindSource{context="streaming"}
- debezium_metrics_SecondsBehindMaster{context="streaming"}
- debezium_metrics_Connected{context="streaming"}
- debezium_metrics_BinlogPosition{context="streaming"}
- debezium_metrics_IsGtidModeEnabled{context="streaming"}
- debezium_metrics_QueueRemainingCapacity{context="streaming"}
- debezium_metrics_SecondsSinceLastEvent{context="streaming"}
- debezium_metrics_SnapshotRunning{context="snapshot"}

Follow dashboard JSON structure from existing debezium-production.json for consistency.
  </action>
  <verify>
JSON is valid: `cat labs/monitoring/grafana/dashboards/debezium-mysql.json | jq .`
Contains panels for all specified metrics
Datasource matches existing dashboards (prometheus)
  </verify>
  <done>
MySQL-specific Grafana dashboard created with connection health, lag metrics, position tracking, and snapshot status panels
  </done>
</task>

</tasks>

<verification>
1. Lesson file exists at correct path with proper frontmatter
2. Dashboard JSON is valid and loadable
3. Build passes without errors
4. Lesson references existing monitoring infrastructure (labs/monitoring/)
5. Dashboard uses consistent naming with existing dashboards
</verification>

<success_criteria>
- Lesson covers all three monitoring tiers (JMX, CloudWatch, operational)
- JMX metrics explained with use cases and interpretation
- Prometheus alert rules provided with copy-paste code
- Grafana dashboard is functional (valid JSON, correct datasource)
- Learner can set up monitoring after completing this lesson
</success_criteria>

<output>
After completion, create `.planning/phases/15-production-operations/15-01-SUMMARY.md`
</output>
