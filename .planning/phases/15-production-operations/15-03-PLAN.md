---
phase: 15-production-operations
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/08-module-8/12-incremental-snapshots.mdx
autonomous: true

must_haves:
  truths:
    - "Learner can create signal table with correct schema (id, type, data)"
    - "Learner can trigger incremental snapshot via SQL INSERT"
    - "Learner understands read-only incremental snapshots for Aurora replicas"
    - "Learner can monitor snapshot progress via JMX metrics"
  artifacts:
    - path: "src/content/course/08-module-8/12-incremental-snapshots.mdx"
      provides: "Incremental snapshot lesson with signal table operations"
      min_lines: 400
      contains: ["debezium_signal", "execute-snapshot", "signal.data.collection"]
  key_links:
    - from: "12-incremental-snapshots.mdx"
      to: "09-aurora-snapshot-modes.mdx"
      via: "references initial snapshot from Phase 14"
      pattern: "snapshot.mode"
    - from: "12-incremental-snapshots.mdx"
      to: "04-mysql-connector-configuration.mdx"
      via: "references connector configuration"
      pattern: "signal.data.collection"
---

<objective>
Create incremental snapshot lesson covering signal table setup, snapshot triggering, read-only snapshots for replicas, and progress monitoring

Purpose: Enable learners to perform on-demand data synchronization without connector restart
Output: Lesson 12 in Module 8 with complete signal table operations guide
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-production-operations/15-RESEARCH.md

# Prior lessons for cross-references
@src/content/course/08-module-8/09-aurora-snapshot-modes.mdx
@src/content/course/08-module-8/04-mysql-connector-configuration.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create incremental snapshots lesson</name>
  <files>src/content/course/08-module-8/12-incremental-snapshots.mdx</files>
  <action>
Create comprehensive lesson on MySQL incremental snapshots with signal table operations:

1. **Introduction** - When to use incremental snapshots
   - Adding new tables to capture list
   - Recovering from extended downtime
   - Re-syncing specific tables after data issues
   - Difference from initial snapshot (no connector restart, parallel with streaming)

2. **Initial vs Incremental Snapshot Comparison** (Mermaid diagram)
   - Initial: Full table scan, connector restart, all tables
   - Incremental: Chunk-based, no restart, specific tables, parallel with CDC
   - Use cases for each approach

3. **Signal Table Setup** (from 15-RESEARCH.md)
   - CREATE TABLE debezium_signal (id, type, data)
   - Column requirements (VARCHAR sizes, PRIMARY KEY mandatory)
   - GRANT permissions for debezium user
   - Common mistakes: missing PK, wrong column types, wrong schema

4. **Connector Configuration for Signaling**
   - signal.data.collection: "inventory.debezium_signal"
   - incremental.snapshot.chunk.size: 2048 (default, can increase for large tables)
   - Ensure signal table schema in database.include.list
   - Complete connector config example

5. **Triggering Incremental Snapshot** (code examples from research)
   - Basic snapshot: INSERT with execute-snapshot type
   - Multiple tables: JSON array in data-collections
   - Filtered snapshot: additional-conditions for WHERE clause
   - Stop snapshot: stop-snapshot type
   - UUID() for unique signal IDs

6. **Snapshot Progress Monitoring** (from 15-RESEARCH.md)
   - JMX metrics: SnapshotRunning, SnapshotCompleted
   - Connector logs: grep for snapshot messages
   - Prometheus queries for snapshot status
   - Grafana panel references (from Plan 01)

7. **Read-Only Incremental Snapshots** (for Aurora Replicas)
   - When needed: CDC from read replicas, strict read-only policies
   - Prerequisites: gtid_mode=ON, enforce_gtid_consistency=ON, replica_preserve_commit_order=ON
   - Kafka signal channel instead of database signal table
   - signal.kafka.topic configuration
   - Trigger via kafka-console-producer (from research)
   - Why regular snapshots fail on read-only (write access required)

8. **Common Signal Table Pitfalls** (from 15-RESEARCH.md Pitfall 2, 3, 5)
   - Signal table not in database.include.list -> signal not captured
   - Missing PRIMARY KEY -> silent failure
   - Binlog retention < snapshot duration -> snapshot fails midway
   - Read-only environment without GTID prerequisites -> falls back to write-based

9. **Binlog Retention for Large Table Snapshots**
   - Formula: snapshot_duration + safety_margin < binlog_retention
   - Estimate duration: (rows / chunk_size) * avg_chunk_time
   - Recommendation: 7 days (168 hours) for production
   - Monitor ChangeLogBytesUsed during snapshot

10. **Hands-on Exercises**
    - Create signal table in lab MySQL
    - Trigger incremental snapshot for inventory.products
    - Monitor progress via connector logs
    - Stop in-progress snapshot
    - (Advanced) Configure Kafka signal channel for read-only scenario

Use callout components:
- type="danger": Signal table MUST have PRIMARY KEY - missing PK causes silent failures
- type="warning": Ensure signal table schema in database.include.list
- type="tip": Use UUID() for signal IDs to guarantee uniqueness
- type="warning": Binlog retention must exceed snapshot duration for large tables

Include Mermaid diagrams:
- Initial vs incremental snapshot comparison
- Signal table processing flow (INSERT -> Debezium capture -> snapshot trigger)

Include decision table: Scenario -> Snapshot type -> Configuration

Reference prior lessons:
- 09-aurora-snapshot-modes.mdx for initial snapshot modes
- 04-mysql-connector-configuration.mdx for connector properties

Follow established patterns:
- Russian text / English code
- Pedagogical structure matching prior Module 8 lessons
  </action>
  <verify>
Build passes: `cd /Users/levoely/debezium\ course && npm run build`
File exists with min 400 lines
Contains debezium_signal, execute-snapshot, signal.data.collection keywords
References prior snapshot lesson (09-aurora-snapshot-modes)
  </verify>
  <done>
Lesson 12 created with complete incremental snapshot coverage including signal table setup, operations, read-only snapshots, and monitoring
  </done>
</task>

</tasks>

<verification>
1. Lesson file exists at correct path with proper frontmatter
2. Build passes without errors
3. Signal table DDL is exact match to Debezium requirements
4. Read-only snapshot section covers all GTID prerequisites
5. Pitfalls from research are addressed with prevention guidance
</verification>

<success_criteria>
- Signal table can be created from lesson code
- Incremental snapshot can be triggered using provided SQL
- Read-only snapshot configuration is complete
- Learner understands when to use incremental vs initial snapshot
- Binlog retention considerations are clear
</success_criteria>

<output>
After completion, create `.planning/phases/15-production-operations/15-03-SUMMARY.md`
</output>
