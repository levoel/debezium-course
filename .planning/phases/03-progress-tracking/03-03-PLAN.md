---
phase: 03-progress-tracking
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/CourseRoadmap.tsx
  - src/components/Navigation.tsx
autonomous: true

must_haves:
  truths:
    - "Completed lessons in roadmap show checkmark prefix and green color"
    - "Completed lessons in sidebar show checkmark indicator"
    - "Visual indicators update reactively when progress changes"
  artifacts:
    - path: "src/components/CourseRoadmap.tsx"
      provides: "Roadmap with completion indicators"
      contains: "$progress"
    - path: "src/components/Navigation.tsx"
      provides: "Navigation with completion checkmarks"
      contains: "$progress"
  key_links:
    - from: "src/components/CourseRoadmap.tsx"
      to: "src/stores/progress.ts"
      via: "useStore for reactive completion display"
      pattern: "useStore.*\\$progress"
    - from: "src/components/Navigation.tsx"
      to: "src/stores/progress.ts"
      via: "useStore for reactive checkmarks"
      pattern: "useStore.*\\$progress"
---

<objective>
Add progress indicators to existing CourseRoadmap and Navigation components.

Purpose: Provide visual feedback showing which lessons are complete - on roadmap (green nodes with checkmark) and sidebar (checkmarks).
Output: Updated CourseRoadmap.tsx and Navigation.tsx with reactive progress display.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-progress-tracking/03-RESEARCH.md

# Progress store (created in 03-01)
@src/stores/progress.ts

# Existing components to update
@src/components/CourseRoadmap.tsx
@src/components/Navigation.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update CourseRoadmap with completion indicators</name>
  <files>src/components/CourseRoadmap.tsx</files>
  <action>
Update src/components/CourseRoadmap.tsx to show progress:

1. Add imports at the top:
```typescript
import { useStore } from '@nanostores/react';
import { $progress } from '../stores/progress';
```

2. Modify generateFlowchartSyntax to accept completed array:
```typescript
function generateFlowchartSyntax(
  lessons: RoadmapLesson[],
  basePath: string = '',
  completedSlugs: string[] = []
): string {
```

3. In node definitions, prepend checkmark for completed:
```typescript
lessons.forEach((lesson, index) => {
  const isComplete = completedSlugs.includes(lesson.slug);
  const prefix = isComplete ? '✓ ' : '';
  const escapedTitle = (prefix + lesson.title).replace(/"/g, '#quot;');
  lines.push(`    N${index}["${escapedTitle}"]`);
});
```

4. In node styling, use green (#10b981) for completed, keep color rotation for incomplete:
```typescript
lessons.forEach((lesson, index) => {
  const isComplete = completedSlugs.includes(lesson.slug);
  // Green for completed, original color rotation for incomplete
  const color = isComplete ? '#10b981' : NODE_COLORS[index % NODE_COLORS.length];
  lines.push(`    style N${index} fill:${color},stroke:${color},color:#fff`);
});
```

5. In CourseRoadmap component, use progress store:
```typescript
export function CourseRoadmap({ lessons, basePath = '' }: CourseRoadmapProps) {
  const containerRef = useRef<HTMLDivElement>(null);
  const [svg, setSvg] = useState<string>('');
  const [error, setError] = useState<string>('');
  const progress = useStore($progress);  // Add this

  useEffect(() => {
    const renderRoadmap = async () => {
      // ... existing initialization code ...

      // Pass completed slugs to generator
      const chartSyntax = generateFlowchartSyntax(lessons, basePath, progress.completed);

      // ... rest of rendering ...
    };

    renderRoadmap();
  }, [lessons, basePath, progress.completed]); // Add progress.completed to deps

  // ... rest of component unchanged
}
```

Key decisions:
- Green (#10b981 - emerald-500) for completed nodes - matches success color
- Checkmark (✓) prepended to title - visible text indicator
- Reactive re-render when progress changes via useStore
- Completed nodes override color rotation (all green, not mixed)
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Check CourseRoadmap.tsx imports $progress and uses useStore.
  </verify>
  <done>CourseRoadmap shows green nodes with checkmarks for completed lessons, updates reactively.</done>
</task>

<task type="auto">
  <name>Task 2: Update Navigation with completion checkmarks</name>
  <files>src/components/Navigation.tsx</files>
  <action>
Update src/components/Navigation.tsx to show completion status:

1. Add import for progress store:
```typescript
import { $progress } from '../stores/progress';
```

2. In Navigation component, subscribe to progress:
```typescript
export function Navigation({ modules, currentPath, basePath = '' }: NavigationProps) {
  const $isOpen = useStore(isSidebarOpen);
  const progress = useStore($progress);  // Add this

  // ... rest of component
}
```

3. Update the lesson link rendering to show checkmark:
```typescript
{lessons.map((lesson) => {
  const href = `${basePath}/course/${lesson.slug}`;
  const isCurrentPage = currentPath.includes(lesson.slug);
  const isComplete = progress.completed.includes(lesson.slug);  // Add this

  return (
    <li key={lesson.slug}>
      <a
        href={href}
        onClick={handleLinkClick}
        aria-current={isCurrentPage ? 'page' : undefined}
        className={`
          block px-4 py-2 rounded-md text-sm transition-colors duration-150
          ${isCurrentPage
            ? 'bg-blue-600 text-white font-medium'
            : 'text-gray-300 hover:bg-gray-700 hover:text-white'
          }
        `}
      >
        <span className="flex items-center gap-2">
          {isComplete && (
            <svg className="w-4 h-4 text-green-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
            </svg>
          )}
          <span className="truncate">{lesson.title}</span>
        </span>
        <span className="text-xs text-gray-400 mt-0.5 block ml-6">
          {lesson.estimatedTime} мин
        </span>
      </a>
    </li>
  );
})}
```

Note: The time estimate moves to have `ml-6` left margin to align under title when checkmark is present.

Key decisions:
- Green checkmark icon (text-green-400) for completed
- Checkmark before title, not replacing it
- Icon uses flex-shrink-0 to prevent squishing
- Time estimate indented when checkmark present for alignment
  </action>
  <verify>
Run `npm run build` - should compile without errors.
Check Navigation.tsx imports $progress and shows checkmarks.
  </verify>
  <done>Navigation shows green checkmarks next to completed lessons, updates reactively.</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without TypeScript errors
2. CourseRoadmap.tsx:
   - Imports $progress from stores/progress
   - Uses useStore to subscribe to progress
   - Passes completed slugs to generateFlowchartSyntax
   - Shows green nodes for completed lessons
3. Navigation.tsx:
   - Imports $progress from stores/progress
   - Uses useStore to subscribe to progress
   - Shows checkmark icon for completed lessons
</verification>

<success_criteria>
- CourseRoadmap shows completed lessons with green color and checkmark prefix
- Navigation shows completed lessons with green checkmark icon
- Both components update reactively when progress changes (via nanostores)
- TypeScript compiles without errors
- Visual indicators are clearly visible (green stands out)
</success_criteria>

<output>
After completion, create `.planning/phases/03-progress-tracking/03-03-SUMMARY.md`
</output>
