---
phase: 33-module-6-diagram-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/diagrams/module6/AdvancedConsumerDiagrams.tsx
  - src/components/diagrams/module6/PandasIntegrationDiagrams.tsx
autonomous: true

must_haves:
  truths:
    - "Module 6 diagram audit complete (33-RESEARCH.md documents 26 diagrams across 7 lessons)"
    - "User can see interactive At-Least-Once vs Exactly-Once comparison diagram"
    - "User can see rebalancing sequence diagram"
    - "User can see CDC event structure diagram with clickable nested fields"
    - "All diagrams have Russian tooltips with data engineering explanations"
  artifacts:
    - path: "src/components/diagrams/module6/AdvancedConsumerDiagrams.tsx"
      provides: "2 diagrams for lesson 01 (at-least-once vs exactly-once, rebalancing)"
      exports: ["AtLeastOnceVsExactlyOnceDiagram", "RebalancingSequenceDiagram"]
    - path: "src/components/diagrams/module6/PandasIntegrationDiagrams.tsx"
      provides: "1 diagram for lesson 02 (CDC event structure)"
      exports: ["CdcEventStructureDiagram"]
  key_links:
    - from: "src/components/diagrams/module6/AdvancedConsumerDiagrams.tsx"
      to: "src/components/diagrams/primitives/*"
      via: "import FlowNode, Arrow, DiagramContainer, DiagramTooltip"
      pattern: "import.*from.*primitives"
    - from: "src/components/diagrams/module6/PandasIntegrationDiagrams.tsx"
      to: "src/components/diagrams/primitives/*"
      via: "import FlowNode, Arrow, DiagramContainer, DiagramTooltip"
      pattern: "import.*from.*primitives"
---

<objective>
Create interactive glass diagram components for Module 6 lessons 01-02 (Python Foundations).

Purpose: Replace 3 Mermaid diagrams in advanced Python consumer and Pandas integration lessons with interactive glass components, establishing Module 6 diagram patterns.

Output:
- AdvancedConsumerDiagrams.tsx with 2 diagrams
- PandasIntegrationDiagrams.tsx with 1 diagram
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-module-6-diagram-migration/33-RESEARCH.md

# Reference primitives
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx
@src/components/diagrams/primitives/SequenceDiagram.tsx

# Reference patterns from Module 5
@src/components/diagrams/module5/SmtOverviewDiagrams.tsx

# Source MDX files
@src/content/course/06-module-6/01-advanced-python-consumer.mdx
@src/content/course/06-module-6/02-pandas-integration.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AdvancedConsumerDiagrams.tsx</name>
  <files>src/components/diagrams/module6/AdvancedConsumerDiagrams.tsx</files>
  <action>
Create diagram component file with 2 diagrams:

**1. AtLeastOnceVsExactlyOnceDiagram** (side-by-side comparison)
- Left side: At-Least-Once flow (amber color)
  - Nodes: "Получить сообщение" -> "Обработать" -> "Commit offset" -> decision "Crash?"
  - Branches: "До commit" -> "Повторная обработка" (rose), "После commit" -> "OK" (emerald)
- Right side: Exactly-Once flow (emerald color, recommended)
  - Nodes: "Получить сообщение" -> "Begin Transaction" -> "Обработать" -> "Produce результат" -> "Commit offset в транзакции" -> "Commit Transaction" -> decision "Crash?"
  - Branches: "До commit" -> "Rollback всей транзакции" (rose), "После commit" -> "OK атомарно" (emerald)
- Tooltips explaining each step in Russian:
  - At-least-once: "Commit offset после обработки гарантирует, что сообщение не будет потеряно, но при crash до commit сообщение обработается повторно"
  - Exactly-once: "Транзакционный API обеспечивает атомарность: либо всё выполнилось (обработка + produce + offset commit), либо ничего"

**2. RebalancingSequenceDiagram** (using SequenceDiagram primitive)
- Actors: Consumer (service), Group Coordinator (service), Kafka (queue)
- Messages showing poll() -> processing -> poll() flow
- Visual indicators for max.poll.interval.ms timeout
- Show rebalance trigger when poll() not called in time
- Tooltips explaining:
  - "Consumer вызывает poll() для получения сообщений"
  - "Если poll() не вызван в течение max.poll.interval.ms, consumer считается мертвым"
  - "Group Coordinator запускает rebalancing и переназначает partitions"

Use pattern from SmtOverviewDiagrams.tsx for structure. Import from '../primitives/'. All tooltips in Russian. Use tabIndex={0} on clickable FlowNodes. Export both diagrams.
  </action>
  <verify>
- File exists at src/components/diagrams/module6/AdvancedConsumerDiagrams.tsx
- Exports AtLeastOnceVsExactlyOnceDiagram and RebalancingSequenceDiagram
- No TypeScript errors: `npx tsc --noEmit src/components/diagrams/module6/AdvancedConsumerDiagrams.tsx`
  </verify>
  <done>
Two diagram components created with Russian tooltips, side-by-side comparison for delivery semantics, and sequence diagram for rebalancing flow
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PandasIntegrationDiagrams.tsx</name>
  <files>src/components/diagrams/module6/PandasIntegrationDiagrams.tsx</files>
  <action>
Create diagram component file with 1 diagram:

**CdcEventStructureDiagram** (hierarchical tree structure)
- Top node: "CDC Event JSON" (app variant)
- Two main branches:
  - "schema" node (gray, not expanded - just show exists)
  - "payload" node (blue, main focus)
- From payload, show nested structure:
  - "before: {...}" (emerald) - tooltip: "Состояние строки ДО изменения. Null для INSERT операций."
  - "after: {...}" (emerald) - tooltip: "Состояние строки ПОСЛЕ изменения. Null для DELETE операций."
  - "op: 'c'|'u'|'d'|'r'" (rose) - tooltip: "Тип операции: c=create(INSERT), u=update, d=delete, r=snapshot read"
  - "ts_ms: 1738425600000" (amber) - tooltip: "Timestamp события в миллисекундах (epoch). Время транзакции в базе данных."
  - "source: {...}" (purple) - tooltip: "Метаданные источника: db, table, lsn, connector"
- From before/after, show nested fields:
  - "id, customer_id, total, ..."

Use nested DiagramContainers for visual hierarchy. Color-code nodes by type (payload=blue, operation=rose, fields=emerald, timestamp=amber, metadata=purple). Tooltips explain what each field contains and when it's present/null.

Pattern: Vertical tree layout with DiagramContainer groupings for each level.
  </action>
  <verify>
- File exists at src/components/diagrams/module6/PandasIntegrationDiagrams.tsx
- Exports CdcEventStructureDiagram
- No TypeScript errors: `npx tsc --noEmit src/components/diagrams/module6/PandasIntegrationDiagrams.tsx`
  </verify>
  <done>
CDC event structure diagram created showing hierarchical envelope format with color-coded fields and Russian tooltips explaining when each field is present/null
  </done>
</task>

</tasks>

<verification>
- Both component files exist in src/components/diagrams/module6/
- All 3 diagrams export correctly (2 from AdvancedConsumerDiagrams, 1 from PandasIntegrationDiagrams)
- TypeScript compiles without errors
- Diagrams use primitives from ../primitives/ (not creating new ones)
- All tooltips are in Russian
- Dev server renders diagrams without errors: `npm run dev` and visit test page
</verification>

<success_criteria>
- 3 diagram components created for Module 6 lessons 01-02
- Side-by-side comparison pattern established for Batch vs Stream concepts
- SequenceDiagram used for temporal flows (rebalancing)
- Hierarchical tree pattern established for nested structures (CDC event)
- All components follow Module 5 patterns (imports, structure, tooltip content)
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/33-module-6-diagram-migration/33-01-SUMMARY.md`
</output>
