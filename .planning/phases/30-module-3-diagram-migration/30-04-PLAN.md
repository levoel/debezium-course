---
phase: 30-module-3-diagram-migration
plan: 04
type: execute
wave: 2
depends_on: ["30-01", "30-02", "30-03"]
files_modified:
  - src/components/diagrams/module3/RecoveryDiagrams.tsx
  - src/components/diagrams/module3/MultiConnectorDiagrams.tsx
  - src/components/diagrams/module3/DdlToolsDiagrams.tsx
  - src/components/diagrams/module3/index.ts
  - src/content/course/03-module-3/01-binlog-architecture.mdx
  - src/content/course/03-module-3/02-gtid-mode-fundamentals.mdx
  - src/content/course/03-module-3/03-binlog-retention-heartbeat.mdx
  - src/content/course/03-module-3/04-mysql-connector-configuration.mdx
  - src/content/course/03-module-3/05-binlog-wal-comparison.mdx
  - src/content/course/03-module-3/06-schema-history-recovery.mdx
  - src/content/course/03-module-3/07-aurora-parameter-groups.mdx
  - src/content/course/03-module-3/08-enhanced-binlog-architecture.mdx
  - src/content/course/03-module-3/09-aurora-snapshot-modes.mdx
  - src/content/course/03-module-3/10-binlog-lag-monitoring.mdx
  - src/content/course/03-module-3/11-gtid-failover-procedures.mdx
  - src/content/course/03-module-3/12-incremental-snapshots.mdx
  - src/content/course/03-module-3/13-recovery-procedures.mdx
  - src/content/course/03-module-3/14-multi-connector-deployments.mdx
  - src/content/course/03-module-3/15-ddl-tools-integration.mdx
autonomous: true

must_haves:
  truths:
    - "User can see recovery procedure decision tree with color-coded paths"
    - "User can see multi-connector deployment architecture diagrams"
    - "User can see DDL tool integration flows (gh-ost, pt-osc)"
    - "All 14 Module 3 MDX files use glass components instead of Mermaid"
    - "No Mermaid imports remain in Module 3"
  artifacts:
    - path: "src/components/diagrams/module3/RecoveryDiagrams.tsx"
      provides: "Recovery procedure diagrams (2 diagrams from lesson 13)"
      exports: ["RecoveryDecisionTreeDiagram", "RecoveryFlowDiagram"]
    - path: "src/components/diagrams/module3/MultiConnectorDiagrams.tsx"
      provides: "Multi-connector deployment diagrams (2 diagrams from lesson 14)"
      exports: ["MultiConnectorArchitectureDiagram", "ServerIdRegistryDiagram"]
    - path: "src/components/diagrams/module3/DdlToolsDiagrams.tsx"
      provides: "DDL tool integration diagrams (4 diagrams from lesson 15)"
      exports: ["GhOstFlowDiagram", "PtOscFlowDiagram", "DdlToolComparisonDiagram", "GhostTableLifecycleDiagram"]
    - path: "src/components/diagrams/module3/index.ts"
      provides: "Barrel export for all module3 diagram components"
      contains: "export * from"
  key_links:
    - from: "src/content/course/03-module-3/*.mdx"
      to: "src/components/diagrams/module3"
      via: "import statements replacing Mermaid"
      pattern: "import.*from.*components/diagrams/module3"
---

<objective>
Create remaining glass diagram components for Module 3 lessons 13-15, create barrel export, and migrate all 14 MDX files to use glass components instead of Mermaid.

Purpose: Complete Module 3 diagram migration by creating final 8 diagrams and updating all MDX files to remove Mermaid dependency.
Output: 3 component files with 8 diagrams, 1 barrel export, 14 updated MDX files with zero Mermaid blocks.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-module-3-diagram-migration/30-RESEARCH.md

# Existing primitives to use
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx
@src/components/diagrams/primitives/SequenceDiagram.tsx

# Module 2 patterns for MDX migration
@src/content/course/02-module-2/01-logical-decoding-deep-dive.mdx

# Source MDX files with Mermaid to convert
@src/content/course/03-module-3/13-recovery-procedures.mdx
@src/content/course/03-module-3/14-multi-connector-deployments.mdx
@src/content/course/03-module-3/15-ddl-tools-integration.mdx

# Prior plan SUMMARYs for component references (will exist when this runs)
# 30-01 creates: BinlogArchitectureDiagrams, GtidDiagrams, BinlogRetentionDiagrams, ConnectorConfigDiagrams
# 30-02 creates: BinlogWalComparisonDiagrams, SchemaHistoryDiagrams, AuroraParameterDiagrams, EnhancedBinlogDiagrams
# 30-03 creates: AuroraSnapshotDiagrams, MonitoringDiagrams, GtidFailoverDiagrams, IncrementalSnapshotDiagrams
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RecoveryDiagrams, MultiConnectorDiagrams, DdlToolsDiagrams, and barrel export</name>
  <files>
    src/components/diagrams/module3/RecoveryDiagrams.tsx
    src/components/diagrams/module3/MultiConnectorDiagrams.tsx
    src/components/diagrams/module3/DdlToolsDiagrams.tsx
    src/components/diagrams/module3/index.ts
  </files>
  <action>
**RecoveryDiagrams.tsx** - 2 diagrams from lesson 13:

1. `RecoveryDecisionTreeDiagram`: Recovery decision tree
   - Root: "Issue type?" -> Branches: binlog position lost, schema history corrupt, offset mismatch
   - Color-coded paths for each recovery scenario
   - Terminal nodes with specific recovery actions
   - Tooltips explaining when each scenario occurs

2. `RecoveryFlowDiagram`: Step-by-step recovery flow
   - Detect issue -> Stop connector -> Diagnose cause -> Apply fix -> Verify -> Resume
   - Critical steps highlighted (stop connector, verify before resume)
   - Tooltip: "Всегда останавливайте коннектор перед исправлением"

**MultiConnectorDiagrams.tsx** - 2 diagrams from lesson 14:

1. `MultiConnectorArchitectureDiagram`: Multi-connector deployment
   - Multiple Debezium connectors -> Single MySQL -> Different topics
   - Show server_id allocation per connector
   - Tooltip: "Каждый коннектор требует уникальный server_id"

2. `ServerIdRegistryDiagram`: Server ID registry concept
   - Registry showing connector -> server_id mapping
   - Conflict detection when duplicate IDs
   - Tooltip explaining server_id range management

**DdlToolsDiagrams.tsx** - 4 diagrams from lesson 15:

1. `GhOstFlowDiagram`: gh-ost online schema change flow
   - Create ghost table -> Binlog streaming -> Copy data -> Cutover
   - Show Debezium seeing ghost table events
   - Tooltip: "gh-ost создает временную таблицу и копирует данные через binlog"

2. `PtOscFlowDiagram`: pt-online-schema-change flow
   - Create shadow table -> Triggers on original -> Copy chunks -> Swap tables
   - Show trigger-based approach
   - Tooltip: "pt-osc использует триггеры для синхронизации изменений"

3. `DdlToolComparisonDiagram`: Side-by-side comparison
   - gh-ost: Binlog-based (recommended emerald)
   - pt-osc: Trigger-based (amber caution for CDC)
   - Comparison table as diagram showing trade-offs

4. `GhostTableLifecycleDiagram`: Ghost table lifecycle
   - Create _tablename_gho -> Data migration -> Rename original -> Rename ghost -> Drop old
   - Timeline showing what Debezium observes at each stage

**index.ts** - Barrel export:
```typescript
// Lessons 01-04
export * from './BinlogArchitectureDiagrams';
export * from './GtidDiagrams';
export * from './BinlogRetentionDiagrams';
export * from './ConnectorConfigDiagrams';

// Lessons 05-08
export * from './BinlogWalComparisonDiagrams';
export * from './SchemaHistoryDiagrams';
export * from './AuroraParameterDiagrams';
export * from './EnhancedBinlogDiagrams';

// Lessons 09-12
export * from './AuroraSnapshotDiagrams';
export * from './MonitoringDiagrams';
export * from './GtidFailoverDiagrams';
export * from './IncrementalSnapshotDiagrams';

// Lessons 13-15
export * from './RecoveryDiagrams';
export * from './MultiConnectorDiagrams';
export * from './DdlToolsDiagrams';
```
  </action>
  <verify>
Files exist and TypeScript compiles without errors:
```bash
npx tsc --noEmit src/components/diagrams/module3/RecoveryDiagrams.tsx
npx tsc --noEmit src/components/diagrams/module3/MultiConnectorDiagrams.tsx
npx tsc --noEmit src/components/diagrams/module3/DdlToolsDiagrams.tsx
npx tsc --noEmit src/components/diagrams/module3/index.ts
```
  </verify>
  <done>
RecoveryDiagrams exports 2 functions, MultiConnectorDiagrams exports 2 functions, DdlToolsDiagrams exports 4 functions. Barrel export includes all 11 component files.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate all 14 MDX files from Mermaid to glass components</name>
  <files>
    src/content/course/03-module-3/01-binlog-architecture.mdx
    src/content/course/03-module-3/02-gtid-mode-fundamentals.mdx
    src/content/course/03-module-3/03-binlog-retention-heartbeat.mdx
    src/content/course/03-module-3/04-mysql-connector-configuration.mdx
    src/content/course/03-module-3/05-binlog-wal-comparison.mdx
    src/content/course/03-module-3/06-schema-history-recovery.mdx
    src/content/course/03-module-3/07-aurora-parameter-groups.mdx
    src/content/course/03-module-3/08-enhanced-binlog-architecture.mdx
    src/content/course/03-module-3/09-aurora-snapshot-modes.mdx
    src/content/course/03-module-3/10-binlog-lag-monitoring.mdx
    src/content/course/03-module-3/11-gtid-failover-procedures.mdx
    src/content/course/03-module-3/12-incremental-snapshots.mdx
    src/content/course/03-module-3/13-recovery-procedures.mdx
    src/content/course/03-module-3/14-multi-connector-deployments.mdx
    src/content/course/03-module-3/15-ddl-tools-integration.mdx
  </files>
  <action>
For each MDX file:

1. **Remove** Mermaid import line:
   ```diff
   - import { Mermaid } from '../../../components/Mermaid.tsx';
   ```

2. **Add** glass component imports (use specific imports, not barrel):
   ```typescript
   import { DiagramName1, DiagramName2 } from '../../../components/diagrams/module3/ComponentFile';
   ```

3. **Replace** each `<Mermaid chart={...} />` block with the corresponding glass component:
   ```diff
   - <Mermaid chart={`
   - flowchart TB
   -     ...
   - `} client:visible />
   + <DiagramName client:visible />
   ```

**Import path pattern:** `../../../components/diagrams/module3/ComponentFile` (3 levels up from MDX)

**Mapping by lesson:**

Lesson 01 (binlog-architecture.mdx):
- BinlogVsWalDiagram, RowFormatDiagram, BinlogEventSequenceDiagram, BinlogRotationDiagram
- from BinlogArchitectureDiagrams

Lesson 02 (gtid-mode-fundamentals.mdx):
- GtidAnatomyDiagram, GtidReplicationDiagram, GtidFailoverComparisonDiagram
- from GtidDiagrams

Lesson 03 (binlog-retention-heartbeat.mdx):
- BinlogRetentionFlowDiagram, HeartbeatMonitoringDiagram, RetentionConfigDiagram
- from BinlogRetentionDiagrams

Lesson 04 (mysql-connector-configuration.mdx):
- MysqlConnectorDataFlowDiagram
- from ConnectorConfigDiagrams

Lesson 05 (binlog-wal-comparison.mdx):
- DetailedArchitectureComparisonDiagram, EventFormatComparisonDiagram, ReplicationModesDiagram, SlotVsBinlogDiagram, CdcReadinessDiagram
- from BinlogWalComparisonDiagrams

Lesson 06 (schema-history-recovery.mdx):
- SchemaHistoryFlowDiagram, SchemaRecoveryPathsDiagram, SchemaHistoryCorruptionDiagram
- from SchemaHistoryDiagrams

Lesson 07 (aurora-parameter-groups.mdx):
- ParameterHierarchyDiagram, AuroraSetupProcessDiagram
- from AuroraParameterDiagrams

Lesson 08 (enhanced-binlog-architecture.mdx):
- EnhancedBinlogArchitectureDiagram, StorageTierDiagram, EnhancedVsStandardDiagram, RetentionComparisonDiagram
- from EnhancedBinlogDiagrams

Lesson 09 (aurora-snapshot-modes.mdx):
- SnapshotDecisionTreeDiagram, InitialSnapshotDiagram, SchemaOnlySnapshotDiagram, NeverSnapshotDiagram
- from AuroraSnapshotDiagrams

Lesson 10 (binlog-lag-monitoring.mdx):
- LagMetricsFlowDiagram, MonitoringArchitectureDiagram
- from MonitoringDiagrams

Lesson 11 (gtid-failover-procedures.mdx):
- FailoverWithoutGtidSequence, FailoverWithGtidSequence, FailoverDecisionDiagram, GtidSetComparisonDiagram, ReplicaPromotionDiagram, ConnectorReconfigurationDiagram, FailoverTimelineDiagram
- from GtidFailoverDiagrams

Lesson 12 (incremental-snapshots.mdx):
- IncrementalSnapshotFlowDiagram, ChunkProcessingDiagram, SignalTableDiagram
- from IncrementalSnapshotDiagrams

Lesson 13 (recovery-procedures.mdx):
- RecoveryDecisionTreeDiagram, RecoveryFlowDiagram
- from RecoveryDiagrams

Lesson 14 (multi-connector-deployments.mdx):
- MultiConnectorArchitectureDiagram, ServerIdRegistryDiagram
- from MultiConnectorDiagrams

Lesson 15 (ddl-tools-integration.mdx):
- GhOstFlowDiagram, PtOscFlowDiagram, DdlToolComparisonDiagram, GhostTableLifecycleDiagram
- from DdlToolsDiagrams

**Keep** `client:visible` directive on all component usages for Astro hydration.
  </action>
  <verify>
No Mermaid imports remain and build passes:
```bash
grep -r "import.*Mermaid" src/content/course/03-module-3/ || echo "No Mermaid imports found - SUCCESS"
npm run build
```
  </verify>
  <done>
All 14 MDX files updated. Zero Mermaid imports remain in Module 3. Build passes without errors.
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. All 11 component files exist in src/components/diagrams/module3/
2. Barrel export (index.ts) re-exports all components
3. Total of 49 diagrams available (11+14+16+8)
4. All 14 MDX files use glass components
5. Zero Mermaid code blocks remain in Module 3
6. `npm run build` completes successfully
</verification>

<success_criteria>
- 8 diagrams created matching research inventory for lessons 13-15
- Barrel export includes all 11 component files
- All 14 MDX files migrated from Mermaid to glass components
- Zero Mermaid imports remain in Module 3
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/30-module-3-diagram-migration/30-04-SUMMARY.md`
</output>
