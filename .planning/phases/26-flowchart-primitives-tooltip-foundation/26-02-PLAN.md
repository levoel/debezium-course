---
phase: 26-flowchart-primitives-tooltip-foundation
plan: 02
type: execute
wave: 2
depends_on: ["26-01"]
files_modified:
  - src/components/diagrams/primitives/DiagramContainer.tsx
  - src/components/diagrams/primitives/Tooltip.tsx
  - src/components/diagrams/primitives/types.ts
  - src/components/diagrams/primitives/index.ts
  - src/components/diagrams/DeploymentModes.tsx
autonomous: true

must_haves:
  truths:
    - "DiagramContainer wraps diagrams in glass card with title and optional description"
    - "User can click any FlowNode to reveal tooltip with explanation text"
    - "User can navigate between nodes using Tab key and activate tooltip with Enter/Space"
    - "Tooltips position correctly without overlapping target elements"
    - "Tooltip content uses glass styling matching design system"
  artifacts:
    - path: "src/components/diagrams/primitives/DiagramContainer.tsx"
      provides: "Glass wrapper for diagrams"
      exports: ["DiagramContainer", "DiagramContainerProps"]
    - path: "src/components/diagrams/primitives/Tooltip.tsx"
      provides: "Radix-based tooltip with glass styling"
      exports: ["DiagramTooltip", "DiagramTooltipProps"]
    - path: "src/components/diagrams/primitives/index.ts"
      provides: "Complete barrel exports"
      exports: ["FlowNode", "Arrow", "DiagramContainer", "DiagramTooltip"]
    - path: "src/components/diagrams/DeploymentModes.tsx"
      provides: "Updated POC using new primitives with tooltips"
      exports: ["DeploymentModesDiagram"]
  key_links:
    - from: "src/components/diagrams/primitives/Tooltip.tsx"
      to: "@radix-ui/react-tooltip"
      via: "import * as TooltipPrimitive from '@radix-ui/react-tooltip'"
      pattern: "import.*@radix-ui/react-tooltip"
    - from: "src/components/diagrams/primitives/Tooltip.tsx"
      to: "src/styles/global.css"
      via: "glass-panel CSS class"
      pattern: "glass-panel"
    - from: "src/components/diagrams/DeploymentModes.tsx"
      to: "src/components/diagrams/primitives/index.ts"
      via: "import from primitives"
      pattern: "import.*from.*primitives"
---

<objective>
Create DiagramContainer component and Radix-based Tooltip with glass styling. Integrate tooltips with FlowNode for click-to-open interaction with full keyboard accessibility. Update DeploymentModes POC to use new primitives.

Purpose: Complete the primitives library with container wrapper and interactive tooltip system. This enables all future diagrams to have consistent glass styling and accessible explanatory tooltips.

Output: DiagramContainer and DiagramTooltip components. DeploymentModes.tsx updated as reference implementation.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/STACK.md
@.planning/research/FEATURES.md

# Must reference Plan 01 outputs
@.planning/phases/26-flowchart-primitives-tooltip-foundation/26-01-SUMMARY.md

# Primitives from Plan 01
@src/components/diagrams/primitives/index.ts
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx

# Original POC to update
@src/components/diagrams/DeploymentModes.tsx

# Glass design system
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DiagramContainer component</name>
  <files>
    - src/components/diagrams/primitives/DiagramContainer.tsx
    - src/components/diagrams/primitives/types.ts
    - src/components/diagrams/primitives/index.ts
  </files>
  <action>
1. Add DiagramContainerProps to `types.ts`:
   ```typescript
   export type ContainerColor = 'emerald' | 'blue' | 'rose' | 'amber' | 'purple' | 'neutral';

   export interface DiagramContainerProps {
     title: string;
     description?: string;
     color?: ContainerColor;
     recommended?: boolean;
     children: React.ReactNode;
     className?: string;
   }
   ```

2. Create `DiagramContainer.tsx` based on ModeCard from POC:
   - Apply glass-panel-elevated styling from global.css
   - Support 6 color variants with gradient backgrounds:
     ```typescript
     const colorStyles: Record<ContainerColor, string> = {
       emerald: 'border-emerald-500/30 from-emerald-500/10 to-transparent',
       blue: 'border-blue-500/30 from-blue-500/10 to-transparent',
       rose: 'border-rose-500/30 from-rose-500/10 to-transparent',
       amber: 'border-amber-500/30 from-amber-500/10 to-transparent',
       purple: 'border-purple-500/30 from-purple-500/10 to-transparent',
       neutral: 'border-gray-500/30 from-gray-500/10 to-transparent',
     };
     ```
   - Display title as pill badge with color variant
   - Show optional "Recommended" badge when `recommended={true}`
   - Support optional description below title
   - Default color is 'neutral'

3. Use semantic HTML:
   - `<figure>` wrapper with `role="figure"`
   - `<figcaption>` for title
   - `aria-label` describing the diagram

4. Update `index.ts` to export DiagramContainer.
  </action>
  <verify>
    - `src/components/diagrams/primitives/DiagramContainer.tsx` exists
    - Component exports DiagramContainer and DiagramContainerProps
    - All 6 color variants have distinct styling
    - Title displays as pill badge
    - Recommended badge shows when prop is true
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>DiagramContainer wraps diagrams in glass card with title pill badge, optional description, and optional recommended badge.</done>
</task>

<task type="auto">
  <name>Task 2: Create DiagramTooltip component with Radix integration</name>
  <files>
    - src/components/diagrams/primitives/Tooltip.tsx
    - src/components/diagrams/primitives/types.ts
    - src/components/diagrams/primitives/index.ts
  </files>
  <action>
1. Add DiagramTooltipProps to `types.ts`:
   ```typescript
   export interface DiagramTooltipProps {
     content: React.ReactNode;
     children: React.ReactNode;
     side?: 'top' | 'right' | 'bottom' | 'left';
     sideOffset?: number;
     delayDuration?: number;
     open?: boolean;
     onOpenChange?: (open: boolean) => void;
   }
   ```

2. Create `Tooltip.tsx` using Radix UI Tooltip primitives:
   ```typescript
   import * as TooltipPrimitive from '@radix-ui/react-tooltip';
   ```

3. Implement click-to-open pattern (TOOL-02):
   - Use controlled state with `open` and `onOpenChange` props
   - Do NOT rely on hover-only (inaccessible on mobile)
   - Set `delayDuration={0}` by default for immediate response to clicks
   - Allow hover to show preview but click to lock open

4. Style TooltipContent with glass design:
   ```typescript
   <TooltipPrimitive.Content
     className={`
       glass-panel px-4 py-3 max-w-xs
       text-sm text-gray-200 leading-relaxed
       z-50
       animate-in fade-in-0 zoom-in-95
       data-[state=closed]:animate-out
       data-[state=closed]:fade-out-0
       data-[state=closed]:zoom-out-95
     `}
     sideOffset={sideOffset ?? 8}
     side={side ?? 'top'}
   >
   ```

5. Add TooltipArrow with glass border:
   ```typescript
   <TooltipPrimitive.Arrow className="fill-white/10" />
   ```

6. Wrap in TooltipProvider at component level for consistent behavior.

7. Handle keyboard accessibility (TOOL-03):
   - Radix handles Enter/Space to toggle automatically when trigger is button
   - Radix handles Escape to close
   - Ensure trigger element is focusable (FlowNode already has tabIndex)

8. Tooltip positioning (TOOL-04):
   - Use Radix `side` prop for positioning preference
   - Radix auto-flips when tooltip would overflow viewport
   - Set `collisionPadding={8}` to keep away from screen edges

9. Update `index.ts` to export DiagramTooltip.
  </action>
  <verify>
    - `src/components/diagrams/primitives/Tooltip.tsx` exists
    - Component exports DiagramTooltip and DiagramTooltipProps
    - Radix UI Tooltip primitives imported correctly
    - Glass styling applied via glass-panel class
    - Animation classes present (animate-in, fade-in, zoom-in)
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>DiagramTooltip provides click-to-open tooltips with glass styling, keyboard accessibility, and smart positioning.</done>
</task>

<task type="auto">
  <name>Task 3: Update DeploymentModes.tsx to use new primitives with tooltips</name>
  <files>
    - src/components/diagrams/DeploymentModes.tsx
  </files>
  <action>
1. Replace inline FlowNode, Arrow, ModeCard with imports from primitives:
   ```typescript
   import { FlowNode, Arrow, DiagramContainer, DiagramTooltip } from './primitives';
   ```

2. Update ModeCard usage to DiagramContainer:
   ```typescript
   // Before
   <ModeCard title="Kafka Connect" color="emerald" recommended>
   // After
   <DiagramContainer title="Kafka Connect" color="emerald" recommended>
   ```

3. Add tooltips to key nodes with Russian explanations:
   ```typescript
   <DiagramTooltip content="Исходная база данных с WAL/binlog для захвата изменений">
     <FlowNode variant="database">Database</FlowNode>
   </DiagramTooltip>
   ```

4. Add tooltip content for each node type:
   - Database: "Исходная база данных с WAL/binlog для захвата изменений"
   - Debezium Connector: "Считывает transaction log и преобразует изменения в события"
   - Kafka Connect Cluster: "Распределённый кластер для масштабируемой обработки коннекторов"
   - Kafka: "Message broker для хранения и передачи CDC событий"
   - Debezium Server: "Standalone сервер без зависимости от Kafka"
   - Cloud Sink: "Облачные сервисы для получения событий"
   - Your Java App: "Встроенный движок для кастомной обработки событий"
   - Any Target: "Произвольная система-получатель событий"

5. Remove old inline component definitions (FlowNode, Arrow, ModeCard).

6. Verify diagram renders identically to before (visual regression).
  </action>
  <verify>
    - DeploymentModes.tsx imports from './primitives'
    - No inline FlowNode, Arrow, ModeCard definitions remain
    - Tooltips render on node click
    - Keyboard navigation works (Tab through nodes, Enter to open tooltip, Escape to close)
    - `npm run build` succeeds
    - Visit page with DeploymentModes component, verify visual rendering matches before
  </verify>
  <done>DeploymentModes.tsx updated to use primitives library. Each node has tooltip with Russian explanation. Serves as reference implementation for future diagrams.</done>
</task>

</tasks>

<verification>
1. Component verification:
   ```
   src/components/diagrams/primitives/
     index.ts             # Exports all 4 components
     types.ts             # All interfaces defined
     FlowNode.tsx         # From Plan 01
     Arrow.tsx            # From Plan 01
     DiagramContainer.tsx # New in this plan
     Tooltip.tsx          # New in this plan
   ```

2. Import verification:
   ```typescript
   import { FlowNode, Arrow, DiagramContainer, DiagramTooltip } from './primitives';
   ```
   All exports resolve without errors.

3. Accessibility verification:
   - Tab key navigates between FlowNodes
   - Enter/Space opens tooltip on focused node
   - Escape key closes tooltip
   - Tooltip content accessible to screen readers

4. Visual verification:
   - Open DeploymentModes diagram in browser
   - Click each node variant, tooltip appears with glass styling
   - Tooltip does not overlap the clicked node
   - Mobile: tap works same as click

5. Build verification:
   - `npm run build` succeeds
</verification>

<success_criteria>
1. DiagramContainer component wraps diagrams in glass card with title, description, and recommended badge
2. DiagramTooltip integrates Radix UI with glass styling matching design system
3. Click-to-open pattern works (not hover-only) for mobile accessibility
4. Keyboard navigation works: Tab between nodes, Enter/Space to open, Escape to close
5. Tooltips position correctly without overlapping target elements
6. DeploymentModes.tsx updated to use primitives as reference implementation
7. All nodes in DeploymentModes have Russian tooltip explanations
8. Build passes successfully
</success_criteria>

<output>
After completion, create `.planning/phases/26-flowchart-primitives-tooltip-foundation/26-02-SUMMARY.md`
</output>
