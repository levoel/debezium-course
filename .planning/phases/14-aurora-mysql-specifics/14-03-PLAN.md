---
phase: 14-aurora-mysql-specifics
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/08-module-8/09-aurora-snapshot-modes.mdx
autonomous: true

must_haves:
  truths:
    - "Learner knows Aurora MySQL prohibits FLUSH TABLES WITH READ LOCK"
    - "Learner can choose appropriate snapshot.locking.mode for Aurora based on table size"
    - "Learner understands snapshot.locking.mode=none risks (schema change during snapshot)"
    - "Learner knows backup-based initial load strategy for very large tables"
  artifacts:
    - path: "src/content/course/08-module-8/09-aurora-snapshot-modes.mdx"
      provides: "Aurora MySQL snapshot modes selection lesson"
      min_lines: 400
      contains: ["snapshot.locking.mode", "FLUSH TABLES WITH READ LOCK", "backup-based"]
  key_links:
    - from: "09-aurora-snapshot-modes.mdx"
      to: "Phase 13 connector configuration (04)"
      via: "snapshot.mode property reference"
      pattern: "snapshot\\.mode"
---

<objective>
Create comprehensive Aurora MySQL snapshot mode selection lesson covering global lock prohibition, table-level locking strategies, and backup-based approaches for large tables.

Purpose: MYSQL-09 requires understanding Aurora's CDC limitations. This lesson teaches learners how to choose appropriate snapshot configuration based on table size and lock tolerance.

Output: `src/content/course/08-module-8/09-aurora-snapshot-modes.mdx` with complete Aurora snapshot strategy guide
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-aurora-mysql-specifics/14-RESEARCH.md
@src/content/course/08-module-8/04-mysql-connector-configuration.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Aurora snapshot modes selection lesson</name>
  <files>src/content/course/08-module-8/09-aurora-snapshot-modes.mdx</files>
  <action>
Create lesson file with frontmatter:
- title: "Aurora MySQL: Выбор Snapshot Mode для CDC"
- order: 9
- difficulty: intermediate
- estimatedTime: 25 minutes
- topics: aurora-mysql, debezium, snapshot, cdc, locks
- prerequisites: module-8/08-enhanced-binlog-architecture

Content structure (Russian text, English code):

1. **Introduction** - Why Aurora snapshot strategy differs
   - Aurora prohibits FLUSH TABLES WITH READ LOCK (global lock)
   - AWS managed service security model
   - Impact: Debezium cannot use its preferred global lock strategy
   - What this lesson covers: choosing right snapshot configuration

2. **Community MySQL vs Aurora: Lock Behavior** (comparison)
   - Community MySQL: FLUSH TABLES WITH READ LOCK → consistent snapshot across all tables
   - Aurora MySQL: Prohibited → Debezium falls back to table-level locks
   - Mermaid diagram showing difference in lock scope

3. **How Debezium Handles Aurora** (automatic fallback)
   - Detection: Connector tries FLUSH TABLES, gets access denied
   - Fallback: Uses LOCK TABLES <table> READ for each table
   - Schema read under table lock, data read under REPEATABLE READ transaction
   - Sequence diagram showing Aurora snapshot workflow

4. **snapshot.locking.mode Options** (detailed)
   - **minimal** (default, recommended for most cases):
     - Acquires table locks only during schema read phase
     - Data reading uses REPEATABLE READ transaction (no locks)
     - Lock duration: seconds to minutes depending on table complexity
   - **none** (zero locks):
     - No table locks at all
     - Relies entirely on REPEATABLE READ for consistency
     - Danger: Schema changes during snapshot cause inconsistency
   - **extended** (not applicable to Aurora):
     - Requires global lock, will fail on Aurora

5. **Decision Matrix: Choosing snapshot.locking.mode** (table)
   | Table Size | Lock Tolerance | Recommended Mode | Notes |
   | < 10 GB | Normal | minimal | Safe default, locks release quickly |
   | 10-100 GB | Normal | minimal | Monitor lock duration |
   | > 100 GB | Zero tolerance | none | Requires schema freeze |
   | Any | Cannot freeze schema | minimal | Accept brief locks |
   | Very large (500GB+) | Zero tolerance | Backup-based | See section 7 |

6. **Connector Configuration Examples**
   - Small/medium tables (minimal mode):
     ```json
     {
       "snapshot.mode": "initial",
       "snapshot.locking.mode": "minimal"
     }
     ```
   - Large tables, zero lock tolerance (none mode):
     ```json
     {
       "snapshot.mode": "initial",
       "snapshot.locking.mode": "none"
     }
     ```
     Warning callout: Only use with schema change freeze

7. **Backup-Based Initial Load Strategy** (advanced, for very large tables)
   - When to use: 500GB+ tables, zero lock tolerance, cannot freeze schema
   - Workflow:
     1. Capture binlog position (SHOW MASTER STATUS) BEFORE backup
     2. Create Aurora snapshot (aws rds create-db-cluster-snapshot)
     3. Restore to separate cluster for bulk data extraction
     4. Bulk load data via JDBC source connector or other mechanism
     5. Configure Debezium with snapshot.mode=never
     6. Connector resumes from saved binlog position
   - Warning: Schema history topic must be populated manually or via prior run
   - Code example showing full workflow

8. **Monitoring Snapshot Progress** (hands-on)
   - Connector logs: snapshot phases, table counts
   - SHOW PROCESSLIST: Check for Locked state
   - Lock duration alerts: When to investigate

9. **Troubleshooting Snapshot Issues** (table format)
   - "Access denied for FLUSH TABLES": Expected on Aurora, automatic fallback
   - "Lock wait timeout exceeded": Increase snapshot.query.timeout.ms
   - "Schema changed during snapshot": Use minimal mode or schema freeze
   - Snapshot taking too long: Consider backup-based approach

10. **Key Takeaways** (6-8 bullet points)

11. **What's Next** (preview production operations - monitoring, failover)

Use Mermaid for:
- Lock scope comparison (Community MySQL global vs Aurora table-level)
- Aurora snapshot workflow (Detect Aurora -> Table locks -> Schema read -> Unlock -> REPEATABLE READ -> Data read)
- Decision flowchart (Table size? -> Lock tolerance? -> Schema freeze possible? -> Recommended mode)

Use Callout components:
- type="danger" for snapshot.locking.mode=none schema change risk
- type="warning" for extended mode not working on Aurora
- type="tip" for monitoring commands
- type="note" for backup-based approach complexity
  </action>
  <verify>
```bash
# File exists with substantial content
wc -l src/content/course/08-module-8/09-aurora-snapshot-modes.mdx
# Expected: 400+ lines

# Contains locking mode configuration
grep -c "snapshot.locking.mode" src/content/course/08-module-8/09-aurora-snapshot-modes.mdx

# Contains global lock prohibition
grep -c "FLUSH TABLES WITH READ LOCK" src/content/course/08-module-8/09-aurora-snapshot-modes.mdx

# Contains backup-based approach
grep -c "backup-based" src/content/course/08-module-8/09-aurora-snapshot-modes.mdx
```
  </verify>
  <done>Lesson covers: Aurora lock prohibition, locking mode options, decision matrix, backup-based strategy, troubleshooting. Learner can choose appropriate snapshot mode for Aurora.</done>
</task>

</tasks>

<verification>
```bash
# Lesson file exists and has proper frontmatter
head -20 src/content/course/08-module-8/09-aurora-snapshot-modes.mdx | grep -E "^(title|order|difficulty):"

# Minimum content depth
wc -l src/content/course/08-module-8/09-aurora-snapshot-modes.mdx

# Build passes (Astro can process MDX)
cd /Users/levoely/debezium\ course && npm run build 2>&1 | tail -5
```
</verification>

<success_criteria>
- Lesson file exists at src/content/course/08-module-8/09-aurora-snapshot-modes.mdx
- Content is 400+ lines covering all sections
- Contains snapshot.locking.mode configuration options
- Contains FLUSH TABLES WITH READ LOCK prohibition explanation
- Contains backup-based initial load strategy
- Contains decision matrix for mode selection
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/14-aurora-mysql-specifics/14-03-SUMMARY.md`
</output>
