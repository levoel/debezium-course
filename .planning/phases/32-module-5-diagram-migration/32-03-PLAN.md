---
phase: 32-module-5-diagram-migration
plan: 03
type: execute
wave: 2
depends_on: ["32-01", "32-02"]
files_modified:
  - src/components/diagrams/module5/SchemaRegistryDiagrams.tsx
  - src/components/diagrams/module5/SchemaEvolutionDiagrams.tsx
  - src/components/diagrams/module5/index.ts
  - src/content/course/05-module-5/01-smt-overview.mdx
  - src/content/course/05-module-5/02-predicates-filtering.mdx
  - src/content/course/05-module-5/03-pii-masking.mdx
  - src/content/course/05-module-5/04-content-based-routing.mdx
  - src/content/course/05-module-5/05-outbox-pattern-theory.mdx
  - src/content/course/05-module-5/06-outbox-implementation.mdx
  - src/content/course/05-module-5/07-schema-registry-avro.mdx
  - src/content/course/05-module-5/08-schema-evolution.mdx
autonomous: true

must_haves:
  truths:
    - "Schema Registry integration diagram shows producer/consumer schema flow"
    - "Schema evolution compatibility diagram shows BACKWARD/FORWARD/FULL compatibility"
    - "All 8 MDX files import glass components from ../../../components/diagrams/module5"
    - "No Mermaid code blocks remain in any Module 5 MDX file"
    - "All diagrams render correctly in browser with working tooltips"
  artifacts:
    - path: "src/components/diagrams/module5/SchemaRegistryDiagrams.tsx"
      provides: "1 diagram component for lesson 07"
      exports: ["SchemaRegistryIntegrationDiagram"]
    - path: "src/components/diagrams/module5/SchemaEvolutionDiagrams.tsx"
      provides: "2 diagram components for lesson 08"
      exports: ["SchemaCompatibilityDiagram", "EvolutionDecisionTreeDiagram"]
    - path: "src/components/diagrams/module5/index.ts"
      provides: "Barrel export for all module5 diagrams"
      contains: "export * from"
  key_links:
    - from: "MDX files"
      to: "module5 components"
      via: "import statement"
      pattern: "import.*from ['\"]\\.\\.\/\\.\\.\/\\.\\.\/components\/diagrams\/module5['\"]"
    - from: "MDX files"
      to: "Astro hydration"
      via: "client:load directive"
      pattern: "client:load"
---

<objective>
Complete Module 5 diagram migration: create remaining diagram components (lessons 07-08), barrel export, and migrate all 8 MDX files to use glass components.

Purpose: Finalize Module 5 migration by creating Schema Registry/Evolution diagrams, creating the barrel export, and replacing all Mermaid diagrams with glass component imports. After this plan, Module 5 will have zero Mermaid code blocks.

Output:
- SchemaRegistryDiagrams.tsx with 1 diagram (Schema Registry integration)
- SchemaEvolutionDiagrams.tsx with 2 diagrams (compatibility matrix, evolution decision tree)
- index.ts barrel export for all 21 Module 5 diagrams
- 8 MDX files updated with glass component imports
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-module-5-diagram-migration/32-RESEARCH.md

# Prior plan summaries for component names
@.planning/phases/32-module-5-diagram-migration/32-01-SUMMARY.md
@.planning/phases/32-module-5-diagram-migration/32-02-SUMMARY.md

@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/module4/index.ts

@src/content/course/05-module-5/07-schema-registry-avro.mdx
@src/content/course/05-module-5/08-schema-evolution.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SchemaRegistryDiagrams.tsx and SchemaEvolutionDiagrams.tsx (3 diagrams)</name>
  <files>
    src/components/diagrams/module5/SchemaRegistryDiagrams.tsx
    src/components/diagrams/module5/SchemaEvolutionDiagrams.tsx
  </files>
  <action>
Create 2 component files for lessons 07-08:

**SchemaRegistryDiagrams.tsx (1 diagram):**

1. **SchemaRegistryIntegrationDiagram**:
   - Architecture showing: Debezium -> Avro Serializer -> Kafka -> Consumer -> Avro Deserializer
   - Schema Registry in center receiving schema from producer, providing schema to consumer
   - Arrows: "Register schema (POST /subjects)", "Get schema (GET /subjects/{id}/versions)"
   - FlowNodes: Debezium (connector variant), Schema Registry (service, purple), Kafka (queue variant), Consumer (app variant)
   - Tooltip explaining schema-id in message header vs full schema

**SchemaEvolutionDiagrams.tsx (2 diagrams):**

1. **SchemaCompatibilityDiagram**:
   - Grid/table visualization of compatibility types:
     - BACKWARD: New schema can read old data (emerald)
     - FORWARD: Old schema can read new data (blue)
     - FULL: Both directions (purple, recommended)
     - NONE: No compatibility check (rose, warning)
   - Use DiagramContainer with title "Schema Compatibility Types"
   - Each type as FlowNode with colored border

2. **EvolutionDecisionTreeDiagram**:
   - Decision tree for schema changes:
     - "Adding optional field?" -> BACKWARD compatible (emerald)
     - "Removing field?" -> FORWARD compatible (blue)
     - "Changing field type?" -> Breaking change (rose, needs migration)
   - Nested FlowNodes with flex layout
   - Tooltips explaining each scenario

Russian tooltips for:
- How Schema Registry reduces message size
- When to use each compatibility mode
- Safe vs breaking schema changes
  </action>
  <verify>
- `npm run build` completes without errors
- Both files exist with correct exports
- Schema compatibility uses color-coded types
  </verify>
  <done>
SchemaRegistryDiagrams.tsx exports SchemaRegistryIntegrationDiagram; SchemaEvolutionDiagrams.tsx exports SchemaCompatibilityDiagram, EvolutionDecisionTreeDiagram
  </done>
</task>

<task type="auto">
  <name>Task 2: Create index.ts barrel export</name>
  <files>src/components/diagrams/module5/index.ts</files>
  <action>
Create barrel export file following module4/index.ts pattern:

```typescript
/**
 * Module 5 Diagrams - Advanced Patterns: SMT (Single Message Transformations)
 *
 * Barrel export for all Module 5 diagram components.
 * Covers lessons 01-08: SMT Overview, Predicates, PII Masking, Content Routing,
 * Outbox Pattern, Outbox Implementation, Schema Registry, Schema Evolution.
 *
 * Total exports: 21 diagram components
 */

export * from './SmtOverviewDiagrams';
export * from './PredicateFilterDiagrams';
export * from './PiiMaskingDiagrams';
export * from './ContentRoutingDiagrams';
export * from './OutboxPatternDiagrams';
export * from './OutboxImplementationDiagrams';
export * from './SchemaRegistryDiagrams';
export * from './SchemaEvolutionDiagrams';
```

Ensure comment accurately lists lesson coverage and total export count (21 components).
  </action>
  <verify>
- File exists at src/components/diagrams/module5/index.ts
- All 8 component files are exported
- Import from module5 works: `import { SmtChainOrderDiagram } from './module5'`
  </verify>
  <done>
index.ts barrel export created with all 8 component file exports and accurate component count
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate all 8 MDX files to glass components</name>
  <files>
    src/content/course/05-module-5/01-smt-overview.mdx
    src/content/course/05-module-5/02-predicates-filtering.mdx
    src/content/course/05-module-5/03-pii-masking.mdx
    src/content/course/05-module-5/04-content-based-routing.mdx
    src/content/course/05-module-5/05-outbox-pattern-theory.mdx
    src/content/course/05-module-5/06-outbox-implementation.mdx
    src/content/course/05-module-5/07-schema-registry-avro.mdx
    src/content/course/05-module-5/08-schema-evolution.mdx
  </files>
  <action>
For each MDX file:

1. **Remove** the Mermaid import line:
   ```diff
   - import { Mermaid } from '../../../components/Mermaid.tsx';
   ```

2. **Add** the glass component import:
   ```typescript
   import { ComponentName1, ComponentName2 } from '../../../components/diagrams/module5';
   ```

3. **Replace** each `<Mermaid chart={...} client:visible />` block with the corresponding glass component:
   ```jsx
   <ComponentName client:load />
   ```

4. **Use `client:load`** (not client:visible) for immediate hydration.

5. **Wrap in not-prose div** if needed for full-width diagrams:
   ```jsx
   <div className="not-prose">
     <ComponentName client:load />
   </div>
   ```

**Mapping by lesson:**

**01-smt-overview.mdx** (5 Mermaid blocks):
- Line ~25 flowchart -> ConsumerComplexityDiagram
- Line ~48 flowchart -> SmtSolutionDiagram
- Line ~76 flowchart -> SmtExecutionModelDiagram
- Line ~242 flowchart -> SmtChainOrderDiagram
- Decision tree text -> SmtDecisionFrameworkDiagram (may need to find appropriate location)

**02-predicates-filtering.mdx** (3 Mermaid blocks):
- Line ~88 flowchart -> PredicateEvaluationDiagram
- Line ~289 flowchart -> PredicateCombinationDiagram
- Line ~445 flowchart -> FilterDecisionTreeDiagram

**03-pii-masking.mdx** (add diagrams if helpful):
- Add MaskFieldTransformDiagram and UnwrapComparisonDiagram at relevant sections
- Note: Original may have no Mermaid, diagrams are supplementary

**04-content-based-routing.mdx**:
- Replace routing diagrams with ContentBasedRouterDiagram, MultiTenantRoutingDiagram, RegionBasedRoutingDiagram

**05-outbox-pattern-theory.mdx** (4 Mermaid blocks):
- Line ~41 flowchart -> DualWriteProblemDiagram
- Line ~74 flowchart -> OutboxSolutionDiagram
- Line ~269 flowchart -> (at-least-once scenario, may use OutboxTransactionFlowDiagram)
- Line ~362 flowchart -> MicroservicesOutboxDiagram

**06-outbox-implementation.mdx** (1 Mermaid block or supplementary):
- Add OutboxEventRouterSmtDiagram at SMT configuration section

**07-schema-registry-avro.mdx** (1 diagram):
- Add SchemaRegistryIntegrationDiagram at architecture section

**08-schema-evolution.mdx** (2 diagrams):
- Add SchemaCompatibilityDiagram at compatibility types section
- Add EvolutionDecisionTreeDiagram at decision section

Preserve all existing prose content. Only replace/add diagram components.
  </action>
  <verify>
- `npm run build` completes without errors
- `grep -r "Mermaid" src/content/course/05-module-5/` returns no results
- Each MDX file has import from '../../../components/diagrams/module5'
- Each diagram component has client:load directive
  </verify>
  <done>
All 8 MDX files updated: Mermaid imports removed, glass component imports added, all diagrams use client:load hydration, zero Mermaid code blocks remain
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds with no errors
2. `npm run dev` starts and Module 5 pages render
3. `grep -r "Mermaid" src/content/course/05-module-5/` returns empty (no Mermaid)
4. All 8 lesson pages show interactive glass diagrams
5. Clicking diagram nodes shows Russian tooltips
6. Total 21 diagram components available from module5/index.ts
</verification>

<success_criteria>
- 2 new component files (SchemaRegistry, SchemaEvolution) with 3 diagrams
- index.ts barrel export created with all 8 component files
- All 8 MDX files migrated: Mermaid removed, glass components imported
- Zero Mermaid code blocks in Module 5
- All diagrams have client:load hydration directive
- Build passes without errors
- Pages render correctly with interactive tooltips
</success_criteria>

<output>
After completion, create `.planning/phases/32-module-5-diagram-migration/32-03-SUMMARY.md`
</output>
