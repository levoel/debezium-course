---
phase: 23-homepage-redesign-accordion-module-cards
plan: 02
type: execute
wave: 2
depends_on: [23-01]
files_modified:
  - src/pages/index.astro
autonomous: true

must_haves:
  truths:
    - "Homepage shows ModuleAccordion component instead of flat lesson list"
    - "All modules collapsed by default when page loads"
    - "Clicking module header expands lesson list"
    - "Glass effect visible on module cards (semi-transparent background)"
    - "Progress percentage visible per module"
  artifacts:
    - path: "src/pages/index.astro"
      provides: "Homepage with ModuleAccordion integration"
      contains: "ModuleAccordion"
  key_links:
    - from: "index.astro"
      to: "ModuleAccordion.tsx"
      via: "React island with client:load"
      pattern: "client:load"
---

<objective>
Integrate ModuleAccordion component into homepage, replacing flat lesson list

Purpose: Transform the homepage from a static list of all lessons to an interactive accordion where modules are collapsed by default and can be expanded to reveal lessons.

Output: Updated index.astro with ModuleAccordion as React island
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-homepage-redesign-accordion-module-cards/23-01-PLAN.md

# Current implementation
@src/pages/index.astro - Current homepage structure to modify
@src/components/ModuleAccordion.tsx - Component to integrate (from Plan 01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update index.astro to use ModuleAccordion</name>
  <files>src/pages/index.astro</files>
  <action>
Modify src/pages/index.astro to replace the current static module sections with the ModuleAccordion component:

1. **Update imports:**
```astro
---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { ProgressIndicator } from '../components/ProgressIndicator';
import { ProgressExport } from '../components/ProgressExport';
import { ModuleAccordion } from '../components/ModuleAccordion';
---
```

Remove imports no longer needed:
- Remove `getModuleName, getModuleNumber` from '../utils/moduleNames' (now handled inside ModuleAccordion)

2. **Keep data preparation logic:**
Keep the existing cleanSlug function, lesson fetching, sorting, and groupByModule function. These prepare data for ModuleAccordion.

3. **Convert module data to array format:**
After `const moduleGroups = groupByModule(sortedLessons);` add:
```javascript
// Convert to array format for React component (Maps not serializable)
const modulesArray = Array.from(moduleGroups.entries())
  .map(([moduleId, lessons]) => [
    moduleId,
    lessons.map(lesson => ({
      title: lesson.data.title,
      slug: cleanSlug(lesson.id),
      difficulty: lesson.data.difficulty,
      estimatedTime: lesson.data.estimatedTime,
    }))
  ]);
```

4. **Keep helper functions:**
Keep getDifficultyColor and translateDifficulty for potential future use, but they won't be used directly in the template anymore (moved to ModuleAccordion).

5. **Replace template section:**
Replace the entire `<div class="space-y-8 not-prose">` section (lines ~109-169) with:

```astro
<div class="space-y-4 not-prose">
  <ModuleAccordion
    modules={modulesArray}
    basePath={import.meta.env.BASE_URL}
    client:load
  />
</div>
```

Key changes:
- Remove the static module sections with `{moduleIds.map((moduleId) => {...})}`
- Add ModuleAccordion with client:load for interactivity
- Pass modules as array (ModuleEntry[] format matching component props)
- Pass basePath for URL construction

6. **Keep empty state:**
Keep the `{sortedLessons.length === 0 && (...)}` fallback for when no lessons exist.

7. **Update Progress Tracking Section styling (optional enhancement):**
Update the progress tracking section container to use glass styling:
```astro
<div class="glass-panel p-6 mb-8">
```
Instead of `bg-gray-800 border border-gray-700`

This creates visual consistency with the new glass module cards.
  </action>
  <verify>
1. Run `npm run build` - no errors
2. Run `npm run dev` and visit http://localhost:4321/debezium-course/
3. Verify:
   - All 8 modules visible as collapsed cards with glass effect
   - Each module shows progress percentage (likely 0% if no progress)
   - Click on module header expands to show lessons
   - Lessons have clickable links to lesson pages
   - Click on expanded module collapses it
  </verify>
  <done>
Homepage displays ModuleAccordion with:
- 8 module cards with glass effect
- All collapsed by default
- Progress percentage per module
- Click to expand/collapse
- Lesson links navigate correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Visual verification and polish</name>
  <files>src/pages/index.astro</files>
  <action>
Start dev server and verify visual appearance:

1. **Glass effect visibility:**
   - Module cards should show semi-transparent background
   - Cards should appear to float above gradient background
   - Hover on card should show subtle lift (translateY -2px)

2. **Accordion behavior:**
   - All modules collapsed initially
   - Click module header to expand
   - Chevron rotates 180deg when expanded
   - Smooth transition (max-height animation)
   - Click again to collapse

3. **Progress indicators:**
   - Each module shows percentage (0-100%)
   - Small progress bar under percentage
   - Updates live when lessons marked complete (test by navigating to lesson)

4. **Mobile responsive:**
   - Cards stack vertically on mobile
   - Touch targets large enough (min 44px)
   - Progress bar visible on mobile

5. **Keyboard accessibility:**
   - Tab through module headers
   - Enter/Space to toggle expand
   - Focus visible indicator on headers

If any issues found, make minimal adjustments to ModuleAccordion.tsx or index.astro styling.

Common adjustments that may be needed:
- Add `min-h-[44px]` to header button if touch target too small
- Adjust padding if layout looks cramped on mobile
- Add `focus:outline-none focus:ring-2 focus:ring-blue-500` to header button for focus visibility
  </action>
  <verify>
1. Visual inspection on desktop (1200px+) and mobile (375px)
2. Keyboard navigation test: Tab -> Enter -> Tab -> Enter cycle
3. Progress updates when lesson completed (mark lesson, return to homepage)
  </verify>
  <done>
Homepage accordion fully functional:
- Glass cards visible with hover effect
- All modules collapsed by default
- Expand/collapse works via click and keyboard
- Progress indicators update live
- Mobile responsive
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `npm run dev` shows homepage with accordion modules
3. All 8 modules display as collapsed glass cards
4. Click expands module to show lessons
5. Progress percentage visible per module
6. Keyboard navigation works (Tab + Enter)
</verification>

<success_criteria>
- Homepage displays all modules as collapsed accordion cards
- Glass effect visible on module cards (12-16px blur)
- Click on module header expands/collapses lesson list
- Progress indicator shows completion percentage per module
- Lessons are clickable and navigate to correct pages
- Mobile responsive
- Keyboard accessible (Enter/Space to toggle)
</success_criteria>

<output>
After completion, create `.planning/phases/23-homepage-redesign-accordion-module-cards/23-02-SUMMARY.md`
</output>
