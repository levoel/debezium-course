---
import BaseLayout from '../layouts/BaseLayout.astro';
import { GlossaryTerm } from '../components/GlossaryTerm';
import { TroubleshootingEntry } from '../components/TroubleshootingEntry';

const basePath = import.meta.env.BASE_URL;
---

<BaseLayout
  title="–ü—Ä–æ—Ç–æ—Ç–∏–ø: –ì–ª–æ—Å—Å–∞—Ä–∏–π –∏ Troubleshooting"
  description="–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤"
>
  <div class="prose prose-invert max-w-none">
    <h1 class="text-3xl font-bold text-gray-100 mb-2">
      –ü—Ä–æ—Ç–æ—Ç–∏–ø v1.7
    </h1>
    <p class="text-gray-400 mb-8">
      –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≥–ª–æ—Å—Å–∞—Ä–∏—è –∏ troubleshooting –±–∞–∑—ã
    </p>

    <!-- GLOSSARY SECTION -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold text-gray-100 mb-6 flex items-center gap-3">
        <span class="text-3xl">üìö</span>
        –ì–ª–æ—Å—Å–∞—Ä–∏–π
      </h2>

      <p class="text-gray-300 mb-6">
        –°–≤—è–∑–∞–Ω–Ω—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–µ—Ä–º–∏–Ω–æ–≤ CDC —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏, –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ —É—Ä–æ–∫–∏.
      </p>

      <GlossaryTerm
        term="WAL"
        termEn="Write-Ahead Log"
        definition="–ñ—É—Ä–Ω–∞–ª —É–ø—Ä–µ–∂–¥–∞—é—â–µ–π –∑–∞–ø–∏—Å–∏ ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º ACID-–≥–∞—Ä–∞–Ω—Ç–∏–π –≤ PostgreSQL. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ WAL, –∑–∞—Ç–µ–º –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –¥–∞–Ω–Ω—ã–º. Debezium —á–∏—Ç–∞–µ—Ç WAL —á–µ—Ä–µ–∑ –ª–æ–≥–∏—á–µ—Å–∫—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–µ–∑ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ production."
        example={`-- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ WAL
SELECT pg_current_wal_lsn();

-- –†–∞–∑–º–µ—Ä –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ WAL
SELECT pg_wal_lsn_diff(
  pg_current_wal_lsn(),
  confirmed_flush_lsn
) FROM pg_replication_slots
WHERE slot_name = 'debezium';`}
        relatedLessons={[
          { title: "CDC Fundamentals", slug: "01-module-1/01-cdc-fundamentals" },
          { title: "WAL Configuration", slug: "02-module-2/03-wal-configuration-tuning" },
          { title: "Replication Slots", slug: "02-module-2/02-replication-slots-lifecycle" }
        ]}
        basePath={basePath}
        client:load
      />

      <GlossaryTerm
        term="LSN"
        termEn="Log Sequence Number"
        definition="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏–∏ –≤ WAL. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ª–∞–≥–∞. –§–æ—Ä–º–∞—Ç: `16/3E8A0F00` –≥–¥–µ –ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å ‚Äî –Ω–æ–º–µ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞, –≤—Ç–æ—Ä–∞—è ‚Äî —Å–º–µ—â–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ —Å–µ–≥–º–µ–Ω—Ç–∞."
        example={`-- –¢–µ–∫—É—â–∏–π LSN
SELECT pg_current_wal_lsn();
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 0/16B9F08

-- LSN –≤ —á–∏—Å–ª–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –ª–∞–≥–∞)
SELECT pg_wal_lsn_diff('0/16B9F08', '0/16B9E00');
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 264 (–±–∞–π—Ç—ã)`}
        relatedLessons={[
          { title: "Lag Detection", slug: "04-module-4/04-lag-detection-alerting" }
        ]}
        basePath={basePath}
        client:load
      />

      <div class="mt-6 p-4 bg-white/5 rounded-xl border border-white/10">
        <p class="text-sm text-gray-400 m-0">
          <strong class="text-gray-300">–ò–¥–µ—è:</strong> –í —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –±—É–¥–µ—Ç ~20-30 —Ç–µ—Ä–º–∏–Ω–æ–≤ —Å –∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º –∏ –ø–æ–∏—Å–∫–æ–º. –ö–∞–∂–¥—ã–π —Ç–µ—Ä–º–∏–Ω –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è Pagefind –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —á–µ—Ä–µ–∑ Cmd+K.
        </p>
      </div>
    </section>

    <!-- TROUBLESHOOTING SECTION -->
    <section class="mb-12">
      <h2 class="text-2xl font-bold text-gray-100 mb-6 flex items-center gap-3">
        <span class="text-3xl">üîß</span>
        Troubleshooting
      </h2>

      <p class="text-gray-300 mb-6">
        –ë–∞–∑–∞ —Ç–∏–ø–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫ —Å —Å–∏–º–ø—Ç–æ–º–∞–º–∏, –ø—Ä–∏—á–∏–Ω–∞–º–∏ –∏ —Ä–µ—à–µ–Ω–∏—è–º–∏. Searchable —á–µ—Ä–µ–∑ Cmd+K.
      </p>

      <TroubleshootingEntry
        errorCode="PSQLException"
        errorMessage="FATAL: no pg_hba.conf entry for replication connection"
        connector="postgresql"
        category="connection"
        symptoms={[
          "Debezium –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ PostgreSQL",
          "–í –ª–æ–≥–∞—Ö –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏",
          "Connector status: FAILED"
        ]}
        cause="PostgreSQL –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –æ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞. –§–∞–π–ª pg_hba.conf –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –¥–æ–ª–∂–µ–Ω —è–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–∞—Ç—å replication connections."
        solution={[
          "–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `pg_hba.conf` (–æ–±—ã—á–Ω–æ `/var/lib/postgresql/data/pg_hba.conf`)",
          "–î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏: `host replication debezium 0.0.0.0/0 md5`",
          "–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: `SELECT pg_reload_conf();`",
          "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: `psql -h localhost -U debezium -d postgres -c 'IDENTIFY_SYSTEM' replication=database`"
        ]}
        relatedLessons={[
          { title: "Lab Setup", slug: "01-module-1/03-lab-setup" },
          { title: "First Connector", slug: "01-module-1/04-first-connector" }
        ]}
        basePath={basePath}
        client:load
      />

      <TroubleshootingEntry
        errorMessage="Replication slot 'debezium' is active"
        connector="postgresql"
        category="configuration"
        symptoms={[
          "–ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞",
          "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º",
          "PostgreSQL –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç active slot"
        ]}
        cause="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Å—Ç–∞–Ω—Å –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏–ª replication slot, –∏–ª–∏ slot —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º. PostgreSQL –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–∞–∂–¥–æ–º—É —Å–ª–æ—Ç—É."
        solution={[
          "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–ª–æ—Ç—ã: `SELECT * FROM pg_replication_slots;`",
          "–ï—Å–ª–∏ slot –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `active = true`, –Ω–∞–π–¥–∏—Ç–µ PID: `SELECT * FROM pg_stat_replication;`",
          "–¢–µ—Ä–º–∏–Ω–∏—Ä—É–π—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: `SELECT pg_terminate_backend(<pid>);`",
          "–ò–ª–∏ —É–¥–∞–ª–∏—Ç–µ —Å–ª–æ—Ç (–ø–æ—Ç–µ—Ä—è–µ—Ç–µ –ø–æ–∑–∏—Ü–∏—é!): `SELECT pg_drop_replication_slot('debezium');`"
        ]}
        relatedLessons={[
          { title: "Replication Slots Lifecycle", slug: "02-module-2/02-replication-slots-lifecycle" },
          { title: "Recovery Procedures", slug: "03-module-3/13-recovery-procedures" }
        ]}
        basePath={basePath}
        client:load
      />

      <TroubleshootingEntry
        errorCode="1236"
        errorMessage="Could not find first log file name in binary log index file"
        connector="mysql"
        category="snapshot"
        symptoms={[
          "MySQL –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –Ω–µ –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å snapshot",
          "–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞",
          "Binlog —Ñ–∞–π–ª—ã –±—ã–ª–∏ —Ä–æ—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–ª–∏ —É–¥–∞–ª–µ–Ω—ã"
        ]}
        cause="Debezium –ø—ã—Ç–∞–µ—Ç—Å—è —á–∏—Ç–∞—Ç—å binlog —Å –ø–æ–∑–∏—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑-–∑–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤. –≠—Ç–æ —á–∞—Å—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ downtime –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ –∏–ª–∏ –ø—Ä–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö `expire_logs_days`."
        solution={[
          "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ binlog —Ñ–∞–π–ª—ã: `SHOW BINARY LOGS;`",
          "–£–≤–µ–ª–∏—á—å—Ç–µ retention: `SET GLOBAL expire_logs_days = 7;`",
          "–ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä —Å `snapshot.mode=initial` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ä–µ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
          "–†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Heartbeat –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã"
        ]}
        relatedLessons={[
          { title: "Binlog Retention", slug: "03-module-3/03-binlog-retention-heartbeat" },
          { title: "Schema History Recovery", slug: "03-module-3/06-schema-history-recovery" }
        ]}
        basePath={basePath}
        client:load
      />

      <div class="mt-6 p-4 bg-white/5 rounded-xl border border-white/10">
        <p class="text-sm text-gray-400 m-0">
          <strong class="text-gray-300">–ò–¥–µ—è:</strong> –í —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏ –±—É–¥–µ—Ç ~15-20 –æ—à–∏–±–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—É –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –ö–∞–∂–¥–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è ‚Äî –º–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å –ø–æ —Ç–µ–∫—Å—Ç—É –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ Cmd+K.
        </p>
      </div>
    </section>

    <!-- DESIGN NOTES -->
    <section class="mb-8">
      <h2 class="text-2xl font-bold text-gray-100 mb-6 flex items-center gap-3">
        <span class="text-3xl">üé®</span>
        –î–∏–∑–∞–π–Ω-—Ä–µ—à–µ–Ω–∏—è
      </h2>

      <div class="space-y-4 not-prose">
        <div class="glass-panel p-4">
          <h3 class="text-lg font-semibold text-gray-100 mb-2">Glass-—Å—Ç–∏–ª—å</h3>
          <p class="text-sm text-gray-300">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `.glass-card` —Å hover-—ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ –∏ backdrop-blur. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º –∫—É—Ä—Å–æ–º.</p>
        </div>

        <div class="glass-panel p-4">
          <h3 class="text-lg font-semibold text-gray-100 mb-2">–°–≤—è–∑–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏</h3>
          <p class="text-sm text-gray-300">–ö–∞–∂–¥—ã–π —Ç–µ—Ä–º–∏–Ω/–æ—à–∏–±–∫–∞ —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —É—Ä–æ–∫–∏ –∫—É—Ä—Å–∞. –ü–æ–º–æ–≥–∞–µ—Ç —É–≥–ª—É–±–∏—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ.</p>
        </div>

        <div class="glass-panel p-4">
          <h3 class="text-lg font-semibold text-gray-100 mb-2">–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞</h3>
          <p class="text-sm text-gray-300">–ì–ª–æ—Å—Å–∞—Ä–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã SQL/–∫–æ–Ω—Ñ–∏–≥–æ–≤. Troubleshooting –¥–∞—ë—Ç –ø–æ—à–∞–≥–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–µ—à–µ–Ω–∏—è.</p>
        </div>

        <div class="glass-panel p-4">
          <h3 class="text-lg font-semibold text-gray-100 mb-2">–¢–µ–≥–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
          <p class="text-sm text-gray-300">Troubleshooting —Ä–∞–∑–º–µ—á–µ–Ω –ø–æ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä—É (PostgreSQL/MySQL) –∏ —Ç–∏–ø—É –ø—Ä–æ–±–ª–µ–º—ã (connection/snapshot/streaming). –ü–æ–∑–≤–æ–ª–∏—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å.</p>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>
