---
phase: 26-flowchart-primitives-tooltip-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/diagrams/primitives/FlowNode.tsx
  - src/components/diagrams/primitives/Arrow.tsx
  - src/components/diagrams/primitives/types.ts
  - src/components/diagrams/primitives/index.ts
autonomous: true

must_haves:
  truths:
    - "FlowNode component renders glass-styled nodes with 6 variants (database, connector, cluster, sink, app, target)"
    - "Arrow component renders SVG directional connectors in 4 directions (right, down, left, up)"
    - "Arrow component supports optional labels"
    - "Radix UI Tooltip is installed and available for use"
  artifacts:
    - path: "src/components/diagrams/primitives/FlowNode.tsx"
      provides: "Reusable FlowNode component with variant styling"
      exports: ["FlowNode", "FlowNodeProps"]
    - path: "src/components/diagrams/primitives/Arrow.tsx"
      provides: "Directional arrow connectors"
      exports: ["Arrow", "ArrowProps"]
    - path: "src/components/diagrams/primitives/types.ts"
      provides: "Shared TypeScript interfaces"
      exports: ["FlowNodeVariant", "ArrowDirection"]
    - path: "src/components/diagrams/primitives/index.ts"
      provides: "Barrel exports for primitives"
      exports: ["FlowNode", "Arrow"]
    - path: "package.json"
      provides: "@radix-ui/react-tooltip dependency"
      contains: "@radix-ui/react-tooltip"
  key_links:
    - from: "src/components/diagrams/primitives/FlowNode.tsx"
      to: "src/components/diagrams/primitives/types.ts"
      via: "import FlowNodeVariant"
      pattern: "import.*FlowNodeVariant.*from.*types"
    - from: "src/components/diagrams/primitives/Arrow.tsx"
      to: "src/components/diagrams/primitives/types.ts"
      via: "import ArrowDirection"
      pattern: "import.*ArrowDirection.*from.*types"
---

<objective>
Extract and enhance FlowNode and Arrow primitives from DeploymentModes.tsx POC into a dedicated primitives library, and install Radix UI Tooltip.

Purpose: Establish the foundation of reusable diagram building blocks that will be used across all 170 diagram migrations. TypeScript interfaces ensure API consistency.

Output: `src/components/diagrams/primitives/` with FlowNode, Arrow, types, and barrel exports. Radix UI Tooltip installed.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/STACK.md
@.planning/research/ARCHITECTURE.md

# Existing POC to extract from
@src/components/diagrams/DeploymentModes.tsx

# Glass design system
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Radix UI Tooltip and create primitives directory structure</name>
  <files>
    - package.json
    - src/components/diagrams/primitives/types.ts
    - src/components/diagrams/primitives/index.ts
  </files>
  <action>
1. Install @radix-ui/react-tooltip:
   ```bash
   npm install @radix-ui/react-tooltip
   ```

2. Create `src/components/diagrams/primitives/` directory.

3. Create `types.ts` with TypeScript interfaces:
   ```typescript
   export type FlowNodeVariant = 'database' | 'connector' | 'cluster' | 'sink' | 'app' | 'target';
   export type ArrowDirection = 'right' | 'down' | 'left' | 'up';

   export interface FlowNodeProps {
     children: React.ReactNode;
     variant?: FlowNodeVariant;
     size?: 'sm' | 'md' | 'lg';
     className?: string;
     onClick?: () => void;
     tabIndex?: number;
     'aria-label'?: string;
   }

   export interface ArrowProps {
     direction?: ArrowDirection;
     label?: string;
     dashed?: boolean;
     className?: string;
   }
   ```

4. Create `index.ts` barrel export (empty for now, will add exports after components created):
   ```typescript
   export * from './types';
   // Components will be added in Task 2 and 3
   ```
  </action>
  <verify>
    - `npm ls @radix-ui/react-tooltip` shows package installed
    - `src/components/diagrams/primitives/types.ts` exists and exports FlowNodeVariant, ArrowDirection
    - `src/components/diagrams/primitives/index.ts` exists
  </verify>
  <done>Radix UI Tooltip installed. Primitives directory created with TypeScript interfaces for FlowNode and Arrow.</done>
</task>

<task type="auto">
  <name>Task 2: Extract and enhance FlowNode component</name>
  <files>
    - src/components/diagrams/primitives/FlowNode.tsx
    - src/components/diagrams/primitives/index.ts
  </files>
  <action>
Create `FlowNode.tsx` based on DeploymentModes.tsx POC with enhancements:

1. Import types from `./types`.

2. Extract variant styles from POC (database, connector, cluster, sink, app, target):
   ```typescript
   const variantStyles: Record<FlowNodeVariant, string> = {
     database: 'bg-purple-500/20 border-purple-400/30 text-purple-200',
     connector: 'bg-emerald-500/15 border-emerald-400/30 text-emerald-200',
     cluster: 'bg-emerald-500/20 border-emerald-400/40 text-emerald-100',
     sink: 'bg-blue-500/15 border-blue-400/30 text-blue-200',
     app: 'bg-rose-500/15 border-rose-400/30 text-rose-200',
     target: 'bg-rose-500/20 border-rose-400/40 text-rose-100',
   };
   ```

3. Add size variants:
   - sm: `px-3 py-1.5 text-xs`
   - md: `px-4 py-2 text-sm` (default, matches POC)
   - lg: `px-5 py-3 text-base`

4. Add hover state with smooth transition:
   ```typescript
   hover:brightness-110 hover:scale-[1.02] transition-all duration-150
   ```

5. Add keyboard accessibility attributes:
   - `tabIndex={tabIndex ?? 0}` for keyboard focus
   - `role="button"` when onClick provided
   - `aria-label` pass-through
   - Focus ring: `focus:outline-none focus:ring-2 focus:ring-white/30 focus:ring-offset-2 focus:ring-offset-transparent`

6. Use `forwardRef` for ref forwarding (needed for Radix Tooltip.Trigger).

7. Update `index.ts` to export FlowNode:
   ```typescript
   export * from './types';
   export { FlowNode } from './FlowNode';
   ```
  </action>
  <verify>
    - `src/components/diagrams/primitives/FlowNode.tsx` exists
    - Component exports FlowNode and FlowNodeProps
    - All 6 variants have distinct styling
    - Component has forwardRef for Radix compatibility
    - TypeScript compiles: `npx tsc --noEmit src/components/diagrams/primitives/FlowNode.tsx`
  </verify>
  <done>FlowNode component renders glass-styled nodes with 6 variants, 3 sizes, hover states, and keyboard accessibility.</done>
</task>

<task type="auto">
  <name>Task 3: Extract and enhance Arrow component</name>
  <files>
    - src/components/diagrams/primitives/Arrow.tsx
    - src/components/diagrams/primitives/index.ts
  </files>
  <action>
Create `Arrow.tsx` based on DeploymentModes.tsx POC with enhancements:

1. Import types from `./types`.

2. Create SVG arrow paths for all 4 directions:
   ```typescript
   const arrowPaths: Record<ArrowDirection, string> = {
     right: 'M9 5l7 7-7 7',     // -> (existing from POC)
     down: 'M5 9l7 7 7-7',     // v
     left: 'M15 19l-7-7 7-7',  // <-
     up: 'M19 15l-7-7-7 7',    // ^
   };
   ```

3. Support optional label (positioned below arrow for horizontal, beside for vertical):
   ```typescript
   {label && (
     <span className="text-xs text-gray-400 whitespace-nowrap">
       {label}
     </span>
   )}
   ```

4. Support dashed variant for optional/async flows:
   - Normal: `strokeDasharray={undefined}`
   - Dashed: `strokeDasharray="4 2"`

5. Use flex layout to center arrow and optional label:
   - Horizontal arrows (right/left): vertical flex with label below
   - Vertical arrows (up/down): horizontal flex with label beside

6. Default direction is 'right' (matches existing POC usage).

7. Update `index.ts` to export Arrow:
   ```typescript
   export * from './types';
   export { FlowNode } from './FlowNode';
   export { Arrow } from './Arrow';
   ```
  </action>
  <verify>
    - `src/components/diagrams/primitives/Arrow.tsx` exists
    - Component exports Arrow and ArrowProps
    - All 4 directions render distinct arrow shapes
    - Label renders when provided
    - Dashed variant renders with dashed stroke
    - TypeScript compiles: `npx tsc --noEmit src/components/diagrams/primitives/Arrow.tsx`
  </verify>
  <done>Arrow component renders SVG directional connectors in 4 directions with optional labels and dashed variant.</done>
</task>

</tasks>

<verification>
1. Package verification:
   - `npm ls @radix-ui/react-tooltip` shows ^1.2.x installed
   - `npm run build` succeeds (no import errors)

2. File structure verification:
   ```
   src/components/diagrams/primitives/
     index.ts        # Barrel exports
     types.ts        # TypeScript interfaces
     FlowNode.tsx    # Glass-styled node component
     Arrow.tsx       # SVG directional arrows
   ```

3. Import verification:
   ```typescript
   import { FlowNode, Arrow, FlowNodeVariant, ArrowDirection } from './primitives';
   ```
   Should resolve without errors.

4. TypeScript verification:
   - `npx tsc --noEmit` passes for all primitives files
</verification>

<success_criteria>
1. `@radix-ui/react-tooltip` is in package.json dependencies
2. FlowNode component renders 6 variants (database, connector, cluster, sink, app, target)
3. FlowNode has forwardRef for Radix Tooltip compatibility
4. FlowNode has hover states and keyboard focus styles
5. Arrow component renders 4 directions (right, down, left, up)
6. Arrow supports optional label and dashed variant
7. All primitives export from `src/components/diagrams/primitives/index.ts`
8. TypeScript compilation passes
</success_criteria>

<output>
After completion, create `.planning/phases/26-flowchart-primitives-tooltip-foundation/26-01-SUMMARY.md`
</output>
