---
phase: 31-module-4-diagram-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/diagrams/module4/JmxMetricsDiagrams.tsx
  - src/components/diagrams/module4/PrometheusCollectionDiagrams.tsx
  - src/components/diagrams/module4/GrafanaDashboardDiagrams.tsx
  - src/components/diagrams/module4/index.ts
autonomous: true

must_haves:
  truths:
    - "JMX metrics pipeline diagram renders with 5-node flow (Debezium -> JMX -> Exporter -> Prometheus -> Grafana)"
    - "Lag calculation diagram shows MilliSecondsBehindSource flow with 3 nodes"
    - "Staleness scenarios diagram renders 3 color-coded states (green/blue/red)"
    - "Diagnostic decision tree renders with branching questions and color-coded outcomes"
    - "Prometheus scraping architecture shows Connect container internals"
    - "Grafana dashboard architecture shows 3-row structure with 9 panels"
    - "Health states comparison shows Healthy vs Attention vs Critical with metrics"
    - "User can click any FlowNode to see operations-specific tooltip"
  artifacts:
    - path: "src/components/diagrams/module4/JmxMetricsDiagrams.tsx"
      provides: "JMX metrics visualization (4 exports)"
      exports: ["JmxMetricsPipelineDiagram", "LagCalculationDiagram", "StalenessScenariosDiagram", "DiagnosticDecisionTreeDiagram"]
    - path: "src/components/diagrams/module4/PrometheusCollectionDiagrams.tsx"
      provides: "Prometheus collection architecture (1 export)"
      exports: ["PrometheusScrapingDiagram"]
    - path: "src/components/diagrams/module4/GrafanaDashboardDiagrams.tsx"
      provides: "Grafana dashboard visualization (3 exports)"
      exports: ["DashboardArchitectureDiagram", "PanelRowLayoutDiagram", "HealthStatesComparisonDiagram"]
    - path: "src/components/diagrams/module4/index.ts"
      provides: "Barrel export for module4 diagrams"
      contains: "export * from"
  key_links:
    - from: "src/components/diagrams/module4/JmxMetricsDiagrams.tsx"
      to: "primitives/FlowNode"
      via: "import"
      pattern: "import.*FlowNode.*from.*primitives"
    - from: "src/components/diagrams/module4/JmxMetricsDiagrams.tsx"
      to: "primitives/Tooltip"
      via: "import"
      pattern: "import.*DiagramTooltip.*from.*primitives"
---

<objective>
Create glass diagram components for Module 4 lessons 01-03: JMX metrics interpretation, Prometheus collection, and Grafana dashboard visualization.

Purpose: Provides interactive monitoring architecture diagrams with tooltips explaining JMX metrics, scraping patterns, and dashboard structure for production operations module.
Output: 4 diagram files (3 lesson-specific + 1 barrel export) with 8 total diagram exports.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-module-4-diagram-migration/31-RESEARCH.md

# Primitives reference
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx
@src/components/diagrams/primitives/types.ts

# Module 4 MDX files (diagram source)
@src/content/course/04-module-4/01-jmx-metrics-interpretation.mdx
@src/content/course/04-module-4/02-prometheus-metrics-collection.mdx
@src/content/course/04-module-4/03-grafana-dashboard-lab.mdx

# Prior module pattern reference
@src/components/diagrams/module3/BinlogArchitectureDiagrams.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create JmxMetricsDiagrams.tsx</name>
  <files>
    src/components/diagrams/module4/JmxMetricsDiagrams.tsx
  </files>
  <action>
Create src/components/diagrams/module4/ directory and JmxMetricsDiagrams.tsx with 4 diagram exports:

1. **JmxMetricsPipelineDiagram** (flowchart LR):
   - 5-node horizontal flow: Debezium (database) -> JMX (connector) -> JMX Exporter (amber connector) -> Prometheus (sink) -> Grafana (connector)
   - Arrow labels: "MBeans", ":9404", "/metrics"
   - Tooltips explaining each component's role in Russian
   - DiagramContainer with title="JMX Metrics Pipeline" color="blue"

2. **LagCalculationDiagram** (flowchart LR):
   - 3-node flow: DB Transaction -> Debezium Processing -> Lag Value
   - Tooltip explains: current_time - event_timestamp_from_db
   - DiagramContainer with title="MilliSecondsBehindSource Calculation"

3. **StalenessScenariosDiagram** (3 subgraphs side-by-side):
   - Grid layout: Normal (emerald), No Activity (blue), Stuck Connector (rose)
   - Each scenario shows: metric values and interpretation
   - Use responsive grid: grid-cols-1 md:grid-cols-3
   - Tooltips explain when each scenario occurs

4. **DiagnosticDecisionTreeDiagram** (flowchart TD):
   - Root question: "MilliSecondsBehindSource grows?"
   - Branching paths with Yes/No arrows
   - Terminal nodes: Kafka bottleneck (amber), WAL slow (blue), Connection loss (rose), Staleness (purple), Normal (emerald)
   - Use flex with nested divs for tree structure
   - DiagramContainer with title="Diagnostic Decision Tree"

Color mapping per research:
- database variant: JMX source, PostgreSQL
- connector variant: Debezium, exporters
- sink variant: Prometheus, Grafana
- app/target variant: Alert outcomes, failures

Russian tooltips from research:
- "MilliSecondsBehindSource - PRIMARY metric for lag monitoring"
- "JMX Exporter converts MBeans to Prometheus format on port 9404"
- "Scrape interval 15 seconds - optimal balance between freshness and load"
  </action>
  <verify>
    - Run `npm run build` - no TypeScript errors
    - File exists at src/components/diagrams/module4/JmxMetricsDiagrams.tsx
    - grep confirms 4 exports: JmxMetricsPipelineDiagram, LagCalculationDiagram, StalenessScenariosDiagram, DiagnosticDecisionTreeDiagram
  </verify>
  <done>
    JmxMetricsDiagrams.tsx exists with 4 exported diagram components, all using FlowNode/Arrow/DiagramContainer/DiagramTooltip primitives with Russian tooltips
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PrometheusCollectionDiagrams + GrafanaDashboardDiagrams + barrel export</name>
  <files>
    src/components/diagrams/module4/PrometheusCollectionDiagrams.tsx
    src/components/diagrams/module4/GrafanaDashboardDiagrams.tsx
    src/components/diagrams/module4/index.ts
  </files>
  <action>
Create 2 additional diagram files and barrel export:

**PrometheusCollectionDiagrams.tsx** (1 export):

1. **PrometheusScrapingDiagram** (flowchart LR with nested structure):
   - Left section (Connect container): JVM -> JMX -> Exporter (nested in DiagramContainer)
   - Middle: Prometheus internals (Scraper -> TSDB)
   - Right: Clients (Grafana, AlertManager)
   - Use nested DiagramContainers for visual grouping
   - Tooltips explain scrape intervals, retention, pull vs push

**GrafanaDashboardDiagrams.tsx** (3 exports):

1. **DashboardArchitectureDiagram** (graph TB):
   - 3 rows structure: Health Overview, Time Series, Details
   - 9 panels distributed across rows
   - Use grid layout with DiagramContainers for rows
   - Tooltips explain panel purpose and query type

2. **PanelRowLayoutDiagram** (graph LR):
   - 4 panels in Row 1 with sample values
   - Horizontal flex layout
   - Simple inline representation

3. **HealthStatesComparisonDiagram** (3 subgraphs):
   - Healthy (emerald): lag <1s, events/sec normal, queue low
   - Attention (amber): lag 1-5s, warning state
   - Critical (rose): lag >5s, queue full, errors
   - Responsive grid: grid-cols-1 md:grid-cols-3
   - Each state shows 4 metrics with values
   - Tooltips explain when each state triggers

**index.ts** (barrel export):
```typescript
export * from './JmxMetricsDiagrams';
export * from './PrometheusCollectionDiagrams';
export * from './GrafanaDashboardDiagrams';
```
  </action>
  <verify>
    - Run `npm run build` - no TypeScript errors
    - ls confirms 4 files in module4/: JmxMetricsDiagrams.tsx, PrometheusCollectionDiagrams.tsx, GrafanaDashboardDiagrams.tsx, index.ts
    - grep index.ts confirms 3 export statements
  </verify>
  <done>
    PrometheusCollectionDiagrams.tsx (1 export) and GrafanaDashboardDiagrams.tsx (3 exports) created, barrel export configured, total 8 diagram exports for lessons 01-03
  </done>
</task>

</tasks>

<verification>
1. Run `npm run build` - zero errors
2. ls src/components/diagrams/module4/ shows 4 files
3. Import test: create temp file importing from module4/index.ts, verify no errors
4. All 8 exports available from index.ts
</verification>

<success_criteria>
- 8 diagram components created (4 + 1 + 3)
- All diagrams use primitives (FlowNode, Arrow, DiagramContainer, DiagramTooltip)
- Russian tooltips provide operations-specific explanations
- Responsive layouts (grid-cols-1 md:grid-cols-3 for comparisons)
- Build passes with zero TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/31-module-4-diagram-migration/31-01-SUMMARY.md`
</output>
