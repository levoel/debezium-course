---
phase: 27-sequence-diagram-primitives
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/diagrams/primitives/types.ts
  - src/components/diagrams/primitives/SequenceActor.tsx
  - src/components/diagrams/primitives/SequenceLifeline.tsx
  - src/components/diagrams/primitives/SequenceMessage.tsx
  - src/components/diagrams/primitives/index.ts
autonomous: true

must_haves:
  truths:
    - "SequenceActor renders glass-styled participant boxes with 4 variants"
    - "SequenceLifeline renders vertical dashed SVG lines"
    - "SequenceMessage renders horizontal arrows with labels and 3 variants"
    - "All components use forwardRef for Radix Tooltip compatibility"
  artifacts:
    - path: "src/components/diagrams/primitives/SequenceActor.tsx"
      provides: "Glass-styled participant box component"
      exports: ["SequenceActor"]
    - path: "src/components/diagrams/primitives/SequenceLifeline.tsx"
      provides: "Vertical dashed line component"
      exports: ["SequenceLifeline"]
    - path: "src/components/diagrams/primitives/SequenceMessage.tsx"
      provides: "Horizontal arrow with label component"
      exports: ["SequenceMessage"]
    - path: "src/components/diagrams/primitives/types.ts"
      provides: "TypeScript interfaces for sequence components"
      contains: "SequenceActorProps"
  key_links:
    - from: "src/components/diagrams/primitives/index.ts"
      to: "SequenceActor, SequenceLifeline, SequenceMessage"
      via: "barrel exports"
      pattern: "export.*Sequence"
    - from: "SequenceActor.tsx"
      to: "types.ts"
      via: "import type"
      pattern: "import.*SequenceActorProps"
---

<objective>
Create three core sequence diagram primitives: SequenceActor (participant boxes), SequenceLifeline (dashed vertical lines), and SequenceMessage (horizontal arrows with labels).

Purpose: These primitives enable building interactive sequence diagrams to replace Mermaid sequenceDiagrams in the course. They follow the established FlowNode/Arrow pattern from Phase 26.

Output: Three new React components in the primitives library with TypeScript interfaces and barrel exports.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-sequence-diagram-primitives/27-RESEARCH.md

# Phase 26 primitives as pattern reference
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/types.ts
@src/components/diagrams/primitives/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sequence diagram types to types.ts</name>
  <files>src/components/diagrams/primitives/types.ts</files>
  <action>
Add TypeScript interfaces for sequence diagram components to the existing types.ts file.

Add these type definitions after the existing DiagramTooltipProps:

```typescript
// Sequence diagram types
export type SequenceActorVariant = 'database' | 'service' | 'queue' | 'external';

export interface SequenceActorProps {
  children: React.ReactNode;
  variant?: SequenceActorVariant;
  className?: string;
  onClick?: () => void;
  tabIndex?: number;
  'aria-label'?: string;
}

export interface SequenceLifelineProps {
  height: number;
  className?: string;
}

export type SequenceMessageVariant = 'sync' | 'async' | 'return';

export interface SequenceMessageProps {
  fromX: number;
  toX: number;
  y: number;
  label: string;
  variant?: SequenceMessageVariant;
  className?: string;
  onClick?: () => void;
  tabIndex?: number;
  'aria-label'?: string;
}
```

Keep all existing types intact. Append new sequence types at the end of the file.
  </action>
  <verify>
Run: `npx tsc --noEmit`
Check: No TypeScript errors. Types exported correctly.
  </verify>
  <done>
types.ts contains SequenceActorProps, SequenceLifelineProps, SequenceMessageProps, SequenceActorVariant, SequenceMessageVariant type definitions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SequenceActor, SequenceLifeline, SequenceMessage components</name>
  <files>
src/components/diagrams/primitives/SequenceActor.tsx
src/components/diagrams/primitives/SequenceLifeline.tsx
src/components/diagrams/primitives/SequenceMessage.tsx
  </files>
  <action>
Create three component files following the FlowNode pattern.

**SequenceActor.tsx:**
- forwardRef component for Radix Tooltip compatibility
- 4 variants: database (purple), service (emerald), queue (blue), external (gray)
- Glass styling: bg-{color}-500/20, border-{color}-400/30, text-{color}-200
- Sizing: px-3 py-2, min-w-[60px] max-w-[120px], rounded-lg
- Interactive: cursor-pointer and hover:brightness-110 when onClick provided
- Focus styles: focus:outline-none focus:ring-2 focus:ring-white/30

**SequenceLifeline.tsx:**
- Simple functional component (no forwardRef needed - not interactive)
- SVG element with width="2" and configurable height prop
- Dashed line: strokeDasharray="4 3", stroke="currentColor", text-gray-500
- aria-hidden="true" (decorative element)
- Centers with mx-auto

**SequenceMessage.tsx:**
- forwardRef SVG g element for tooltip compatibility
- Calculates arrow direction from fromX/toX (left-to-right or right-to-left)
- 3 variants:
  - sync: solid line, filled arrowhead
  - async: solid line, open arrowhead
  - return: dashed line (strokeDasharray="4 2"), open arrowhead
- Arrowhead size: 8px
- Label: positioned above arrow line (y - 6), text-anchor="middle", text-xs fill-gray-300
- Interactive when onClick provided: cursor-pointer, role="button"

See 27-RESEARCH.md for detailed code examples. Follow the exact patterns shown there.
  </action>
  <verify>
Run: `npx tsc --noEmit`
Check: All three components compile without errors. Imports resolve correctly.
  </verify>
  <done>
SequenceActor.tsx exports forwardRef component with 4 variants.
SequenceLifeline.tsx exports simple SVG dashed line component.
SequenceMessage.tsx exports forwardRef SVG component with 3 variants.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update barrel exports in index.ts</name>
  <files>src/components/diagrams/primitives/index.ts</files>
  <action>
Add exports for the three new sequence diagram components to the barrel file.

Update index.ts to include:

```typescript
/**
 * Diagram primitives barrel exports
 * Reusable building blocks for glass-styled diagrams
 */

export * from './types';
export { FlowNode } from './FlowNode';
export { Arrow } from './Arrow';
export { DiagramContainer } from './DiagramContainer';
export { DiagramTooltip } from './Tooltip';

// Sequence diagram primitives
export { SequenceActor } from './SequenceActor';
export { SequenceLifeline } from './SequenceLifeline';
export { SequenceMessage } from './SequenceMessage';
```

The primitives library will now export 7 components total.
  </action>
  <verify>
Run: `npm run build`
Check: Build succeeds. No unused export warnings.
Verify exports with: `grep -n "export" src/components/diagrams/primitives/index.ts`
  </verify>
  <done>
index.ts exports all 7 primitives: FlowNode, Arrow, DiagramContainer, DiagramTooltip, SequenceActor, SequenceLifeline, SequenceMessage.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation passes: `npx tsc --noEmit`
2. Build succeeds: `npm run build`
3. All exports present in index.ts
4. Each component follows established patterns:
   - forwardRef for interactive components (SequenceActor, SequenceMessage)
   - Glass styling with Tailwind classes
   - Proper TypeScript types imported from types.ts
</verification>

<success_criteria>
- SequenceActor renders glass-styled boxes with database/service/queue/external variants
- SequenceLifeline renders vertical dashed SVG lines of configurable height
- SequenceMessage renders horizontal arrows with sync/async/return variants and labels
- All components have proper TypeScript interfaces
- All components exported from primitives/index.ts
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/27-sequence-diagram-primitives/27-01-SUMMARY.md`
</output>
