---
phase: 08-module-4-advanced-patterns
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/04-module-4/07-schema-registry-avro.mdx
  - src/content/course/04-module-4/08-schema-evolution.mdx
autonomous: true

must_haves:
  truths:
    - "Student can configure Avro serialization with Schema Registry"
    - "Student understands Avro converter JAR installation requirement for Debezium 2.x"
    - "Student can explain schema compatibility modes (BACKWARD, FORWARD, FULL)"
    - "Student can handle schema evolution with safe field additions/removals"
    - "Student can test schema compatibility before deployment"
  artifacts:
    - path: "src/content/course/04-module-4/07-schema-registry-avro.mdx"
      provides: "Schema Registry integration and Avro configuration"
      contains: "AvroConverter"
    - path: "src/content/course/04-module-4/08-schema-evolution.mdx"
      provides: "Schema evolution and compatibility modes"
      contains: "BACKWARD"
  key_links:
    - from: "07-schema-registry-avro.mdx"
      to: "connector config"
      via: "converter configuration"
      pattern: "io.confluent.connect.avro.AvroConverter"
    - from: "08-schema-evolution.mdx"
      to: "Schema Registry API"
      via: "compatibility check"
      pattern: "compatibility/subjects"
---

<objective>
Create Schema Registry integration lessons covering Avro serialization and schema evolution.

Purpose: Students learn production-grade schema management for CDC pipelines with version control and compatibility.
Output: Two MDX lesson files teaching Avro configuration and schema evolution strategies.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-module-4-advanced-patterns/08-RESEARCH.md

# Pattern reference
@src/content/course/03-module-3/01-jmx-metrics-interpretation.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Schema Registry and Avro Lesson (07-schema-registry-avro.mdx)</name>
  <files>src/content/course/04-module-4/07-schema-registry-avro.mdx</files>
  <action>
Create lesson teaching Schema Registry integration with Avro serialization.

Content structure:
1. **Why Schema Registry:**
   - Schema versioning and centralized storage
   - Compatibility enforcement before publish
   - Compact binary serialization (2x smaller than JSON)
   - Schema ID caching for performance
2. **Avro vs JSON comparison:**
   | Aspect | JSON | Avro |
   |--------|------|------|
   | Size | 100% | ~50% |
   | Speed | 1x | 2x faster |
   | Schema | Implicit | Explicit |
   | Evolution | Manual | Managed |
3. **Debezium 2.x Avro converter installation:**
   - Debezium 2.0+ removed bundled Confluent JARs (licensing)
   - Required JARs (5): kafka-connect-avro-converter, kafka-connect-avro-data, kafka-avro-serializer, kafka-schema-serializer, kafka-schema-registry-client
   - Installation: Download from Maven, copy to Connect plugins
4. **Connector configuration:**
   ```json
   {
     "key.converter": "io.confluent.connect.avro.AvroConverter",
     "key.converter.schema.registry.url": "http://schema-registry:8081",
     "value.converter": "io.confluent.connect.avro.AvroConverter",
     "value.converter.schema.registry.url": "http://schema-registry:8081"
   }
   ```
5. **Subject naming strategies:**
   - TopicNameStrategy (default): {topic}-key, {topic}-value
   - RecordNameStrategy: {record-name}
   - TopicRecordNameStrategy: {topic}-{record-name}
6. **Viewing schemas in Registry:**
   ```bash
   # List subjects
   curl http://localhost:8081/subjects

   # Get latest schema
   curl http://localhost:8081/subjects/dbserver1.inventory.customers-value/versions/latest
   ```
7. **Lab: Configure Avro serialization**
   - Verify Schema Registry is running
   - Deploy connector with AvroConverter
   - Check registered schemas

Include Mermaid diagram showing Avro serialization flow with Schema Registry.

Pitfall callout: ClassNotFoundException for AvroConverter = missing JAR files (Debezium 2.0+ requires manual installation).

Frontmatter:
- title: "Schema Registry Integration with Avro"
- description: "Configuring Avro serialization with Confluent Schema Registry"
- order: 7
- difficulty: "intermediate"
- estimatedTime: 35
- topics: ["schema-registry", "avro", "serialization"]
- prerequisites: ["module-4/06-outbox-implementation"]

Language: Russian explanatory text, English code/config.
  </action>
  <verify>File exists at src/content/course/04-module-4/07-schema-registry-avro.mdx with AvroConverter configuration</verify>
  <done>Lesson explains Schema Registry purpose, shows Avro converter setup, covers JAR installation for Debezium 2.x</done>
</task>

<task type="auto">
  <name>Task 2: Create Schema Evolution Lesson (08-schema-evolution.mdx)</name>
  <files>src/content/course/04-module-4/08-schema-evolution.mdx</files>
  <action>
Create lesson teaching schema evolution and compatibility modes.

Content structure:
1. **Why schema evolution matters:**
   - Database schemas change over time
   - Consumers may not update simultaneously
   - Breaking changes cause consumer failures
2. **Compatibility modes explained:**
   | Mode | Description | Safe Changes | Upgrade Order |
   |------|-------------|--------------|---------------|
   | BACKWARD | Old consumer reads new data | Add optional field, remove field | Consumers first |
   | FORWARD | New consumer reads old data | Add field, remove optional field | Producers first |
   | FULL | Both directions | Add/remove optional fields | Any order |
   | NONE | No checks | Any change | Coordinate manually |
3. **TRANSITIVE variants:**
   - BACKWARD_TRANSITIVE: Compatible with ALL prior versions
   - FORWARD_TRANSITIVE: ALL future versions can read
   - FULL_TRANSITIVE: Both directions, all versions
4. **Safe schema changes:**
   - Adding optional field with default (BACKWARD safe)
   - Removing optional field (FORWARD safe)
   - Adding/removing optional fields (FULL safe)
5. **Unsafe changes:**
   - Changing field type (never safe)
   - Removing required field (breaks BACKWARD)
   - Adding required field without default (breaks BACKWARD)
6. **Setting compatibility mode:**
   ```bash
   # Global default
   curl -X PUT http://localhost:8081/config \
     -H "Content-Type: application/vnd.schemaregistry.v1+json" \
     -d '{"compatibility": "BACKWARD"}'

   # Per-subject override
   curl -X PUT http://localhost:8081/config/dbserver1.inventory.customers-value \
     -d '{"compatibility": "FULL"}'
   ```
7. **Testing compatibility before deployment:**
   ```bash
   curl -X POST http://localhost:8081/compatibility/subjects/{subject}/versions/latest \
     -H "Content-Type: application/vnd.schemaregistry.v1+json" \
     -d '{"schema": "{...new schema...}"}'
   # Returns: {"is_compatible": true}
   ```
8. **Debezium schema changes:**
   - New column in PostgreSQL → new optional field in Avro
   - Dropped column → field removed (check FORWARD compatibility)
   - Column type change → requires careful migration
9. **Lab: Evolve customer schema**
   - Add optional `phone` column
   - Verify BACKWARD compatibility
   - Test consumer with old/new schema

Include Mermaid diagram showing compatibility mode decision tree.

Best practice callout: BACKWARD (default) is safest - consumers can always be upgraded independently.

Frontmatter:
- title: "Schema Evolution and Compatibility"
- description: "Managing schema changes with backward/forward compatibility"
- order: 8
- difficulty: "advanced"
- estimatedTime: 35
- topics: ["schema-evolution", "compatibility", "schema-registry"]
- prerequisites: ["module-4/07-schema-registry-avro"]

Language: Russian explanatory text, English code/config.
  </action>
  <verify>File exists at src/content/course/04-module-4/08-schema-evolution.mdx with compatibility modes table and API examples</verify>
  <done>Lesson explains all compatibility modes, shows safe/unsafe changes, demonstrates compatibility testing via API</done>
</task>

</tasks>

<verification>
- Both MDX files exist in src/content/course/04-module-4/
- Frontmatter is valid YAML with required fields
- Code blocks use correct language tags
- Prerequisites chain correctly (07 -> 06, 08 -> 07)
</verification>

<success_criteria>
- Lesson 07 covers Schema Registry integration with Avro configuration
- Lesson 08 explains all compatibility modes with practical guidance
- Both lessons follow established pattern (Russian text, English code)
- Requirements MOD4-07 and MOD4-08 addressed
</success_criteria>

<output>
After completion, create `.planning/phases/08-module-4-advanced-patterns/08-04-SUMMARY.md`
</output>
