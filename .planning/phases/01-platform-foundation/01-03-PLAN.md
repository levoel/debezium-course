---
phase: 01-platform-foundation
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - src/pages/index.astro
  - src/pages/course/[...slug].astro
  - src/content/course/01-intro/index.mdx
autonomous: true

must_haves:
  truths:
    - "Landing page displays course overview"
    - "Sample lesson page shows syntax highlighting and Mermaid diagram"
    - "Navigation between pages works via links"
  artifacts:
    - path: "src/pages/index.astro"
      provides: "Course landing page"
      contains: "BaseLayout"
    - path: "src/pages/course/[...slug].astro"
      provides: "Dynamic course page routing"
      contains: "getStaticPaths"
    - path: "src/content/course/01-intro/index.mdx"
      provides: "Sample course content"
      contains: "Mermaid"
  key_links:
    - from: "src/pages/course/[...slug].astro"
      to: "src/content/course/"
      via: "getCollection('course')"
      pattern: "getCollection.*course"
    - from: "src/content/course/01-intro/index.mdx"
      to: "src/components/Mermaid.tsx"
      via: "import and client:visible"
      pattern: "client:visible"
---

<objective>
Create course content pages: landing page, dynamic routing for course lessons, and sample content demonstrating all features (syntax highlighting, Mermaid diagrams, responsive layout).

Purpose: Validates the entire stack end-to-end. Sample content serves as template for future course modules.
Output: Working course pages with navigation, showcasing all Phase 1 capabilities.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-platform-foundation/01-RESEARCH.md
@.planning/phases/01-platform-foundation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sample course content with all features</name>
  <files>
    src/content/course/01-intro/index.mdx
  </files>
  <action>
Create sample course lesson that demonstrates all Phase 1 features: frontmatter schema, MDX with component imports, syntax highlighting for all languages, Mermaid diagrams.

Create directory: `src/content/course/01-intro/`

Create `src/content/course/01-intro/index.mdx`:

```mdx
---
title: "Введение в Change Data Capture"
description: "Основы CDC и обзор архитектуры Debezium для захвата изменений в базах данных"
order: 1
difficulty: beginner
estimatedTime: 30
topics: ["CDC", "Debezium", "Architecture"]
---

import { Mermaid } from '../../../components/Mermaid';

# Введение в Change Data Capture

Change Data Capture (CDC) — это паттерн, позволяющий отслеживать изменения в базе данных в реальном времени и передавать их в другие системы.

## Архитектура Debezium

Debezium подключается к журналу транзакций базы данных и преобразует изменения в события Kafka:

<Mermaid client:visible chart={`
graph LR
    A[PostgreSQL] -->|WAL| B[Debezium Connector]
    B -->|CDC Events| C[Kafka]
    C -->|Stream| D[Python Consumer]
    C -->|Stream| E[Flink/Spark]
`} />

## Конфигурация коннектора

Пример конфигурации PostgreSQL коннектора:

\`\`\`json
{
  "name": "postgres-connector",
  "config": {
    "connector.class": "io.debezium.connector.postgresql.PostgresConnector",
    "database.hostname": "localhost",
    "database.port": "5432",
    "database.user": "debezium",
    "database.dbname": "inventory",
    "topic.prefix": "dbserver1",
    "plugin.name": "pgoutput"
  }
}
\`\`\`

## Настройка PostgreSQL

Включение логической репликации:

\`\`\`sql
-- Устанавливаем уровень WAL
ALTER SYSTEM SET wal_level = 'logical';

-- Создаем публикацию для всех таблиц
CREATE PUBLICATION dbz_publication FOR ALL TABLES;

-- Проверяем настройки
SHOW wal_level;
\`\`\`

## Python Consumer

Пример потребителя на Python с использованием confluent-kafka:

\`\`\`python
from confluent_kafka import Consumer
import json

consumer = Consumer({
    'bootstrap.servers': 'localhost:9092',
    'group.id': 'cdc-consumer',
    'auto.offset.reset': 'earliest'
})

consumer.subscribe(['dbserver1.public.users'])

try:
    while True:
        msg = consumer.poll(1.0)
        if msg is None:
            continue
        if msg.error():
            print(f"Error: {msg.error()}")
            continue

        event = json.loads(msg.value().decode('utf-8'))
        print(f"Operation: {event['payload']['op']}")
        print(f"After: {event['payload']['after']}")
finally:
    consumer.close()
\`\`\`

## Docker Compose для локальной разработки

\`\`\`yaml
version: "3.9"
services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_USER: debezium
      POSTGRES_PASSWORD: dbz
      POSTGRES_DB: inventory
    command:
      - postgres
      - -c
      - wal_level=logical

  kafka:
    image: confluentinc/cp-kafka:7.5.0
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka:9093
\`\`\`

## Ключевые концепции

- **WAL (Write-Ahead Log)** — журнал транзакций PostgreSQL
- **Logical Decoding** — механизм извлечения изменений из WAL
- **Replication Slot** — позиция чтения в WAL для коннектора
- **Topic Prefix** — префикс для именования топиков Kafka

## Sequence Diagram: Поток данных

<Mermaid client:visible chart={`
sequenceDiagram
    participant App as Application
    participant DB as PostgreSQL
    participant DBZ as Debezium
    participant K as Kafka
    participant C as Consumer

    App->>DB: INSERT INTO users
    DB->>DB: Write to WAL
    DBZ->>DB: Read WAL (pgoutput)
    DBZ->>K: Publish CDC event
    K->>C: Consume event
    C->>C: Process change
`} />

## Следующий урок

В следующем уроке мы настроим локальное окружение с помощью Docker Compose и создадим первый коннектор.
```

This content demonstrates:
- Frontmatter matching schema (title, description, order, difficulty, estimatedTime, topics)
- MDX component import (Mermaid)
- Syntax highlighting: JSON, SQL, Python, YAML
- Two Mermaid diagrams (flowchart and sequence)
- Russian language content
  </action>
  <verify>
Run `npm run build` - should succeed without frontmatter validation errors.
Content file should be at: src/content/course/01-intro/index.mdx
  </verify>
  <done>
Sample course content created with all required features: valid frontmatter, syntax-highlighted code blocks (JSON, SQL, Python, YAML), Mermaid diagrams (flowchart, sequence diagram).
  </done>
</task>

<task type="auto">
  <name>Task 2: Create dynamic routing and landing page</name>
  <files>
    src/pages/index.astro
    src/pages/course/[...slug].astro
  </files>
  <action>
Create landing page and dynamic routing for course content.

Update `src/pages/index.astro` (replace existing):

```astro
---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const courseEntries = await getCollection('course');
const sortedEntries = courseEntries.sort((a, b) => a.data.order - b.data.order);
---

<BaseLayout title="Debezium Course">
  <div class="space-y-8">
    <header class="text-center py-8">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">
        Debezium Course
      </h1>
      <p class="text-xl text-gray-400 max-w-2xl mx-auto">
        Интерактивный курс по Change Data Capture для middle+ дата-инженеров.
        Глубокое погружение в Debezium с практическими заданиями.
      </p>
    </header>

    <section>
      <h2 class="text-2xl font-semibold mb-6">Уроки курса</h2>

      {sortedEntries.length === 0 ? (
        <p class="text-gray-500 italic">Уроки скоро появятся...</p>
      ) : (
        <ul class="space-y-4">
          {sortedEntries.map((entry) => (
            <li>
              <a
                href={`/course/${entry.slug}`}
                class="block p-4 bg-gray-800 rounded-lg hover:bg-gray-700 transition-colors border border-gray-700"
              >
                <div class="flex items-center justify-between">
                  <div>
                    <h3 class="text-lg font-medium text-white">
                      {entry.data.order}. {entry.data.title}
                    </h3>
                    <p class="text-gray-400 text-sm mt-1">
                      {entry.data.description}
                    </p>
                  </div>
                  <div class="text-right text-sm text-gray-500">
                    <span class="capitalize">{entry.data.difficulty}</span>
                    <span class="mx-2">·</span>
                    <span>{entry.data.estimatedTime} мин</span>
                  </div>
                </div>
                <div class="mt-2 flex flex-wrap gap-2">
                  {entry.data.topics.map((topic: string) => (
                    <span class="px-2 py-1 bg-gray-700 rounded text-xs text-gray-300">
                      {topic}
                    </span>
                  ))}
                </div>
              </a>
            </li>
          ))}
        </ul>
      )}
    </section>

    <section class="py-8 border-t border-gray-700">
      <h2 class="text-2xl font-semibold mb-4">О курсе</h2>
      <div class="grid md:grid-cols-2 gap-6 text-gray-400">
        <div>
          <h3 class="text-white font-medium mb-2">Для кого</h3>
          <p>Middle+ дата-инженеры, которые хотят освоить CDC и Debezium на production-уровне.</p>
        </div>
        <div>
          <h3 class="text-white font-medium mb-2">Что изучите</h3>
          <p>PostgreSQL, Aurora DB, GCP интеграции, Python consumers, PyFlink, PySpark.</p>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>
```

Create `src/pages/course/[...slug].astro`:

```astro
---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const courseEntries = await getCollection('course');
  return courseEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Get all entries for prev/next navigation
const allEntries = await getCollection('course');
const sortedEntries = allEntries.sort((a, b) => a.data.order - b.data.order);
const currentIndex = sortedEntries.findIndex(e => e.slug === entry.slug);
const prevEntry = currentIndex > 0 ? sortedEntries[currentIndex - 1] : null;
const nextEntry = currentIndex < sortedEntries.length - 1 ? sortedEntries[currentIndex + 1] : null;
---

<BaseLayout title={entry.data.title} description={entry.data.description}>
  <article>
    <!-- Header -->
    <header class="mb-8 pb-6 border-b border-gray-700">
      <div class="flex items-center gap-4 text-sm text-gray-500 mb-4">
        <a href="/" class="hover:text-blue-400">&larr; Все уроки</a>
        <span>·</span>
        <span class="capitalize">{entry.data.difficulty}</span>
        <span>·</span>
        <span>{entry.data.estimatedTime} мин</span>
      </div>

      <h1 class="text-3xl md:text-4xl font-bold mb-4">{entry.data.title}</h1>
      <p class="text-xl text-gray-400">{entry.data.description}</p>

      {entry.data.prerequisites && entry.data.prerequisites.length > 0 && (
        <div class="mt-4 p-4 bg-gray-800 rounded-lg">
          <p class="text-sm text-gray-500 mb-2">Предварительные знания:</p>
          <ul class="list-disc list-inside text-gray-400 text-sm">
            {entry.data.prerequisites.map((prereq: string) => (
              <li>{prereq}</li>
            ))}
          </ul>
        </div>
      )}
    </header>

    <!-- Content -->
    <div class="prose prose-invert max-w-none">
      <Content />
    </div>

    <!-- Navigation -->
    <nav class="mt-12 pt-8 border-t border-gray-700 flex justify-between">
      {prevEntry ? (
        <a
          href={`/course/${prevEntry.slug}`}
          class="flex flex-col text-left hover:text-blue-400 transition-colors"
        >
          <span class="text-sm text-gray-500">&larr; Предыдущий</span>
          <span class="font-medium">{prevEntry.data.title}</span>
        </a>
      ) : (
        <div />
      )}

      {nextEntry ? (
        <a
          href={`/course/${nextEntry.slug}`}
          class="flex flex-col text-right hover:text-blue-400 transition-colors"
        >
          <span class="text-sm text-gray-500">Следующий &rarr;</span>
          <span class="font-medium">{nextEntry.data.title}</span>
        </a>
      ) : (
        <div />
      )}
    </nav>
  </article>
</BaseLayout>
```

Key features:
- `getStaticPaths()` generates routes for all course content
- `[...slug]` catches nested paths (e.g., `01-intro` folder)
- Prev/next navigation between lessons
- Breadcrumb back to course list
- Prerequisites display if defined
  </action>
  <verify>
Run `npm run dev`, test navigation flow:
1. Visit http://localhost:4321 - landing page shows lesson list
2. Click on first lesson - navigates to course page
3. Lesson page shows: title, description, difficulty, time
4. Content renders with syntax highlighting
5. Mermaid diagrams render as SVG
6. "Все уроки" link returns to homepage
7. Mobile view: content is full-width, readable
  </verify>
  <done>
Landing page lists course content sorted by order. Dynamic routing generates pages for all lessons. Navigation between pages works. All features (syntax highlighting, diagrams) display correctly.
  </done>
</task>

</tasks>

<verification>
1. Landing page (/) displays course overview and lesson list
2. Clicking lesson navigates to /course/01-intro
3. Lesson page renders MDX content with:
   - Syntax highlighting for all code blocks
   - Two Mermaid diagrams as SVG
   - Responsive layout
4. "Все уроки" link returns to landing page
5. `npm run build` succeeds without errors
</verification>

<success_criteria>
- Course landing page shows lesson cards with metadata
- Dynamic routing works for /course/[slug] paths
- Sample content demonstrates all Phase 1 features
- Navigation between pages functional
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-platform-foundation/01-03-SUMMARY.md`
</output>
