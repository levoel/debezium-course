---
phase: 33-module-6-diagram-migration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/diagrams/module6/PyflinkConnectorDiagrams.tsx
  - src/components/diagrams/module6/PyflinkStatefulDiagrams.tsx
autonomous: true

must_haves:
  truths:
    - "User can see Pandas vs PyFlink comparison with batch vs streaming philosophy"
    - "User can see PyFlink CDC architecture with nested layer containers"
    - "User can see out-of-order events sequence diagram with watermark explanation"
    - "User can see tumbling, sliding, and session window timeline diagrams"
    - "User can see temporal join sequence diagram with versioned state"
    - "User can see state growth warning diagram"
    - "All diagrams have Russian tooltips with streaming terminology"
  artifacts:
    - path: "src/components/diagrams/module6/PyflinkConnectorDiagrams.tsx"
      provides: "2 diagrams for lesson 03 (Pandas vs PyFlink, architecture)"
      exports: ["PandasVsPyflinkComparisonDiagram", "PyflinkCdcArchitectureDiagram"]
    - path: "src/components/diagrams/module6/PyflinkStatefulDiagrams.tsx"
      provides: "8 diagrams for lesson 04 (state, watermarks, windows, joins)"
      exports: ["StatefulOperationsDiagram", "OutOfOrderEventsSequenceDiagram", "WatermarkProgressDiagram", "TumblingWindowsDiagram", "SlidingWindowsDiagram", "SessionWindowsDiagram", "TemporalJoinSequenceDiagram", "StateGrowthDiagram"]
  key_links:
    - from: "src/components/diagrams/module6/PyflinkConnectorDiagrams.tsx"
      to: "src/components/diagrams/primitives/*"
      via: "import FlowNode, Arrow, DiagramContainer, DiagramTooltip"
      pattern: "import.*from.*primitives"
    - from: "src/components/diagrams/module6/PyflinkStatefulDiagrams.tsx"
      to: "src/components/diagrams/primitives/SequenceDiagram"
      via: "import for out-of-order and temporal join diagrams"
      pattern: "import.*SequenceDiagram"
---

<objective>
Create interactive glass diagram components for Module 6 lessons 03-04 (PyFlink Streaming).

Purpose: Replace 10 Mermaid diagrams in PyFlink connector and stateful processing lessons with interactive glass components. This is the largest batch in Module 6, covering complex streaming concepts: watermarks, windows, temporal joins, and state management.

Output:
- PyflinkConnectorDiagrams.tsx with 2 diagrams
- PyflinkStatefulDiagrams.tsx with 8 diagrams
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-module-6-diagram-migration/33-RESEARCH.md

# Reference primitives
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx
@src/components/diagrams/primitives/SequenceDiagram.tsx

# Reference patterns from Module 5
@src/components/diagrams/module5/OutboxPatternDiagrams.tsx

# Source MDX files
@src/content/course/06-module-6/03-pyflink-cdc-connector.mdx
@src/content/course/06-module-6/04-pyflink-stateful-processing.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PyflinkConnectorDiagrams.tsx</name>
  <files>src/components/diagrams/module6/PyflinkConnectorDiagrams.tsx</files>
  <action>
Create diagram component file with 2 diagrams:

**1. PandasVsPyflinkComparisonDiagram** (side-by-side)
- Left: "Pandas (Batch)" container (amber color)
  - Vertical flow: "1. Накопить события" -> "2. Загрузить в DataFrame" -> "3. Обработать batch" -> "4. Записать результат" -> back to step 1
  - Tooltip on each: explain batch processing model
  - Bottom text: "Latency: минуты/часы (batch interval)"
- Right: "PyFlink (Streaming)" container (emerald color, recommended)
  - Vertical flow: "Непрерывный поток" -> "Event-by-event обработка" -> "Stateful агрегации" -> "Непрерывный вывод" -> cycle back
  - Tooltip on each: explain streaming model
  - Bottom text: "Latency: миллисекунды/секунды"

Use `recommended` prop on PyFlink container.

**2. PyflinkCdcArchitectureDiagram** (nested multi-layer)
Pattern: 4 nested DiagramContainers showing vertical data flow:
- Source Layer (blue): "PostgreSQL" database node
  - Tooltip: "Источник CDC событий. Генерирует изменения через WAL."
- CDC Layer (emerald): "Debezium Connector" -> "Kafka Topic"
  - Tooltip: "Debezium читает WAL и публикует в Kafka в envelope формате"
- Processing Layer (purple): "Kafka Connector" -> "VIEW orders_current" -> "SQL Query"
  - Tooltip on each explaining PyFlink Table API stages
- Output Layer (amber): "Kafka topic / Database / File"
  - Tooltip: "Результаты пишутся в sink в зависимости от use case"

Arrows between layers with labels: "CDC events", "Publish", "Read stream"
  </action>
  <verify>
- File exists at src/components/diagrams/module6/PyflinkConnectorDiagrams.tsx
- Exports PandasVsPyflinkComparisonDiagram and PyflinkCdcArchitectureDiagram
- No TypeScript errors
  </verify>
  <done>
2 diagrams for PyFlink connector lesson created: side-by-side batch/streaming comparison and multi-layer CDC architecture
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PyflinkStatefulDiagrams.tsx</name>
  <files>src/components/diagrams/module6/PyflinkStatefulDiagrams.tsx</files>
  <action>
Create diagram component file with 8 diagrams:

**1. StatefulOperationsDiagram**
- Two containers side-by-side:
  - Left "Stateful Operations" (purple): 4 nodes vertically - "Aggregations (COUNT, SUM, AVG)", "Joins", "Deduplication", "Sessionization"
  - Right "Managed State" (blue): 3 nodes - "State хранится в памяти или RocksDB", "Периодические checkpoints", "Восстановление при сбоях"
- Arrow connecting the two containers

**2. OutOfOrderEventsSequenceDiagram** (SequenceDiagram primitive)
- Actors: PostgreSQL (database), Kafka Partition 1 (queue), Kafka Partition 2 (queue), PyFlink (service)
- Messages showing:
  - E1 (event_time=10:00) sent to K1
  - E2 (event_time=10:01) sent to K2
  - E3 (event_time=10:02) sent to K1
  - E2 arrives at PyFlink first (from K2, faster)
  - E3 arrives second
  - E1 arrives LATE! (with variant="async" for emphasis)
- Note below: "Processing time порядок: E2 -> E3 -> E1, Event time порядок: E1 -> E2 -> E3"
- messageSpacing=60

**3. WatermarkProgressDiagram**
- Horizontal timeline: "10:00" -> "10:01" -> "10:02" -> "10:03" -> "10:04"
- Below timeline: Watermark indicator at 10:02 with tooltip "Watermark: 10:02 означает, что события до 10:02 (скорее всего) уже прибыли"
- Action box: "Закрыть windows с end_time <= 10:02"

**4. TumblingWindowsDiagram** (Gantt-style using horizontal FlowNodes)
- Title: "Tumbling Windows (размер = 5 минут)"
- 4 horizontal FlowNodes in a row:
  - "10:00-10:05 Window 1" (blue border)
  - "10:05-10:10 Window 2" (purple border)
  - "10:10-10:15 Window 3" (amber border)
  - "10:15-10:20 Window 4" (emerald border)
- Text below: "Неперекрывающиеся окна фиксированного размера. Каждое событие попадает ровно в одно окно."

**5. SlidingWindowsDiagram** (overlapping horizontal FlowNodes)
- Title: "Sliding Windows (размер = 10 минут, slide = 5 минут)"
- Show 3 overlapping windows with partial opacity to show overlap:
  - "10:00-10:10 Window 1"
  - "10:05-10:15 Window 2" (overlaps with 1)
  - "10:10-10:20 Window 3" (overlaps with 2)
- Text: "Перекрывающиеся окна. Событие может попасть в несколько окон."

**6. SessionWindowsDiagram** (Gantt-style with gap)
- Two sessions for "User 1":
  - Session 1: "10:00-10:15" (with event markers)
  - Gap indicator: "30 min gap (inactivity)"
  - Session 2: "10:45-10:55"
- Text: "Динамические окна. Закрываются после периода неактивности (gap)."

**7. TemporalJoinSequenceDiagram** (SequenceDiagram primitive)
- Actors: Orders Stream, Products Table (Versioned), Temporal Join
- Show version changes:
  - "Version 1: product_id=101, price=100.00 (09:00)"
  - Order at 09:30 -> Join looks up AS OF 09:30 -> Gets price=100.00
  - "Version 2: price=120.00 (10:00)"
  - Order at 10:30 -> Join looks up AS OF 10:30 -> Gets price=120.00
- messageSpacing=55

**8. StateGrowthDiagram**
- Vertical flow showing state growth over time:
  - "Day 1: 1 GB state" (emerald)
  - "Day 7: 10 GB state" (amber)
  - "Day 30: 50 GB state" (amber)
  - "Day 90: OOM crash!" (rose with animate-pulse)
- Arrows between nodes

All tooltips in Russian using terminology from RESEARCH.md glossary.
  </action>
  <verify>
- File exists at src/components/diagrams/module6/PyflinkStatefulDiagrams.tsx
- Exports all 8 diagram components
- No TypeScript errors
  </verify>
  <done>
8 diagrams for PyFlink stateful processing lesson created: state operations, out-of-order events sequence, watermark progress, tumbling/sliding/session windows, temporal join sequence, state growth warning
  </done>
</task>

</tasks>

<verification>
- Both component files exist in src/components/diagrams/module6/
- All 10 diagrams export correctly
- TypeScript compiles without errors
- SequenceDiagram primitive used for temporal flows (out-of-order, temporal join)
- Window diagrams use horizontal FlowNode chains (not Mermaid Gantt)
- All tooltips are in Russian with correct streaming terminology
- Dev server renders diagrams without errors
</verification>

<success_criteria>
- 10 diagram components created for Module 6 lessons 03-04
- SequenceDiagram used for out-of-order events and temporal joins
- Window timelines use FlowNode chains (proven simpler than Gantt)
- State growth uses color progression (emerald -> amber -> rose)
- Multi-layer nested containers for CDC architecture
- All Russian tooltips use consistent streaming terminology
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/33-module-6-diagram-migration/33-02-SUMMARY.md`
</output>
