---
phase: 09-module-5-data-engineering
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/05-module-5/01-advanced-python-consumer.mdx
  - src/content/course/05-module-5/02-pandas-integration.mdx
autonomous: true

must_haves:
  truths:
    - "Student can configure exactly-once consumer semantics with isolation.level=read_committed"
    - "Student can implement error handling with fatal vs non-fatal error distinction"
    - "Student can use manual offset store pattern for at-least-once guarantee"
    - "Student can flatten CDC events into Pandas DataFrame using json_normalize"
    - "Student can handle operation types (c, u, d, r) when building DataFrames"
  artifacts:
    - path: "src/content/course/05-module-5/01-advanced-python-consumer.mdx"
      provides: "Advanced consumer patterns lesson"
      min_lines: 200
      contains: "isolation.level"
    - path: "src/content/course/05-module-5/02-pandas-integration.mdx"
      provides: "Pandas DataFrame integration lesson"
      min_lines: 180
      contains: "json_normalize"
  key_links:
    - from: "01-advanced-python-consumer.mdx"
      to: "confluent-kafka transactional API"
      via: "code examples"
      pattern: "enable.auto.offset.store.*False"
    - from: "02-pandas-integration.mdx"
      to: "CDC event structure"
      via: "before/after field extraction"
      pattern: "payload.*after"
---

<objective>
Create Module 5 foundation lessons covering production-grade Python consumers and Pandas DataFrame integration for CDC events.

Purpose: Module 5 teaches data engineering workflows with CDC. These first two lessons establish Python patterns that all subsequent lessons build upon - advanced consumer patterns (MOD5-01) and Pandas integration (MOD5-02).

Output: Two MDX lesson files in src/content/course/05-module-5/ directory with Russian explanatory text, English code, labs, and Mermaid diagrams.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-module-5-data-engineering/09-RESEARCH.md

# Reference for lesson structure and Russian language patterns
@src/content/course/01-module-1/05-python-consumer.mdx
@src/content/course/04-module-4/01-smt-overview.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Advanced Python Consumer Lesson</name>
  <files>src/content/course/05-module-5/01-advanced-python-consumer.mdx</files>
  <action>
Create lesson covering MOD5-01 (advanced Python consumer patterns).

**Frontmatter:**
- title: "Продвинутые паттерны Python Consumer"
- description: "Обработка ошибок, exactly-once семантика и production-ready конфигурация"
- order: 1
- difficulty: "advanced"
- estimatedTime: 45
- topics: ["Python", "confluent-kafka", "Exactly-Once", "Error Handling", "Transactions"]
- prerequisites: ["module-1/05-python-consumer"]

**Content structure (Russian explanatory text, English code):**

1. **Введение: от tutorial к production** (~100 words)
   - Reference Module 1 basic consumer as starting point
   - List production requirements: error handling, exactly-once, monitoring

2. **At-Least-Once vs Exactly-Once семантика** (~200 words)
   - Explain delivery guarantees with Mermaid diagram showing message flow
   - When each is appropriate (exactly-once for financial, at-least-once for analytics)

3. **Конфигурация для At-Least-Once** (~150 words)
   - `enable.auto.commit=True` + `enable.auto.offset.store=False` pattern
   - Manual `consumer.store_offsets(msg)` after successful processing
   - Code example with full config dict

4. **Exactly-Once с транзакционным API** (~300 words)
   - Producer+consumer pattern with `transactional.id`
   - `isolation.level='read_committed'` for consumer
   - `producer.init_transactions()`, `begin_transaction()`, `commit_transaction()`
   - `send_offsets_to_transaction()` for atomic offset commit
   - Full code example from RESEARCH.md Pattern 1

5. **Обработка ошибок: Fatal vs Non-Fatal** (~200 words)
   - KafkaError types: `_PARTITION_EOF`, `_TRANSPORT`, `_ALL_BROKERS_DOWN`
   - Fatal errors (must exit): check `msg.error().fatal()`
   - Non-fatal errors (log and continue): transient network issues
   - Code example with error handling loop

6. **Rebalancing и max.poll.interval.ms** (~150 words)
   - Explain pitfall from RESEARCH.md (Pitfall 6)
   - Default 5 minutes, processing must complete within
   - Use `max.poll.records` to limit batch size

7. **Лабораторная работа: Resilient Consumer** (~100 words)
   - Exercise: modify basic consumer to add error handling
   - Test by stopping/starting Kafka during consumption
   - Verify offset recovery after restart

Use Mermaid diagram for at-least-once vs exactly-once message flow.
Include warning callout about `kafka:9092` vs `localhost:9092` (from existing pattern).
  </action>
  <verify>
- File exists at src/content/course/05-module-5/01-advanced-python-consumer.mdx
- Frontmatter has all required fields (title, description, order, difficulty, estimatedTime, topics, prerequisites)
- Contains `isolation.level` configuration example
- Contains `enable.auto.offset.store=False` pattern
- Contains error handling with `msg.error().fatal()` check
- Contains Mermaid import and diagram
- Russian explanatory text, English code/config
  </verify>
  <done>Lesson 01-advanced-python-consumer.mdx exists with exactly-once semantics, error handling patterns, and lab exercise</done>
</task>

<task type="auto">
  <name>Task 2: Create Pandas Integration Lesson</name>
  <files>src/content/course/05-module-5/02-pandas-integration.mdx</files>
  <action>
Create lesson covering MOD5-02 (CDC to Pandas DataFrame integration).

**Frontmatter:**
- title: "Интеграция CDC событий с Pandas"
- description: "Преобразование CDC событий в DataFrame для анализа и обработки"
- order: 2
- difficulty: "intermediate"
- estimatedTime: 35
- topics: ["Python", "Pandas", "DataFrame", "CDC", "Data Analysis"]
- prerequisites: ["module-5/01-advanced-python-consumer"]

**Content structure (Russian explanatory text, English code):**

1. **Зачем Pandas для CDC данных?** (~100 words)
   - Batch analysis of CDC events
   - Exploratory data analysis
   - Aggregations and transformations before loading to data warehouse

2. **Pandas 3.0: Важные изменения** (~200 words)
   - Warning box about breaking changes from RESEARCH.md (Pitfall 2)
   - `str` dtype instead of `object` for strings
   - Copy-on-Write (CoW) - use `.loc[]` not chained assignment
   - Microsecond datetime resolution (not nanosecond)
   - Code example showing old vs new patterns

3. **Структура Debezium CDC события** (~150 words)
   - Recap envelope structure: payload.before, payload.after, payload.op, payload.ts_ms
   - Operation types: 'c' (create), 'u' (update), 'd' (delete), 'r' (read/snapshot)
   - Mermaid diagram of JSON structure

4. **Простое преобразование в DataFrame** (~200 words)
   - Manual flattening approach from RESEARCH.md Pattern 2
   - Handle before/after with prefixes
   - Convert ts_ms to datetime
   - Full code example with `cdc_events_to_dataframe()` function

5. **json_normalize для сложных структур** (~200 words)
   - `pd.json_normalize()` with `sep`, `max_level` params
   - When to use: deeply nested events, complex schemas
   - Code example with normalized output

6. **Обработка разных типов операций** (~150 words)
   - Critical: DELETE events have `after=null`, use `before` field
   - Filter by operation type for specific analyses
   - Code example handling all op types

7. **Лабораторная работа: CDC Analytics** (~100 words)
   - Exercise: consume 100 CDC events, build DataFrame
   - Calculate: events per operation type, events per minute
   - Plot results with matplotlib (optional)

Include Mermaid diagram showing CDC event structure.
Reference RESEARCH.md Anti-Patterns section for CoW warning.
  </action>
  <verify>
- File exists at src/content/course/05-module-5/02-pandas-integration.mdx
- Frontmatter has all required fields
- Contains `json_normalize` example
- Contains warning about Pandas 3.0 breaking changes
- Contains operation type handling (c, u, d, r)
- Contains `payload['after']` and `payload['before']` handling
- Contains Mermaid import and diagram
- Russian explanatory text, English code/config
  </verify>
  <done>Lesson 02-pandas-integration.mdx exists with DataFrame conversion patterns, Pandas 3.0 warnings, and lab exercise</done>
</task>

</tasks>

<verification>
- [ ] Both lesson files exist in src/content/course/05-module-5/
- [ ] Module 5 directory created if not exists
- [ ] Lesson order field is sequential (1, 2)
- [ ] Prerequisites chain correctly (02 requires 01)
- [ ] Code examples are syntactically correct Python
- [ ] Mermaid diagrams render (proper syntax)
- [ ] Russian language for explanatory text
- [ ] English for code, config, technical terms
</verification>

<success_criteria>
1. Student can configure at-least-once and exactly-once consumer semantics
2. Student can implement production error handling with fatal/non-fatal distinction
3. Student can flatten CDC events into Pandas DataFrame
4. Student understands Pandas 3.0 breaking changes relevant to CDC processing
5. Student can handle all CDC operation types when building DataFrames
</success_criteria>

<output>
After completion, create `.planning/phases/09-module-5-data-engineering/09-01-SUMMARY.md`
</output>
