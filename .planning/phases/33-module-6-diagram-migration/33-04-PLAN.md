---
phase: 33-module-6-diagram-migration
plan: 04
type: execute
wave: 2
depends_on: ["33-01", "33-02", "33-03"]
files_modified:
  - src/components/diagrams/module6/FeatureEngineeringDiagrams.tsx
  - src/components/diagrams/module6/index.ts
  - src/content/course/06-module-6/01-advanced-python-consumer.mdx
  - src/content/course/06-module-6/02-pandas-integration.mdx
  - src/content/course/06-module-6/03-pyflink-cdc-connector.mdx
  - src/content/course/06-module-6/04-pyflink-stateful-processing.mdx
  - src/content/course/06-module-6/05-pyspark-structured-streaming.mdx
  - src/content/course/06-module-6/06-etl-elt-patterns.mdx
  - src/content/course/06-module-6/07-feature-engineering.mdx
autonomous: true

must_haves:
  truths:
    - "User can see batch vs real-time feature pipeline comparison"
    - "User can see customer behavior feature architecture"
    - "User can see feature store dual-write pattern (online + offline)"
    - "All 7 Module 6 MDX files import glass components instead of Mermaid"
    - "No Mermaid code blocks remain in Module 6 MDX files"
    - "All glass diagrams render correctly in browser"
  artifacts:
    - path: "src/components/diagrams/module6/FeatureEngineeringDiagrams.tsx"
      provides: "4 diagrams for lesson 07 (batch vs RT features, architecture)"
      exports: ["BatchFeaturesProblemDiagram", "RealTimeFeaturesPipelineDiagram", "CustomerBehaviorFeaturesDiagram", "FeatureStoreArchitectureDiagram"]
    - path: "src/components/diagrams/module6/index.ts"
      provides: "Barrel export for all Module 6 diagrams"
      exports: ["*"]
  key_links:
    - from: "src/content/course/06-module-6/*.mdx"
      to: "src/components/diagrams/module6"
      via: "import statement at top of MDX"
      pattern: "import.*from.*components/diagrams/module6"
    - from: "src/content/course/06-module-6/*.mdx"
      to: "Mermaid"
      via: "should NOT exist after migration"
      pattern: "Mermaid chart"
---

<objective>
Create Feature Engineering diagrams and migrate all 7 Module 6 MDX files to use glass components.

Purpose: Complete Module 6 diagram migration by creating the final 4 diagrams for feature engineering lesson, creating the barrel export, and updating all MDX files to import and use glass components instead of Mermaid.

Output:
- FeatureEngineeringDiagrams.tsx with 4 diagrams
- index.ts barrel export for all Module 6 diagrams
- All 7 MDX files updated with glass component imports and usage
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-module-6-diagram-migration/33-RESEARCH.md

# Reference primitives
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx

# Prior plan SUMMARYs (will exist after Wave 1)
# These create the diagram components this plan imports

# Source MDX files
@src/content/course/06-module-6/07-feature-engineering.mdx

# Reference for MDX migration pattern
@src/content/course/05-module-5/01-smt-overview.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FeatureEngineeringDiagrams.tsx and index.ts</name>
  <files>
    src/components/diagrams/module6/FeatureEngineeringDiagrams.tsx
    src/components/diagrams/module6/index.ts
  </files>
  <action>
**1. Create FeatureEngineeringDiagrams.tsx with 4 diagrams:**

**BatchFeaturesProblemDiagram** (horizontal flow showing staleness)
- Flow: "PostgreSQL" -> "Daily dump" -> "ETL Job (Runs at 2am)" -> "Data Warehouse" -> "Feature query" -> "Feature Store" -> "Features (12h old)" -> "ML Model"
- ETL Job and Feature Store highlighted in amber (staleness indicator)
- Tooltip: "Features обновляются раз в сутки. К моменту prediction могут быть устаревшими на 12-24 часа."
- Note: "Проблема: Fraud detection - мошенник успеет совершить 50 транзакций пока features обновятся"

**RealTimeFeaturesPipelineDiagram** (horizontal flow showing freshness)
- Flow: "PostgreSQL" -> "CDC events (ms latency)" -> "Kafka" -> "PySpark Feature Computation" -> "Fresh features (seconds old)" -> "Feature Store (Redis)" -> "Real-time lookup" -> "ML Model"
- Spark and Redis highlighted in emerald (freshness indicator)
- Tooltip: "Features обновляются при каждом CDC событии. Latency в секундах, не часах."

**CustomerBehaviorFeaturesDiagram** (multi-layer architecture)
- 4 layers vertically:
  - "Source Database" (blue): "orders table (PostgreSQL)"
  - "CDC Layer" (emerald): "Debezium Connector" -> "Kafka Topic"
  - "Feature Computation" (purple): "PySpark Streaming" + "Watermark (1 hour late data)" in parallel
  - "Feature Store" (amber): "Redis (Online Store)" and "Parquet (Offline Store)" side by side
- Arrows between layers
- Tooltips explaining each layer's role

**FeatureStoreArchitectureDiagram** (dual-write pattern)
- Central "Feature Computation" node
- Two outputs:
  - "Online Store (Redis)" (emerald): "Low latency reads (ms)", "Point lookups by key", "Last N values per entity"
  - "Offline Store (Parquet)" (blue): "Batch reads for training", "Historical features", "Feature drift analysis"
- Tooltips explaining online vs offline use cases

**2. Create index.ts barrel export:**

```typescript
// Lesson 01
export { AtLeastOnceVsExactlyOnceDiagram, RebalancingSequenceDiagram } from './AdvancedConsumerDiagrams';

// Lesson 02
export { CdcEventStructureDiagram } from './PandasIntegrationDiagrams';

// Lesson 03
export { PandasVsPyflinkComparisonDiagram, PyflinkCdcArchitectureDiagram } from './PyflinkConnectorDiagrams';

// Lesson 04
export {
  StatefulOperationsDiagram,
  OutOfOrderEventsSequenceDiagram,
  WatermarkProgressDiagram,
  TumblingWindowsDiagram,
  SlidingWindowsDiagram,
  SessionWindowsDiagram,
  TemporalJoinSequenceDiagram,
  StateGrowthDiagram
} from './PyflinkStatefulDiagrams';

// Lesson 05
export {
  PyflinkVsPysparkComparisonDiagram,
  StructuredStreamingConceptDiagram,
  PysparkWatermarkDiagram,
  MicroBatchVsContinuousDiagram
} from './PysparkStreamingDiagrams';

// Lesson 06
export {
  TraditionalEtlDiagram,
  ModernEltDiagram,
  CdcToDataLakeDiagram,
  AppendOnlyHistoryDiagram,
  OperationSeparationDiagram
} from './EtlEltPatternDiagrams';

// Lesson 07
export {
  BatchFeaturesProblemDiagram,
  RealTimeFeaturesPipelineDiagram,
  CustomerBehaviorFeaturesDiagram,
  FeatureStoreArchitectureDiagram
} from './FeatureEngineeringDiagrams';
```
  </action>
  <verify>
- File exists at src/components/diagrams/module6/FeatureEngineeringDiagrams.tsx
- File exists at src/components/diagrams/module6/index.ts
- index.ts exports all 26 diagram components
- No TypeScript errors
  </verify>
  <done>
4 feature engineering diagrams created, barrel export created with all 26 Module 6 diagrams
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate all 7 MDX files to glass components</name>
  <files>
    src/content/course/06-module-6/01-advanced-python-consumer.mdx
    src/content/course/06-module-6/02-pandas-integration.mdx
    src/content/course/06-module-6/03-pyflink-cdc-connector.mdx
    src/content/course/06-module-6/04-pyflink-stateful-processing.mdx
    src/content/course/06-module-6/05-pyspark-structured-streaming.mdx
    src/content/course/06-module-6/06-etl-elt-patterns.mdx
    src/content/course/06-module-6/07-feature-engineering.mdx
  </files>
  <action>
For each MDX file, perform these changes:

**1. Replace Mermaid import with glass component imports:**

Remove:
```tsx
import { Mermaid } from '../../../components/Mermaid.tsx';
```

Add (example for lesson 01):
```tsx
import { AtLeastOnceVsExactlyOnceDiagram, RebalancingSequenceDiagram } from '../../../components/diagrams/module6';
```

**2. Replace each Mermaid block with glass component:**

Remove:
```tsx
<Mermaid chart={`...`} client:visible />
```

Add:
```tsx
<AtLeastOnceVsExactlyOnceDiagram client:load />
```

**Mapping of Mermaid blocks to components per file:**

| File | Mermaid Count | Components |
|------|---------------|------------|
| 01-advanced-python-consumer.mdx | 2 | AtLeastOnceVsExactlyOnceDiagram, RebalancingSequenceDiagram |
| 02-pandas-integration.mdx | 1 | CdcEventStructureDiagram |
| 03-pyflink-cdc-connector.mdx | 2 | PandasVsPyflinkComparisonDiagram, PyflinkCdcArchitectureDiagram |
| 04-pyflink-stateful-processing.mdx | 8 | StatefulOperationsDiagram, OutOfOrderEventsSequenceDiagram, WatermarkProgressDiagram, TumblingWindowsDiagram, SlidingWindowsDiagram, SessionWindowsDiagram, TemporalJoinSequenceDiagram, StateGrowthDiagram |
| 05-pyspark-structured-streaming.mdx | 4 | PyflinkVsPysparkComparisonDiagram, StructuredStreamingConceptDiagram, PysparkWatermarkDiagram, MicroBatchVsContinuousDiagram |
| 06-etl-elt-patterns.mdx | 5 | TraditionalEtlDiagram, ModernEltDiagram, CdcToDataLakeDiagram, AppendOnlyHistoryDiagram, OperationSeparationDiagram |
| 07-feature-engineering.mdx | 4 | BatchFeaturesProblemDiagram, RealTimeFeaturesPipelineDiagram, CustomerBehaviorFeaturesDiagram, FeatureStoreArchitectureDiagram |

**IMPORTANT:**
- Use `client:load` directive (not `client:visible`) for React hydration
- Import path: `../../../components/diagrams/module6` (3 levels up from MDX)
- Place component where Mermaid block was (maintain document flow)
- Keep any surrounding text/context unchanged
  </action>
  <verify>
- All 7 MDX files updated
- No Mermaid imports remain: `grep -r "Mermaid" src/content/course/06-module-6/`
- No Mermaid chart blocks remain: `grep -r "Mermaid chart" src/content/course/06-module-6/`
- All glass component imports present
- Dev server renders all 7 lessons without errors: `npm run dev`
  </verify>
  <done>
All 7 Module 6 MDX files migrated from Mermaid to glass components, zero Mermaid code blocks remain
  </done>
</task>

</tasks>

<verification>
- FeatureEngineeringDiagrams.tsx exists with 4 diagrams
- index.ts exists with all 26 diagram exports
- All 7 MDX files import from '../../../components/diagrams/module6'
- Zero Mermaid imports in Module 6: `grep -c "Mermaid" src/content/course/06-module-6/*.mdx` returns 0
- Zero Mermaid chart blocks: `grep -c "Mermaid chart" src/content/course/06-module-6/*.mdx` returns 0
- Dev server starts without errors
- All 7 lessons render correctly with interactive diagrams
- TypeScript compiles without errors
</verification>

<success_criteria>
- 4 feature engineering diagrams created
- Barrel export includes all 26 diagrams
- All 7 MDX files use glass components
- Zero Mermaid code in Module 6
- All diagrams render with tooltips
- Requirements MOD6-01 through MOD6-04 complete
- Module 6 diagram migration 100% complete
</success_criteria>

<output>
After completion, create `.planning/phases/33-module-6-diagram-migration/33-04-SUMMARY.md`
</output>
