---
phase: 02-navigation-roadmap
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/CourseRoadmap.tsx
autonomous: true

must_haves:
  truths:
    - "Students see a visual flowchart showing course progression"
    - "Students can click roadmap nodes to navigate to specific lessons"
    - "Roadmap renders with dark theme matching site design"
  artifacts:
    - path: "src/components/CourseRoadmap.tsx"
      provides: "Interactive Mermaid flowchart roadmap"
      exports: ["CourseRoadmap"]
      min_lines: 50
  key_links:
    - from: "src/components/CourseRoadmap.tsx"
      to: "mermaid"
      via: "mermaid.render with click callbacks"
      pattern: "securityLevel.*loose"
    - from: "src/components/CourseRoadmap.tsx"
      to: "/course/*"
      via: "click navigation URLs in Mermaid syntax"
      pattern: "click.*\"/course/"
---

<objective>
Create an interactive visual roadmap component using Mermaid flowcharts with clickable nodes for course navigation.

Purpose: The roadmap provides visual course overview - students see the learning path and can click any module to jump directly to it. This addresses PLAT-01 (interactive roadmap) and PLAT-02 (clickable navigation).
Output: `src/components/CourseRoadmap.tsx` React component that renders Mermaid flowchart with click-to-navigate functionality.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-navigation-roadmap/02-RESEARCH.md

# Existing Mermaid component (for reference, not reuse - different purpose)
@src/components/Mermaid.tsx

# Navigation utility for module data
@src/utils/navigation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CourseRoadmap component with interactive Mermaid flowchart</name>
  <files>src/components/CourseRoadmap.tsx</files>
  <action>
Create `src/components/CourseRoadmap.tsx`:

1. Define props interface (must be JSON-serializable for Astro islands):
```typescript
interface RoadmapLesson {
  title: string;
  slug: string;
}

interface CourseRoadmapProps {
  lessons: RoadmapLesson[];  // Flat array, not Map (serialization)
}
```

2. Create functional component that:
   - Uses `useEffect` to render Mermaid diagram after mount
   - Uses `useRef` for container element
   - Uses `useState` to store rendered SVG
   - Generates Mermaid flowchart syntax dynamically from lessons array

3. Mermaid initialization (CRITICAL - research finding):
```typescript
mermaid.initialize({
  startOnLoad: false,
  theme: 'dark',
  securityLevel: 'loose',  // REQUIRED for click events to work
  themeVariables: {
    primaryColor: '#3b82f6',
    primaryTextColor: '#e5e7eb',
    primaryBorderColor: '#60a5fa',
    lineColor: '#9ca3af',
    background: '#1f2937',
  },
});
```

4. Generate flowchart syntax:
   - Create node for each lesson: `N0["Lesson Title"]`
   - Connect nodes sequentially: `N0 --> N1 --> N2`
   - Add click handlers: `click N0 "/course/01-intro"`
   - Add color styling per node (use color rotation for visual variety)

Example generated syntax:
```
flowchart TB
    N0["Введение в CDC"]
    N1["Настройка Debezium"]

    N0 --> N1

    click N0 "/course/01-intro"
    click N1 "/course/02-setup"

    style N0 fill:#3b82f6
    style N1 fill:#10b981
```

5. Render using `mermaid.render()`:
```typescript
const id = `roadmap-${Math.random().toString(36).substring(7)}`;
const { svg } = await mermaid.render(id, chartSyntax);
setSvg(svg);
```

6. Display with `dangerouslySetInnerHTML={{ __html: svg }}`

7. Add wrapper styling:
   - Heading: "Карта курса" (Russian)
   - Container: `my-8`, centered content
   - SVG wrapper: flex justify-center, add overflow-x-auto for mobile

AVOID:
- Using the existing Mermaid.tsx (designed for inline MDX diagrams, not interactive roadmaps)
- Forgetting `securityLevel: 'loose'` (clicks won't work silently)
- Using Map in props (not serializable - convert to array in parent)
  </action>
  <verify>
    - `cat src/components/CourseRoadmap.tsx` shows component
    - Component has `securityLevel: 'loose'` in mermaid.initialize
    - Component generates click handlers in Mermaid syntax
    - Component handles empty lessons array gracefully
    - TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
    - CourseRoadmap.tsx created with Mermaid flowchart generation
    - Click events enabled via securityLevel: 'loose'
    - Nodes link to /course/{slug} paths
    - Dark theme matches site design
    - Ready for integration in landing page (Plan 04)
  </done>
</task>

</tasks>

<verification>
After task completion:
1. `npm run build` completes without errors
2. Component exists and exports correctly
3. TypeScript compiles: `npx tsc --noEmit`
4. Mermaid syntax generation produces valid flowchart (manual review of generated string)
</verification>

<success_criteria>
- CourseRoadmap renders interactive Mermaid flowchart
- Click events work (securityLevel: 'loose' configured)
- Nodes navigate to correct course URLs
- Visual styling matches dark theme
- Ready for landing page integration in Plan 04
</success_criteria>

<output>
After completion, create `.planning/phases/02-navigation-roadmap/02-03-SUMMARY.md`
</output>
