---
phase: 32-module-5-diagram-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/diagrams/module5/SmtOverviewDiagrams.tsx
  - src/components/diagrams/module5/PredicateFilterDiagrams.tsx
  - src/components/diagrams/module5/PiiMaskingDiagrams.tsx
autonomous: true

must_haves:
  truths:
    - "SMT chain diagrams render with horizontal FlowNode layout and color-coded transformation types"
    - "Predicate evaluation diagrams show TRUE/FALSE decision paths with nested FlowNodes"
    - "User can click transformation nodes to see Russian tooltip explanations"
    - "All 10 diagrams render without console errors"
  artifacts:
    - path: "src/components/diagrams/module5/SmtOverviewDiagrams.tsx"
      provides: "5 diagram components for lesson 01"
      exports: ["ConsumerComplexityDiagram", "SmtSolutionDiagram", "SmtExecutionModelDiagram", "SmtChainOrderDiagram", "SmtDecisionFrameworkDiagram"]
    - path: "src/components/diagrams/module5/PredicateFilterDiagrams.tsx"
      provides: "3 diagram components for lesson 02"
      exports: ["PredicateEvaluationDiagram", "PredicateCombinationDiagram", "FilterDecisionTreeDiagram"]
    - path: "src/components/diagrams/module5/PiiMaskingDiagrams.tsx"
      provides: "2 diagram components for lesson 03"
      exports: ["MaskFieldTransformDiagram", "UnwrapComparisonDiagram"]
  key_links:
    - from: "SmtOverviewDiagrams.tsx"
      to: "primitives"
      via: "import from ../primitives"
      pattern: "from ['\"]\\.\\.\/primitives['\"]"
    - from: "All diagrams"
      to: "DiagramTooltip"
      via: "Tooltip wrapper for FlowNode"
      pattern: "<DiagramTooltip.*content="
---

<objective>
Create glass diagram components for Module 5 lessons 01-03 (SMT Fundamentals).

Purpose: Replace 10 Mermaid diagrams with interactive React components using established primitives. SMT chains visualize transformation pipelines (Filter -> Unwrap -> Route -> Mask) as horizontal FlowNode chains with color-coded types.

Output:
- SmtOverviewDiagrams.tsx with 5 diagrams (consumer complexity, SMT solution, execution model, chain order, decision framework)
- PredicateFilterDiagrams.tsx with 3 diagrams (predicate evaluation, combination, filter decision tree)
- PiiMaskingDiagrams.tsx with 2 diagrams (MaskField transform, unwrap comparison)
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-module-5-diagram-migration/32-RESEARCH.md

@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx
@src/components/diagrams/module4/index.ts

@src/content/course/05-module-5/01-smt-overview.mdx
@src/content/course/05-module-5/02-predicates-filtering.mdx
@src/content/course/05-module-5/03-pii-masking.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SmtOverviewDiagrams.tsx (5 diagrams)</name>
  <files>src/components/diagrams/module5/SmtOverviewDiagrams.tsx</files>
  <action>
Create SmtOverviewDiagrams.tsx with 5 diagram components matching the Mermaid diagrams in 01-smt-overview.mdx:

1. **ConsumerComplexityDiagram** (Mermaid flowchart LR at line 25):
   - PostgreSQL -> Debezium -> Kafka Topic -> Consumer 1/2/3
   - Consumers colored amber (f59e0b) to show complexity
   - Tooltips explaining the dual complexity problem

2. **SmtSolutionDiagram** (Mermaid flowchart LR at line 48):
   - PostgreSQL -> Debezium -> SMT Chain -> Kafka Topic -> Consumer 1/2/3
   - SMT Chain box colored purple (8b5cf6) showing centralized transformation
   - Consumers colored emerald (10b981) showing simplified parsing

3. **SmtExecutionModelDiagram** (Mermaid flowchart TB at line 76):
   - Vertical flow inside Kafka Connect Worker subgraph
   - Source Connector -> SMT 1: Filter -> SMT 2: ExtractNewRecordState -> SMT 3: MaskField -> Kafka Producer -> Kafka Broker
   - SMT boxes colored blue (3b82f6)
   - Use nested DiagramContainer for "Kafka Connect Worker"

4. **SmtChainOrderDiagram** (Mermaid flowchart LR at line 242):
   - Horizontal chain: Filter (rose) -> Unwrap (blue) -> Route (purple) -> Mask (amber)
   - Color scheme from RESEARCH.md: rose=filter, blue=unwrap, purple=route, amber=mask
   - Each node shows "1. Filter", "2. Unwrap", etc. with subtitle "Работает с envelope"/"Flatten payload"/"Работает с flat data"
   - Arrows labeled: "отфильтрованные события", "flat JSON", "переименованный топик"
   - Detailed Russian tooltips for each transformation

5. **SmtDecisionFrameworkDiagram** (line ~413 decision tree):
   - Convert text decision tree to nested FlowNodes
   - Emerald path for "SMT подходит", purple for "Kafka Streams"
   - Decision nodes: "Работает с одним сообщением?", "Требует состояния?", "Требует external call?", "Overhead менее 10ms?"

Russian tooltips required. Use pattern from RESEARCH.md code examples.
  </action>
  <verify>
- `npm run build` completes without errors
- File exists and exports 5 named functions
- Each component uses DiagramTooltip with Russian content
  </verify>
  <done>
SmtOverviewDiagrams.tsx exports ConsumerComplexityDiagram, SmtSolutionDiagram, SmtExecutionModelDiagram, SmtChainOrderDiagram, SmtDecisionFrameworkDiagram with interactive tooltips
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PredicateFilterDiagrams.tsx (3 diagrams)</name>
  <files>src/components/diagrams/module5/PredicateFilterDiagrams.tsx</files>
  <action>
Create PredicateFilterDiagrams.tsx with 3 diagram components matching Mermaid diagrams in 02-predicates-filtering.mdx:

1. **PredicateEvaluationDiagram** (Mermaid flowchart TB at line 88):
   - Incoming Message -> Predicate "IsDataEvent?" -> TRUE path (Apply SMT) / FALSE path (Skip SMT) -> To Kafka
   - Predicate box colored purple
   - TRUE path uses emerald, FALSE path uses gray
   - Use pattern from RESEARCH.md PredicateEvaluationDiagram example

2. **PredicateCombinationDiagram** (Mermaid flowchart TB at line 289):
   - Shows message flowing through two SMT stages with different predicates
   - SMT1 (unwrap) with predicate IsDataEvent checking "pattern: dbserver1.inventory.*"
   - SMT2 (mask) with predicate IsCustomerTable checking "pattern: .*customers"
   - Nested structure showing predicate evaluation within each SMT stage

3. **FilterDecisionTreeDiagram** (Mermaid flowchart TD at line 445):
   - Decision tree: "Нужна фильтрация?" branching based on conditions
   - Branches: "Условие зависит от содержимого message?" -> NO = Predicate, YES -> "Простое условие?"
   - Terminal nodes: "Используйте Predicate" (emerald), "Filter SMT + Groovy" (blue), "Kafka Streams" (purple)
   - Nested FlowNodes with flex layout for branching

Russian tooltips explaining each predicate type and when to use predicates vs Filter SMT.
  </action>
  <verify>
- `npm run build` completes without errors
- File exists and exports 3 named functions
- Decision tree uses nested FlowNodes with TRUE/FALSE color coding
  </verify>
  <done>
PredicateFilterDiagrams.tsx exports PredicateEvaluationDiagram, PredicateCombinationDiagram, FilterDecisionTreeDiagram with interactive tooltips
  </done>
</task>

<task type="auto">
  <name>Task 3: Create PiiMaskingDiagrams.tsx (2 diagrams)</name>
  <files>src/components/diagrams/module5/PiiMaskingDiagrams.tsx</files>
  <action>
Create PiiMaskingDiagrams.tsx with 2 diagram components. These are NOT from 03-pii-masking.mdx (which has no diagrams), but are supplementary visualizations for the masking concept mentioned in the SMT chain:

1. **MaskFieldTransformDiagram**:
   - Horizontal flow: Input Record -> MaskField SMT -> Output Record
   - Show field values: email "alice@example.com" -> "***MASKED***"
   - Input colored rose (showing sensitive data), Output colored emerald (showing masked)
   - Tooltips explaining MaskField SMT configuration

2. **UnwrapComparisonDiagram**:
   - Side-by-side DiagramContainers comparing Before/After ExtractNewRecordState
   - Before (rose): Complex Debezium envelope structure with before, after, op, source, ts_ms
   - After (emerald, recommended=true): Flat JSON with id, name, __op, __ts_ms
   - Use pattern from RESEARCH.md UnwrapComparisonDiagram example

Both diagrams demonstrate the before/after transformation pattern with side-by-side containers.
Russian tooltips explaining the transformation effect.
  </action>
  <verify>
- `npm run build` completes without errors
- File exists and exports 2 named functions
- Comparison diagrams use side-by-side DiagramContainers
  </verify>
  <done>
PiiMaskingDiagrams.tsx exports MaskFieldTransformDiagram, UnwrapComparisonDiagram showing transformation before/after with interactive tooltips
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds with no errors
2. All 3 component files exist in src/components/diagrams/module5/
3. Total 10 diagram components exported
4. Each diagram has Russian tooltips
5. Color scheme follows RESEARCH.md: rose=filter, blue=unwrap, purple=route, amber=mask
</verification>

<success_criteria>
- 3 component files created with 10 total diagram exports
- All diagrams use FlowNode, Arrow, DiagramContainer, DiagramTooltip primitives
- SMT chain uses horizontal layout with color-coded transformation types
- Decision trees use nested FlowNodes with TRUE/FALSE branching
- Before/after comparisons use side-by-side DiagramContainers
- All tooltips in Russian
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/32-module-5-diagram-migration/32-01-SUMMARY.md`
</output>
