---
phase: 16-advanced-topics-recovery
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/08-module-8/15-ddl-tools-integration.mdx
autonomous: true

must_haves:
  truths:
    - "Learner understands gh-ost and pt-online-schema-change patterns for CDC"
    - "Learner knows helper table naming conventions (_gho, _ghc, _new, _old)"
    - "Learner can configure table.include.list to capture helper tables"
    - "Learner can filter helper table events using SMT (Single Message Transform)"
    - "Learner understands gh-ost vs pt-osc trade-offs for CDC environments"
  artifacts:
    - path: "src/content/course/08-module-8/15-ddl-tools-integration.mdx"
      provides: "DDL tools integration lesson covering gh-ost and pt-online-schema-change"
      min_lines: 450
      contains: ["gh-ost", "pt-online-schema-change", "_gho", "Filter", "transforms"]
  key_links:
    - from: "15-ddl-tools-integration.mdx"
      to: "06-schema-history-recovery.mdx"
      via: "references schema history topic and DDL tracking"
      pattern: "schema.history"
    - from: "15-ddl-tools-integration.mdx"
      to: "01-binlog-architecture.mdx"
      via: "references binlog event processing"
      pattern: "binlog"
---

<objective>
Create DDL tools integration lesson covering gh-ost and pt-online-schema-change patterns for zero-downtime schema changes with CDC

Purpose: Enable learners to perform online schema migrations without breaking CDC pipelines
Output: Lesson 15 in Module 8 with tool comparison, configuration patterns, and filtering strategies
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-advanced-topics-recovery/16-RESEARCH.md

# Existing lessons to reference
@src/content/course/08-module-8/01-binlog-architecture.mdx
@src/content/course/08-module-8/06-schema-history-recovery.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DDL tools integration lesson</name>
  <files>src/content/course/08-module-8/15-ddl-tools-integration.mdx</files>
  <action>
Create comprehensive lesson on integrating online DDL tools with Debezium MySQL CDC with the following sections:

1. **Introduction** - The DDL Problem in CDC
   - Standard ALTER TABLE = table lock = application downtime
   - Large tables (100GB+) = minutes to hours of lock
   - Online DDL tools: zero-downtime schema changes
   - But: They create helper tables that Debezium captures
   - Challenge: How to handle helper table events in CDC pipeline?

2. **Online DDL Tools Overview**
   - gh-ost (GitHub Online Schema Change):
     * Triggerless, reads binlog directly
     * Creates `_tablename_gho` (ghost table) and `_tablename_ghc` (changelog)
     * Copies data from original to ghost, applies binlog changes
     * Atomic rename at end
   - pt-online-schema-change (Percona Toolkit):
     * Trigger-based approach
     * Creates `_tablename_new` for new schema
     * Uses triggers to copy changes during migration
     * Atomic rename, drops `_tablename_old`
   - Include Mermaid diagram showing both tool workflows

3. **gh-ost vs pt-osc for CDC** (from 16-RESEARCH.md Open Questions)
   - Feature comparison table:

   | Feature | gh-ost | pt-osc |
   |---------|--------|--------|
   | Mechanism | Binlog reading | Triggers |
   | Helper tables | _gho, _ghc | _new, _old |
   | Foreign keys | No support | Supported |
   | Binlog impact | Reads same binlog as Debezium | No binlog reading |
   | CDC event volume | Higher (ghost table events) | Lower (original only) |
   | Throttling | Built-in, replica-aware | Manual configuration |

   - Warning callout: gh-ost doubles binlog read load during migration

4. **The Helper Table Problem** (from 16-RESEARCH.md Pitfall 5)
   - If helper tables not in table.include.list:
     * Connector sees binlog events for unknown tables
     * Error: "Table _orders_gho not found in schema history"
     * Connector crashes mid-migration
   - If helper tables captured but not filtered:
     * Consumers receive events from temporary tables
     * Duplicate data (original + ghost)
     * Confusion in downstream systems

5. **Pattern 1: Broad Capture + SMT Filter** (from 16-RESEARCH.md Pattern 4)
   - Step 1: Use broad table.include.list pattern
   ```json
   "table.include.list": "mydb.*"
   ```
   - Step 2: Configure Filter SMT to exclude helper tables
   ```json
   {
     "transforms": "FilterHelperTables",
     "transforms.FilterHelperTables.type": "io.debezium.transforms.Filter",
     "transforms.FilterHelperTables.language": "jsr223.groovy",
     "transforms.FilterHelperTables.condition": "!value.source.table.matches('.*_(gho|ghc|new|old)$')"
   }
   ```
   - Filter regex explained:
     * `_gho$` - gh-ost ghost table
     * `_ghc$` - gh-ost changelog table
     * `_new$` - pt-osc new table
     * `_old$` - pt-osc old table (post-rename)
   - Tip callout: Filter happens before producer, saves Kafka storage

6. **Pattern 2: Dynamic Include List** (alternative approach)
   - Before migration: add helper tables to include list
   ```json
   "table.include.list": "mydb.orders,mydb.users,mydb._orders_gho,mydb._orders_ghc"
   ```
   - After migration: remove helper tables
   - Drawback: requires connector config update
   - Use case: when you need fine-grained control over which tables

7. **gh-ost Integration Walkthrough** (from 16-RESEARCH.md Code Examples)
   - Pre-migration connector config (broad capture + filter)
   - gh-ost command:
   ```bash
   gh-ost \
     --host=mysql \
     --user=gh-ost \
     --password=ghp \
     --database=mydb \
     --table=orders \
     --alter="ADD COLUMN status VARCHAR(20)" \
     --assume-rbr \
     --allow-on-master \
     --exact-rowcount \
     --concurrent-rowcount \
     --execute
   ```
   - During migration: Debezium captures events from both tables
   - After migration: helper tables dropped, schema history updated
   - Downstream consumers: only see original table events (filtered)

8. **pt-online-schema-change Integration Walkthrough**
   - pt-osc command:
   ```bash
   pt-online-schema-change \
     --alter="ADD COLUMN priority INT" \
     --execute \
     h=mysql,u=pt-osc,p=ptp,D=mydb,t=orders
   ```
   - During migration: triggers copy data to _orders_new
   - Rename sequence: orders -> _orders_old, _orders_new -> orders
   - Debezium handles schema evolution in schema history topic
   - Note callout: pt-osc uses triggers, not binlog reading

9. **Schema Evolution in Consumers**
   - New column appears after migration completes
   - Consumers must handle schema evolution:
     * Avro with Schema Registry: automatic compatibility
     * JSON: optional field handling
   - Reference Module 4 (schema evolution patterns) if covered
   - Warning callout: incompatible changes (column removal) need consumer coordination

10. **Monitoring During DDL Operations**
    - Watch for connector errors (missing table in schema history)
    - Monitor binlog lag (may spike during gh-ost reads)
    - Check Kafka topic creation (helper table topics may appear briefly)
    - Verify helper table topics cleaned up after migration

11. **Common Mistakes** (from 16-RESEARCH.md Anti-Patterns)
    - Not including helper tables in capture pattern
    - Forgetting to filter helper table events
    - Running DDL during connector snapshot (locks conflict)
    - Using DDL tools on tables with foreign keys (pt-osc only)

12. **Hands-on Exercise: gh-ost with CDC**
    - Prerequisites: MySQL lab running, connector deployed with broad capture + filter
    - Exercise steps:
      1. Verify current table schema
      2. Run gh-ost migration (add column)
      3. Observe connector logs (capturing _orders_gho events)
      4. Verify Kafka consumer only sees orders table events
      5. Confirm new column in schema after migration
    - Bonus: Check schema history topic for DDL evolution

13. **Summary: DDL Tools Checklist**
    - Pre-migration: Verify broad capture, configure filter SMT
    - During migration: Monitor connector logs and lag
    - Post-migration: Verify schema evolution, clean up helper topics if needed

Use callout components:
- type="danger": Not including helper tables causes connector crash
- type="warning": gh-ost doubles binlog read load during migration
- type="tip": Filter SMT removes helper events before Kafka, saves storage
- type="note": pt-osc supports foreign keys, gh-ost does not

Include Mermaid diagrams:
- gh-ost workflow (original table -> ghost table -> rename)
- pt-osc workflow (original table -> triggers -> new table -> rename)
- CDC event flow with filter SMT

Follow established patterns:
- Russian text / English code
- Pedagogical structure matching prior Module 8 lessons
- Use Callout component: `import Callout from '../../../components/Callout.tsx'`
- Use Mermaid component: `import { Mermaid } from '../../../components/Mermaid.tsx'`

Frontmatter:
```yaml
title: "DDL Tools Integration: gh-ost and pt-online-schema-change"
description: "Zero-downtime schema migrations with Debezium CDC"
---
```
  </action>
  <verify>
Build passes: `cd "/Users/levoely/debezium course" && npm run build`
File exists with min 450 lines
Contains gh-ost, pt-online-schema-change, _gho, Filter, transforms keywords
Mermaid diagrams render correctly
  </verify>
  <done>
Lesson 15 created covering gh-ost and pt-osc patterns, helper table handling, Filter SMT configuration, integration walkthroughs, and hands-on exercises
  </done>
</task>

</tasks>

<verification>
1. Lesson file exists at correct path with proper frontmatter
2. Build passes without errors
3. Both tools (gh-ost, pt-osc) explained with comparison table
4. Helper table patterns documented (_gho, _ghc, _new, _old)
5. Filter SMT configuration with correct regex
6. Integration walkthroughs with complete commands
7. Hands-on exercise executable in Docker lab
</verification>

<success_criteria>
- Learner understands why online DDL tools create CDC challenges
- Learner can configure connector to capture helper tables
- Learner can configure Filter SMT to exclude helper table events
- gh-ost vs pt-osc trade-offs clear for CDC environments
- Hands-on exercise demonstrates complete DDL + CDC workflow
</success_criteria>

<output>
After completion, create `.planning/phases/16-advanced-topics-recovery/16-03-SUMMARY.md`
</output>
