---
phase: 17-multi-database-capstone
plan: 03
type: execute
wave: 2
depends_on: ["17-01", "17-02"]
files_modified:
  - src/content/course/07-module-7/03-self-assessment.mdx
autonomous: true

must_haves:
  truths:
    - "Self-assessment checklist includes multi-database specific criteria"
    - "Learner can verify their multi-database capstone extension meets requirements"
    - "Trade-offs section covers separate vs unified topics decision"
    - "Checklist integrates with existing production readiness criteria"
  artifacts:
    - path: "src/content/course/07-module-7/03-self-assessment.mdx"
      provides: "Extended self-assessment with multi-database checklist"
      contains: "Multi-Database"
  key_links:
    - from: "03-self-assessment.mdx"
      to: "04-multi-database-architecture.mdx"
      via: "Cross-reference for architecture patterns"
      pattern: "module-7/04-multi-database-architecture"
    - from: "03-self-assessment.mdx"
      to: "05-multi-database-configuration.mdx"
      via: "Cross-reference for configuration"
      pattern: "module-7/05-multi-database-configuration"
---

<objective>
Extend the existing self-assessment checklist with a multi-database capstone extension section covering additional criteria for PostgreSQL + MySQL unified pipelines.

Purpose: Provide learners with concrete verification criteria for their multi-database capstone extension. The existing checklist covers single-database (PostgreSQL) production readiness; this adds multi-database considerations.

Output: Updated `src/content/course/07-module-7/03-self-assessment.mdx` with new section
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-multi-database-capstone/17-RESEARCH.md

# File to update
@src/content/course/07-module-7/03-self-assessment.mdx

# New lessons to reference
# Note: These files will be created by Plans 01 and 02
# Reference paths:
# - src/content/course/07-module-7/04-multi-database-architecture.mdx
# - src/content/course/07-module-7/05-multi-database-configuration.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add multi-database capstone extension section to self-assessment</name>
  <files>src/content/course/07-module-7/03-self-assessment.mdx</files>
  <action>
Read the existing 03-self-assessment.mdx file and add a new major section for multi-database capstone extension.

**Location:** Add after the "Common Mistakes" section, before "Final Encouragement"

**New Section Title:** `## Multi-Database Capstone Extension (Optional)`

**Introduction paragraph:**
Explain that learners who completed Module 8 (MySQL) can extend their capstone with a second database source. Reference the new lessons:
- [Multi-Database Architecture](/course/module-7/04-multi-database-architecture) for patterns
- [Multi-Database Configuration](/course/module-7/05-multi-database-configuration) for implementation

**Add Section 8: Multi-Database Integration**

```markdown
### Section 8: Multi-Database Integration (Extension)

Эта секция применима, если вы расширяете capstone проект с добавлением MySQL как второго источника.

- [ ] **MySQL outbox table** создана с аналогичной схемой PostgreSQL
  - Проверка: MySQL outbox содержит `id`, `aggregatetype`, `aggregateid`, `type`, `payload`, `created_at`
  - Тип `payload`: JSON (не JSONB как в PostgreSQL)

- [ ] **MySQL connector** настроен с уникальными идентификаторами:
  - [ ] `database.server.id` уникален (не конфликтует с MySQL server_id)
    - Рекомендация: диапазон 184000-184999 для Debezium коннекторов
  - [ ] `database.server.name` уникален (отличается от PostgreSQL коннектора)
    - Пример: `mysql_prod` vs `postgres_prod`
  - [ ] `schema.history.internal.kafka.topic` уникален
    - Пример: `schema-changes.mysql-outbox`
    - **CRITICAL:** Никогда не используйте общий topic между MySQL коннекторами

- [ ] **Topic naming scheme** унифицирована:
  - PostgreSQL: `outbox.event.postgres.{aggregate}`
  - MySQL: `outbox.event.mysql.{aggregate}`
  - Проверка: `kafka-topics --list` показывает топики от обоих источников

- [ ] **PyFlink consumer** обрабатывает события от обоих источников:
  - [ ] Две Kafka source таблицы (PostgreSQL + MySQL)
  - [ ] `UNION ALL` для объединения потоков
  - [ ] `source_database` колонка для трассировки происхождения
  - Проверка: downstream sink содержит события от обоих источников

- [ ] **Мониторинг** включает метрики от обоих коннекторов:
  - PostgreSQL: WAL lag через `pg_replication_slots`
  - MySQL: `MilliSecondsBehindSource` через JMX
  - Grafana dashboard показывает оба источника

- [ ] **Trade-offs документированы:**
  - [ ] Выбор между separate topics и unified topics обоснован
  - [ ] Schema evolution strategy для каждого источника описана
  - [ ] Runbook включает recovery procedures для обоих типов коннекторов
```

**Add new scoring criteria for multi-database:**

After the existing scoring rubric, add:

```markdown
### Multi-Database Extension Scoring

Если вы реализуете multi-database extension:

**Exemplary Multi-Database:**
- Оба коннектора работают стабильно с unique identifiers
- PyFlink consumer корректно обрабатывает оба потока
- Monitoring dashboard показывает метрики от обоих источников
- Documentation включает architecture diagram с обоими источниками
- Tested: failover одного источника не влияет на другой

**Meets Expectations Multi-Database:**
- Оба коннектора deployed и RUNNING
- Events от обоих источников попадают в unified consumer
- Basic monitoring работает
- Documentation упоминает multi-database setup
```

**Russian text / English code convention applies.**
  </action>
  <verify>
File contains "## Multi-Database Capstone Extension" section
File contains "Section 8: Multi-Database Integration" checklist
File contains checklist items for:
  - MySQL outbox table
  - MySQL connector unique identifiers
  - Topic naming scheme
  - PyFlink UNION ALL consumer
  - Monitoring both sources
  - Trade-offs documentation
File references /course/module-7/04-multi-database-architecture
File references /course/module-7/05-multi-database-configuration
  </verify>
  <done>
Self-assessment checklist extended with multi-database capstone section including verification criteria
  </done>
</task>

<task type="auto">
  <name>Task 2: Add multi-database common mistakes and update key takeaways</name>
  <files>src/content/course/07-module-7/03-self-assessment.mdx</files>
  <action>
Add multi-database specific common mistakes to the "Common Mistakes" section and update key takeaways.

**Add to Common Mistakes section (after existing mistakes 1-6):**

```markdown
### 7. Shared Schema History Topic (Multi-Database)

**Ошибка:** Два MySQL коннектора используют один `schema.history.internal.kafka.topic` — DDL от одного коннектора "загрязняет" историю другого.

**Симптомы:**
- Коннектор падает с "schema mismatch" ошибками после DDL изменений в другой базе
- Unexpected table definitions в schema history
- Recovery после restart не работает

**Fix:**
```json
// Connector 1
"schema.history.internal.kafka.topic": "schema-changes.mysql-connector-1"

// Connector 2
"schema.history.internal.kafka.topic": "schema-changes.mysql-connector-2"
```

**Prevention:** Каждый MySQL коннектор должен иметь уникальный schema history topic.

### 8. Duplicate database.server.name (Multi-Database)

**Ошибка:** PostgreSQL и MySQL коннекторы используют одинаковый `database.server.name` — события перезаписывают друг друга в одних топиках.

**Симптомы:**
- События от одного источника "пропадают"
- Kafka topic содержит смешанные события без возможности различить источник
- Consumer processing fails с unexpected schema

**Fix:**
```json
// PostgreSQL connector
"database.server.name": "postgres_prod"

// MySQL connector
"database.server.name": "mysql_prod"
```

**Prevention:** Используйте naming convention: `{database_type}_{environment}`.

### 9. Ignoring Connector-Specific Recovery (Multi-Database)

**Ошибка:** Применение PostgreSQL recovery procedures к MySQL коннектору или наоборот.

**Симптомы:**
- Recovery не работает ("slot not found" для MySQL, "binlog not found" для PostgreSQL)
- Resnapshot triggers unexpectedly
- Data loss после failover

**Key differences:**
| Recovery Scenario | PostgreSQL | MySQL |
|-------------------|------------|-------|
| Position loss | Recreate slot + resnapshot | Backup schema history + resnapshot |
| WAL/binlog purge | Increase wal_keep_size | Increase binlog retention (Aurora: stored procedure) |
| Connector restart | Automatic (slot preserves position) | Automatic (GTID or offset) |

**Prevention:** Документируйте runbook procedures отдельно для каждого типа коннектора.
```

**Update Key Takeaways section** (at the end of the file):

Add these points to the existing key takeaways list:

```markdown
11. **Multi-database extension** требует unique identifiers для каждого коннектора: `database.server.id`, `database.server.name`, `schema.history.internal.kafka.topic`
12. **Schema history topic sharing** — критическая ошибка для MySQL multi-connector deployments
13. **Recovery procedures различаются:** PostgreSQL использует replication slots, MySQL использует schema history topic + GTID/binlog position
14. **Unified consumer** должен отслеживать `source_database` для трассировки происхождения событий
```

Ensure the added content flows naturally with existing content style.
  </action>
  <verify>
File contains "### 7. Shared Schema History Topic" mistake
File contains "### 8. Duplicate database.server.name" mistake
File contains "### 9. Ignoring Connector-Specific Recovery" mistake
File contains recovery comparison table
Key takeaways section includes multi-database points (11-14)
Run: npm run build (should pass)
  </verify>
  <done>
Self-assessment fully updated with multi-database common mistakes and expanded key takeaways
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. File updated: src/content/course/07-module-7/03-self-assessment.mdx
2. Contains Section 8: Multi-Database Integration checklist
3. Contains common mistakes 7-9 for multi-database scenarios
4. Contains recovery comparison table
5. Key takeaways include multi-database points
6. References to new lessons (04, 05) present
7. Build passes: `npm run build`
</verification>

<success_criteria>
- Learner extending capstone with MySQL has clear verification checklist
- Multi-database specific pitfalls are documented with fixes
- Recovery differences between PostgreSQL and MySQL are explicit
- Scoring criteria for multi-database extension is defined
- Content integrates seamlessly with existing self-assessment structure
</success_criteria>

<output>
After completion, create `.planning/phases/17-multi-database-capstone/17-03-SUMMARY.md`
</output>
