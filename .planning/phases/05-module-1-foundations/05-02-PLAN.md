---
phase: 05-module-1-foundations
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/content/course/module-1/03-lab-setup.mdx
  - src/content/course/module-1/04-first-connector.mdx
autonomous: true

must_haves:
  truths:
    - "Lab environment services are healthy and accessible via documented ports"
    - "PostgreSQL connector deploys successfully and captures changes to Kafka topic"
  artifacts:
    - path: "src/content/course/module-1/03-lab-setup.mdx"
      provides: "Lab environment setup instructions with Docker Compose"
      contains: "docker compose up"
      min_lines: 180
    - path: "src/content/course/module-1/04-first-connector.mdx"
      provides: "PostgreSQL connector deployment guide"
      contains: "inventory-connector"
      min_lines: 220
  key_links:
    - from: "src/content/course/module-1/03-lab-setup.mdx"
      to: "labs/docker-compose.yml"
      via: "reference to labs directory with correct ports"
      pattern: "5433.*PostgreSQL|POSTGRES_PORT"
    - from: "src/content/course/module-1/04-first-connector.mdx"
      to: "Kafka Connect REST API"
      via: "curl commands with correct port"
      pattern: "localhost:8083"
---

<objective>
Create the hands-on lab lessons: Lab Setup and First Connector deployment.

Purpose: Students transition from theory to practice. These lessons walk through starting the Docker environment and deploying their first working PostgreSQL connector.

Output: Two MDX lesson files with step-by-step instructions, terminal commands, and verification steps.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/05-module-1-foundations/05-RESEARCH.md

# Lab environment reference - MUST verify ports match
@labs/docker-compose.yml
@labs/.env
@labs/README.md

# Existing content patterns
@src/content/course/01-intro/index.mdx
@src/content/config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Lab Setup Lesson</name>
  <files>src/content/course/module-1/03-lab-setup.mdx</files>
  <action>
Create the lab setup lesson with these sections:

**Frontmatter:**
```yaml
title: "Настройка лабораторного окружения"
description: "Запуск Docker Compose стека с PostgreSQL, Kafka, Debezium Connect и мониторингом"
order: 3
difficulty: "beginner"
estimatedTime: 15
topics: ["Docker", "Lab Environment", "Kafka", "PostgreSQL"]
prerequisites: ["module-1/02-debezium-architecture"]
```

**CRITICAL - Port numbers MUST match labs/.env:**
- PostgreSQL: 5433 (external), 5432 (internal)
- Kafka: 9092
- Kafka Connect: 8083
- Schema Registry: 8081
- JupyterLab: 8888
- Grafana: 3000
- Prometheus: 9090

**Content structure:**
1. **Prerequisites check:**
   - Docker Desktop installed (check with `docker --version`)
   - At least 8GB RAM allocated to Docker
   - Ports available: 5433 (PostgreSQL), 9092 (Kafka), 8083 (Connect), 8888 (JupyterLab)
   - Note: PostgreSQL uses 5433 externally (5432 often in use)

2. **Clone and navigate:**
   ```bash
   cd labs/
   ```

3. **Start the stack:**
   ```bash
   docker compose up -d
   ```

4. **Verify all services running:**
   ```bash
   docker compose ps
   ```
   Show expected output with 7 services healthy.

5. **Service verification commands (table format):**
   | Service | URL/Command | Expected Result |
   |---------|-------------|-----------------|
   | PostgreSQL | `docker compose exec postgres psql -U postgres -c "SHOW wal_level;"` | `logical` |
   | Kafka | `docker compose exec kafka kafka-topics --bootstrap-server localhost:9092 --list` | Empty or system topics |
   | Connect | `curl http://localhost:8083/` | JSON with version info |
   | JupyterLab | http://localhost:8888 | JupyterLab interface |
   | Grafana | http://localhost:3000 | Login page (admin/admin) |

6. **Common issues and solutions:**
   - Port already in use: Stop conflicting service or change port in .env
   - ARM64 compatibility: All images tested on Apple Silicon
   - Memory issues: Increase Docker Desktop RAM allocation

7. **Stopping the environment:**
   ```bash
   docker compose down        # Stop containers
   docker compose down -v     # Stop and remove volumes (clean slate)
   ```

8. **Quick reference box:** Summary of key URLs and ports for later lessons

**Important notes:**
- Reference the actual labs/ directory structure
- Use correct port numbers from labs/.env (5433, 9092, 8083, 8888, 3000, 9090)
- Mention that data persists in Docker volumes between sessions
  </action>
  <verify>
1. File exists at src/content/course/module-1/03-lab-setup.mdx
2. Contains docker compose commands (up, down, ps)
3. Lists all 7 services with verification commands
4. **Port verification against labs/.env:**
   - PostgreSQL external port is 5433 (not 5432)
   - Kafka port is 9092
   - Connect port is 8083
   - JupyterLab port is 8888
5. Has troubleshooting section
6. Run `npm run build` - no errors
7. **Critical:** Start labs environment with `docker compose up -d` in labs/ directory and verify lesson instructions work
  </verify>
  <done>
Lesson file exists with complete Docker Compose setup instructions. All port numbers match labs/.env (PostgreSQL 5433, Kafka 9092, Connect 8083, JupyterLab 8888). Service verification commands and troubleshooting guide included.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create First Connector Lesson</name>
  <files>src/content/course/module-1/04-first-connector.mdx</files>
  <action>
Create the first connector lesson with step-by-step PostgreSQL connector deployment:

**Frontmatter:**
```yaml
title: "Первый Debezium коннектор"
description: "Пошаговое развертывание PostgreSQL коннектора через Kafka Connect REST API"
order: 4
difficulty: "beginner"
estimatedTime: 25
topics: ["Debezium", "PostgreSQL", "Kafka Connect", "REST API"]
prerequisites: ["module-1/03-lab-setup"]
```

**Content structure (streamlined to essential steps):**

1. **Prepare test data:**
   Create customers table and insert sample data:
   ```bash
   docker compose exec postgres psql -U postgres -d inventory -c "
   CREATE TABLE IF NOT EXISTS customers (
     id SERIAL PRIMARY KEY,
     name VARCHAR(100) NOT NULL,
     email VARCHAR(100) UNIQUE NOT NULL,
     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );

   INSERT INTO customers (name, email) VALUES
     ('Иван Петров', '[email protected]'),
     ('Мария Сидорова', '[email protected]');
   "
   ```

2. **Check Kafka Connect is ready:**
   ```bash
   curl -s http://localhost:8083/connectors | jq .
   ```
   Should return empty array `[]`

3. **Deploy the connector:**
   Full curl command with JSON config:
   ```bash
   curl -X POST http://localhost:8083/connectors \
     -H "Content-Type: application/json" \
     -d '{
       "name": "inventory-connector",
       "config": {
         "connector.class": "io.debezium.connector.postgresql.PostgresConnector",
         "database.hostname": "postgres",
         "database.port": "5432",
         "database.user": "postgres",
         "database.password": "postgres",
         "database.dbname": "inventory",
         "topic.prefix": "inventory",
         "table.include.list": "public.customers",
         "plugin.name": "pgoutput",
         "slot.name": "debezium_customers",
         "publication.name": "dbz_publication"
       }
     }'
   ```
   **IMPORTANT:** database.port is 5432 (internal Docker port), not 5433 (external host port).

4. **Config field explanation (table format):**
   | Field | Value | Purpose |
   |-------|-------|---------|
   | database.hostname | postgres | Docker service name (internal) |
   | database.port | 5432 | Internal port (NOT 5433 external) |
   | topic.prefix | inventory | Kafka topic prefix (topic = prefix.schema.table) |
   | table.include.list | public.customers | Which tables to capture |
   | plugin.name | pgoutput | Built-in logical decoding plugin |
   | slot.name | debezium_customers | Unique replication slot name |

5. **Verify connector running:**
   ```bash
   curl -s http://localhost:8083/connectors/inventory-connector/status | jq .
   ```
   Check for "state": "RUNNING"

6. **Verify Kafka topic and consume events:**
   ```bash
   # List topics
   docker compose exec kafka kafka-topics --bootstrap-server localhost:9092 --list

   # Consume snapshot events
   docker compose exec kafka kafka-console-consumer \
     --bootstrap-server localhost:9092 \
     --topic inventory.public.customers \
     --from-beginning \
     --max-messages 2
   ```

7. **Test live change capture:**
   ```bash
   docker compose exec postgres psql -U postgres -d inventory -c "
   INSERT INTO customers (name, email) VALUES ('Алексей Козлов', '[email protected]');
   "
   ```
   Watch for new event with op: "c"

8. **Mermaid sequence diagram:** Show flow: INSERT -> WAL -> Debezium -> Kafka Topic

**Common pitfalls to address:**
- Connector name must be unique across cluster
- database.hostname is Docker internal name, not localhost
- database.port is internal (5432), not external (5433)
- table.include.list uses schema.table format
  </action>
  <verify>
1. File exists at src/content/course/module-1/04-first-connector.mdx
2. Contains complete curl command for connector deployment
3. Explains each config field (especially internal vs external ports)
4. Shows verification steps (status, topics, consumer)
5. Includes live change test (INSERT and see event)
6. Has Mermaid diagram for event flow
7. Run `npm run build` - no errors
8. **Test connector config against running environment:**
   - Start labs with `docker compose up -d`
   - Deploy connector using the JSON from lesson
   - Verify connector status is RUNNING
   - Verify topic inventory.public.customers exists
  </verify>
  <done>
Lesson file exists with complete step-by-step connector deployment. Config uses correct Docker internal hostnames (postgres, kafka) and ports (5432 internal, not 5433 external). Includes verification commands and live change capture demonstration.
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `ls src/content/course/module-1/` shows 03-lab-setup.mdx and 04-first-connector.mdx
2. `npm run build` succeeds
3. Lab setup lesson references correct ports from labs/.env (5433, 9092, 8083, etc.)
4. Connector lesson uses correct internal ports (database.port: 5432, not 5433)
5. Both lessons have prerequisites referencing previous lessons
6. **Integration test:** Deploy connector using lesson instructions against running labs stack
</verification>

<success_criteria>
- Two lesson files created with valid frontmatter
- Lab setup covers complete Docker Compose workflow with correct ports
- Connector lesson provides copy-pasteable commands that work with labs/docker-compose.yml
- All port numbers verified against labs/.env
- Students can follow along and see CDC events in Kafka
</success_criteria>

<output>
After completion, create `.planning/phases/05-module-1-foundations/05-02-SUMMARY.md`
</output>
