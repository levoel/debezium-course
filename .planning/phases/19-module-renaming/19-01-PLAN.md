---
phase: 19-module-renaming
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/03-module-3/
  - src/content/course/04-module-4/
  - src/content/course/05-module-5/
  - src/content/course/06-module-6/
  - src/content/course/07-module-7/
  - src/content/course/08-module-8/
autonomous: true

must_haves:
  truths:
    - "Module 08 (MySQL) directory is now 03-module-3"
    - "Former modules 03-07 are now 04-08 respectively"
    - "Navigation shows MySQL as Module 03"
    - "Site builds successfully with zero errors"
  artifacts:
    - path: "src/content/course/03-module-3/"
      provides: "MySQL module content (formerly 08-module-8)"
      contains: "mysql"
    - path: "src/content/course/04-module-4/"
      provides: "Production Operations (formerly 03-module-3)"
    - path: "src/content/course/05-module-5/"
      provides: "Advanced Patterns (formerly 04-module-4)"
    - path: "src/content/course/06-module-6/"
      provides: "Data Engineering (formerly 05-module-5)"
    - path: "src/content/course/07-module-7/"
      provides: "Cloud-Native (formerly 06-module-6)"
    - path: "src/content/course/08-module-8/"
      provides: "Capstone (formerly 07-module-7)"
  key_links:
    - from: "src/utils/navigation.ts"
      to: "src/content/course/*"
      via: "getCollection('course') auto-discovery"
      pattern: "extractModuleId"
---

<objective>
Renumber module directories so MySQL (08) becomes Module 3, shifting existing modules 03-07 to positions 04-08.

Purpose: Course reorganization for v1.2 - grouping database-specific content (PostgreSQL Module 2, MySQL Module 3) together for better learning flow.

Output: All module directories renamed with Git history preserved, site builds successfully.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-module-renaming/19-RESEARCH.md
@src/utils/navigation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clear cache and rename directories via two-stage git mv</name>
  <files>
    src/content/course/03-module-3/
    src/content/course/04-module-4/
    src/content/course/05-module-5/
    src/content/course/06-module-6/
    src/content/course/07-module-7/
    src/content/course/08-module-8/
  </files>
  <action>
Execute two-stage directory rename to avoid filesystem collisions:

1. Clear Astro cache FIRST (prevents stale path references):
   ```bash
   rm -rf .astro/
   ```

2. Stage 1 - Move modules 03-07 to temporary names (reverse order to avoid conflicts):
   ```bash
   git mv src/content/course/07-module-7 src/content/course/07-module-7-temp
   git mv src/content/course/06-module-6 src/content/course/06-module-6-temp
   git mv src/content/course/05-module-5 src/content/course/05-module-5-temp
   git mv src/content/course/04-module-4 src/content/course/04-module-4-temp
   git mv src/content/course/03-module-3 src/content/course/03-module-3-temp
   ```

3. Move MySQL (08) to position 03:
   ```bash
   git mv src/content/course/08-module-8 src/content/course/03-module-3
   ```

4. Stage 2 - Rename temp directories to final positions:
   ```bash
   git mv src/content/course/03-module-3-temp src/content/course/04-module-4
   git mv src/content/course/04-module-4-temp src/content/course/05-module-5
   git mv src/content/course/05-module-5-temp src/content/course/06-module-6
   git mv src/content/course/06-module-6-temp src/content/course/07-module-7
   git mv src/content/course/07-module-7-temp src/content/course/08-module-8
   ```

5. Clear cache again after renames:
   ```bash
   rm -rf .astro/
   ```

IMPORTANT: Do NOT commit yet - Task 2 will verify build first.
  </action>
  <verify>
Run `ls -la src/content/course/` and confirm:
- 03-module-3 contains MySQL content (check for mysql/aurora files)
- 04-module-4 through 08-module-8 exist
- No -temp directories remain
- Run `git status` shows renamed files (not deleted/added)
  </verify>
  <done>
Directory structure is:
- 01-module-1 (unchanged)
- 02-module-2 (unchanged)
- 03-module-3 (MySQL - formerly 08)
- 04-module-4 (Production Ops - formerly 03)
- 05-module-5 (Advanced Patterns - formerly 04)
- 06-module-6 (Data Engineering - formerly 05)
- 07-module-7 (Cloud-Native - formerly 06)
- 08-module-8 (Capstone - formerly 07)
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify build and navigation auto-discovery</name>
  <files>None (verification only)</files>
  <action>
1. Run full build to verify no broken paths:
   ```bash
   npm run build
   ```

2. Verify navigation auto-discovery works correctly by checking build output for module structure.

3. Start dev server and verify navigation displays "Модуль 03" for MySQL:
   ```bash
   npm run dev &
   DEV_PID=$!
   sleep 8
   # Check that MySQL module page contains "Модуль 03" in navigation
   curl -s http://localhost:4321/course/03-module-3/01-binlog-architecture/ | grep -o "Модуль 03" | head -1
   kill $DEV_PID 2>/dev/null
   ```
   Expected: Should output "Модуль 03" confirming navigation auto-discovered new structure.

   If curl doesn't work (e.g., port busy), alternative verification:
   - Check build output in dist/ for correct module numbering
   - Grep dist/course/03-module-3 HTML files for "Модуль 03"

4. If build succeeds AND navigation shows correct module numbers, commit the changes:
   ```bash
   git add -A
   git commit -m "refactor(v1.2): renumber modules - MySQL becomes Module 3

   Directory mapping:
   - 08-module-8 -> 03-module-3 (MySQL moves up)
   - 03-module-3 -> 04-module-4 (Production Ops shifts)
   - 04-module-4 -> 05-module-5 (Advanced Patterns shifts)
   - 05-module-5 -> 06-module-6 (Data Engineering shifts)
   - 06-module-6 -> 07-module-7 (Cloud-Native shifts)
   - 07-module-7 -> 08-module-8 (Capstone shifts)

   Navigation auto-discovers from directory structure - no code changes needed.

   Satisfies: STRUCT-01a, STRUCT-01b"
   ```

Note: Navigation is auto-discovered from directory names via `src/utils/navigation.ts`. Renaming directories automatically updates navigation display to show "Модуль 03" for MySQL. No sidebar configuration updates needed (STRUCT-01b satisfied by directory rename - this is NOT Starlight, navigation uses getCollection auto-discovery).
  </action>
  <verify>
- `npm run build` exits with code 0
- No "Cannot find module" errors in build output
- Navigation displays "Модуль 03" for MySQL (verified via curl or dist/ inspection)
- Commit created successfully
- `git log -1 --oneline` shows the refactor commit
  </verify>
  <done>
- Build completes successfully (0 errors)
- Navigation auto-discovers new module structure and displays "Модуль 03" for MySQL
- Changes committed to git with descriptive message
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. Directory structure verification:
   ```bash
   ls src/content/course/
   ```
   Expected: 01-module-1, 02-module-2, 03-module-3, 04-module-4, 05-module-5, 06-module-6, 07-module-7, 08-module-8

2. MySQL is now Module 3:
   ```bash
   ls src/content/course/03-module-3/
   ```
   Expected: MySQL lesson files (binlog, gtid, aurora, etc.)

3. Build passes:
   ```bash
   npm run build
   ```
   Expected: Build completes with no errors

4. Navigation shows correct module number:
   ```bash
   grep -r "Модуль 03" dist/course/03-module-3/ | head -1
   ```
   Expected: HTML contains "Модуль 03" text

5. Git history preserved:
   ```bash
   git log --oneline --follow -- src/content/course/03-module-3/01-binlog-architecture.mdx | head -5
   ```
   Expected: Shows commit history including pre-rename commits
</verification>

<success_criteria>
- [ ] Module 08 directory renamed to 03-module-3 (MySQL is third module)
- [ ] Modules 03-07 renumbered to 04-08
- [ ] Navigation displays "Модуль 03" for MySQL (auto-discovered from directory structure)
- [ ] Site builds successfully with no errors
- [ ] Git history preserved for renamed files
- [ ] Single atomic commit for all directory renames
</success_criteria>

<output>
After completion, create `.planning/phases/19-module-renaming/19-01-SUMMARY.md`
</output>
