---
phase: 15-production-operations
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/08-module-8/11-gtid-failover-procedures.mdx
autonomous: true

must_haves:
  truths:
    - "Learner understands why GTID mode enables automatic failover (position preservation)"
    - "Learner can verify GTID prerequisites before failover (gtid_mode, enforce_gtid_consistency)"
    - "Learner can execute Aurora MySQL failover with AWS CLI"
    - "Learner knows how to validate connector recovery post-failover"
  artifacts:
    - path: "src/content/course/08-module-8/11-gtid-failover-procedures.mdx"
      provides: "GTID failover procedures lesson with runbook and validation"
      min_lines: 400
      contains: ["gtid_mode", "failover-db-cluster", "SHOW MASTER STATUS"]
  key_links:
    - from: "11-gtid-failover-procedures.mdx"
      to: "02-gtid-mode-fundamentals.mdx"
      via: "references GTID concepts from Phase 12"
      pattern: "gtid_mode=ON"
    - from: "11-gtid-failover-procedures.mdx"
      to: "04-mysql-connector-configuration.mdx"
      via: "references connector configuration for GTID"
      pattern: "gtid.source.includes"
---

<objective>
Create GTID failover procedures lesson covering pre-failover validation, Aurora failover execution, and post-failover connector recovery verification

Purpose: Enable learners to execute MySQL/Aurora MySQL failover without data loss using GTID-based position preservation
Output: Lesson 11 in Module 8 with complete failover runbook
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-production-operations/15-RESEARCH.md

# Prior lessons for cross-references
@src/content/course/08-module-8/02-gtid-mode-fundamentals.mdx
@src/content/course/08-module-8/04-mysql-connector-configuration.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GTID failover procedures lesson</name>
  <files>src/content/course/08-module-8/11-gtid-failover-procedures.mdx</files>
  <action>
Create comprehensive lesson on MySQL/Aurora MySQL GTID-based failover with the following sections:

1. **Introduction** - Why failover matters for CDC (planned maintenance, unexpected failures)
   - GTID vs file:position failover comparison
   - Why GTID eliminates manual position tracking

2. **GTID Failover Prerequisites** (from 15-RESEARCH.md)
   - gtid_mode=ON (not OFF_PERMISSIVE)
   - enforce_gtid_consistency=ON
   - replica_preserve_commit_order=ON (if replica_parallel_workers > 0)
   - SQL verification queries for all prerequisites
   - DB Cluster Parameter Group configuration (reference Phase 14)

3. **Connector Configuration for GTID Failover**
   - gtid.source.includes: ".*" (recommended for Aurora)
   - gtid.source.excludes (when to use)
   - snapshot.mode: when_needed
   - heartbeat.interval.ms: 10000 (mandatory for failover detection)
   - Complete JSON connector config example

4. **Pre-Failover Validation Checklist** (Mermaid checklist diagram)
   - Verify connector is RUNNING (Kafka Connect API)
   - Check current lag (<5 seconds recommended)
   - Verify GTID mode on primary
   - Record current Executed_Gtid_Set
   - Confirm heartbeat events flowing

5. **Failover Execution Procedure**
   - **Planned failover:** aws rds failover-db-cluster command
   - **Unplanned failover:** Aurora automatic failover (1-2 min)
   - Monitor failover progress (aws rds describe-db-clusters)
   - Expected timeline: 1-2 minutes for Aurora Multi-AZ

6. **Post-Failover Validation** (sequence diagram)
   - Connector auto-reconnect (GTID enables automatic position finding)
   - Verify connector state via Kafka Connect API
   - Check GTID continuity (Executed_Gtid_Set on new primary)
   - Monitor lag recovery (should return to <1s in 2-5 min)
   - Verify event flow (kafka-console-consumer)

7. **Multi-Region Aurora GTID Considerations** (from 15-RESEARCH.md Pitfall 4)
   - Separate GTID source UUIDs per region
   - gtid.source.includes must include all region UUIDs
   - Cross-region failover validation steps

8. **Troubleshooting Failover Issues** (table format)
   - Connector doesn't restart -> Check GTID configuration
   - Duplicate events after failover -> GTID source filtering misconfigured
   - SecondsBehindMaster=-1 -> Normal during failover (wait)
   - GTID set doesn't match -> Cross-region UUID issue

9. **Complete Failover Runbook** (code block with all commands)
   - Provide copy-paste bash script for entire procedure
   - Include pre-checks, execution, and validation
   - Based on 15-RESEARCH.md "Failover Runbook" section

10. **Hands-on Exercises**
    - Verify GTID prerequisites on lab MySQL
    - Simulate connector restart (docker restart connect)
    - Verify automatic position recovery
    - (Optional) Aurora failover if AWS access available

Use callout components:
- type="danger": Never manually set binlog position in GTID environments
- type="warning": SecondsBehindMaster=-1 during failover is expected
- type="tip": gtid.source.includes=".*" recommended for Aurora Global Database
- type="warning": Heartbeat configuration mandatory for reliable failover detection

Include Mermaid sequence diagram for failover workflow.
Include decision table: Failover type -> Expected behavior -> Recovery time

Reference prior lessons:
- 02-gtid-mode-fundamentals.mdx for GTID concepts
- 04-mysql-connector-configuration.mdx for connector properties

Follow established patterns:
- Russian text / English code
- Pedagogical structure matching prior Module 8 lessons
  </action>
  <verify>
Build passes: `cd /Users/levoely/debezium\ course && npm run build`
File exists with min 400 lines
Contains gtid_mode, failover-db-cluster, SHOW MASTER STATUS keywords
References prior GTID lesson (02-gtid-mode-fundamentals)
  </verify>
  <done>
Lesson 11 created with complete GTID failover coverage including prerequisites, procedure, validation, and troubleshooting
  </done>
</task>

</tasks>

<verification>
1. Lesson file exists at correct path with proper frontmatter
2. Build passes without errors
3. Failover runbook is complete and copy-paste ready
4. References prior GTID lesson appropriately
5. Troubleshooting table covers common issues from research
</verification>

<success_criteria>
- Learner understands GTID benefit for failover (automatic position finding)
- Pre-failover checklist is actionable
- Post-failover validation steps are comprehensive
- Runbook is production-ready (complete bash commands)
- Multi-region considerations addressed
</success_criteria>

<output>
After completion, create `.planning/phases/15-production-operations/15-02-SUMMARY.md`
</output>
