---
phase: 02-navigation-roadmap
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/navigation.ts
  - src/utils/navigation.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - "Navigation state can be shared between React islands"
    - "Navigation tree derives from content collection automatically"
  artifacts:
    - path: "src/stores/navigation.ts"
      provides: "Sidebar open/close state atom"
      exports: ["isSidebarOpen"]
    - path: "src/utils/navigation.ts"
      provides: "Content collection navigation tree generator"
      exports: ["getNavigationTree"]
  key_links:
    - from: "src/stores/navigation.ts"
      to: "nanostores"
      via: "atom import"
      pattern: "import.*atom.*from.*nanostores"
    - from: "src/utils/navigation.ts"
      to: "astro:content"
      via: "getCollection import"
      pattern: "getCollection.*course"
---

<objective>
Set up nanostores for cross-island state management and create navigation utilities that derive the menu structure from content collections.

Purpose: Foundation for responsive navigation - nanostores enables hamburger menu toggle to control sidebar visibility across Astro islands, and navigation utility provides single source of truth for menu structure.
Output: `src/stores/navigation.ts` with sidebar state atom, `src/utils/navigation.ts` with navigation tree generator.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-navigation-roadmap/02-RESEARCH.md

# Phase 1 artifacts this plan builds on
@src/content/config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install nanostores and create navigation state store</name>
  <files>package.json, src/stores/navigation.ts</files>
  <action>
1. Install nanostores packages:
   ```bash
   npm install nanostores @nanostores/react
   ```

2. Create `src/stores/navigation.ts` with:
   - Import `atom` from `nanostores`
   - Export `isSidebarOpen` atom initialized to `false`
   - Add TypeScript types for type safety

Example structure:
```typescript
import { atom } from 'nanostores';

// Sidebar visibility state - shared across React islands
export const isSidebarOpen = atom<boolean>(false);
```

AVOID: Using React Context (doesn't work across Astro islands). Use only nanostores primitives.
  </action>
  <verify>
    - `npm ls nanostores @nanostores/react` shows both packages installed
    - `cat src/stores/navigation.ts` shows atom export
    - TypeScript compilation succeeds: `npx tsc --noEmit`
  </verify>
  <done>
    - nanostores and @nanostores/react appear in package.json dependencies
    - `src/stores/navigation.ts` exports `isSidebarOpen` atom
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create navigation tree utility from content collections</name>
  <files>src/utils/navigation.ts</files>
  <action>
1. Create `src/utils/navigation.ts` with:
   - Import `getCollection` from `astro:content`
   - Export async function `getNavigationTree()` that:
     a. Fetches all course entries via `getCollection('course')`
     b. Filters out draft entries (if `draft` field exists)
     c. Sorts by `order` field
     d. Groups entries by module (extract moduleId from entry.id path, e.g., "01-intro" from "01-intro/index.mdx")
     e. Returns Map with moduleId as key and array of lesson objects as value

Each lesson object should include:
```typescript
{
  title: string;
  slug: string;       // Full path for routing (e.g., "01-intro")
  order: number;
  difficulty: string;
  estimatedTime: number;
}
```

2. Add TypeScript interfaces for NavigationItem and return type

AVOID: Hardcoding module arrays - always derive from content collection. This ensures navigation stays in sync with content automatically.
  </action>
  <verify>
    - `cat src/utils/navigation.ts` shows getNavigationTree function
    - TypeScript compilation: `npx tsc --noEmit`
    - Test in Astro page (temporary): add `const tree = await getNavigationTree(); console.log(tree);` to index.astro and check `npm run dev` console output
  </verify>
  <done>
    - `src/utils/navigation.ts` exports `getNavigationTree` function
    - Function returns Map grouped by module with lesson metadata
    - No hardcoded module/lesson arrays - derived from content collection
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `npm run build` completes without errors
2. `npm ls nanostores` shows version ^0.11.x
3. Both files exist and export their expected functions/atoms
</verification>

<success_criteria>
- nanostores installed and configured
- Navigation state store ready for cross-island sharing
- Navigation tree utility derives structure from content collection
- TypeScript compiles without errors
- Foundation ready for Plan 02 (navigation components)
</success_criteria>

<output>
After completion, create `.planning/phases/02-navigation-roadmap/02-01-SUMMARY.md`
</output>
