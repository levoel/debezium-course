---
phase: 29-module-2-diagram-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/diagrams/module2/LogicalDecodingDiagrams.tsx
  - src/components/diagrams/module2/ReplicationSlotsDiagrams.tsx
  - src/components/diagrams/module2/WalConfigDiagrams.tsx
  - src/components/diagrams/module2/AuroraParameterDiagrams.tsx
  - src/components/diagrams/module2/index.ts
autonomous: true

must_haves:
  truths:
    - "User can view Physical vs Logical replication comparison diagram in lesson 01"
    - "User can view Logical Decoding components flow diagram in lesson 01"
    - "User can view Publications filtering diagram in lesson 01"
    - "User can view complete logical decoding sequence diagram in lesson 01"
    - "User can view WAL segment retention diagram in lesson 02"
    - "User can view replication slot lifecycle state diagram in lesson 02"
    - "User can view wal_level hierarchy diagram in lesson 03"
    - "User can view workload WAL impact diagram in lesson 03"
    - "User can view Aurora Parameter Group comparison diagram in lesson 04"
    - "User can view Aurora setup process diagram in lesson 04"
    - "User can click any node to see detailed tooltip explanation in Russian"
  artifacts:
    - path: "src/components/diagrams/module2/LogicalDecodingDiagrams.tsx"
      provides: "Logical decoding diagrams (physical vs logical, components, publications, sequence)"
      exports: ["PhysicalVsLogicalDiagram", "LogicalDecodingComponentsDiagram", "PublicationsDiagram", "LogicalDecodingSequenceDiagram"]
    - path: "src/components/diagrams/module2/ReplicationSlotsDiagrams.tsx"
      provides: "Replication slots diagrams (WAL retention, lifecycle state)"
      exports: ["WalRetentionDiagram", "SlotLifecycleDiagram"]
    - path: "src/components/diagrams/module2/WalConfigDiagrams.tsx"
      provides: "WAL configuration diagrams (wal_level hierarchy, workload impact)"
      exports: ["WalLevelHierarchyDiagram", "WorkloadWalImpactDiagram"]
    - path: "src/components/diagrams/module2/AuroraParameterDiagrams.tsx"
      provides: "Aurora parameter diagrams (cluster vs instance, setup process)"
      exports: ["AuroraParameterGroupDiagram", "AuroraSetupProcessDiagram"]
    - path: "src/components/diagrams/module2/index.ts"
      provides: "Barrel export for module2 diagrams"
      contains: "export *"
  key_links:
    - from: "src/components/diagrams/module2/*.tsx"
      to: "src/components/diagrams/primitives"
      via: "import FlowNode, Arrow, DiagramContainer, DiagramTooltip, SequenceDiagram"
      pattern: "from.*primitives"
---

<objective>
Create glass diagram components for Module 2 lessons 01-04 (first 4 files, 10 diagrams), replacing Mermaid diagrams with interactive React components using established primitives.

Purpose: Migrate PostgreSQL-specific diagrams (logical decoding, replication slots, WAL configuration, Aurora parameters) to interactive glass components with detailed Russian tooltips explaining CDC concepts.

Output: 4 component files + barrel export providing 10 diagram exports ready for MDX integration.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-module-2-diagram-migration/29-CONTEXT.md
@.planning/phases/28-module-1-diagram-migration/28-01-SUMMARY.md
@.planning/phases/28-module-1-diagram-migration/28-02-SUMMARY.md
@src/components/diagrams/primitives/types.ts
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx
@src/components/diagrams/primitives/SequenceDiagram.tsx
@src/content/course/02-module-2/01-logical-decoding-deep-dive.mdx
@src/content/course/02-module-2/02-replication-slots-lifecycle.mdx
@src/content/course/02-module-2/03-wal-configuration-tuning.mdx
@src/content/course/02-module-2/04-aurora-parameter-groups.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LogicalDecodingDiagrams component</name>
  <files>
    src/components/diagrams/module2/LogicalDecodingDiagrams.tsx
  </files>
  <action>
Create `src/components/diagrams/module2/LogicalDecodingDiagrams.tsx` with four exported components:

**1. PhysicalVsLogicalDiagram** - Two-column comparison of replication types
- Two DiagramContainers side-by-side (flex row on desktop, column on mobile)
- PHYSICAL subgroup (blue): PRIMARY -> "Бинарные WAL сегменты" -> STANDBY
- LOGICAL subgroup (emerald): PRIMARY -> "pgoutput plugin" -> DECODER -> "Структурированные изменения" -> CONSUMER
- FlowNode variants: database (purple) for PRIMARY/STANDBY, connector (amber) for DECODER, app (blue) for CONSUMER

**Tooltip content (detailed, 3-5 sentences Russian):**
- Physical Primary: "Мастер-узел PostgreSQL отправляет побайтовую копию WAL на реплику. Standby получает точную копию данных, включая все внутренние структуры."
- Physical Standby: "Replica в режиме hot standby — принимает бинарные WAL сегменты и применяет их локально. Может обслуживать read-only запросы."
- Logical Primary: "Мастер-узел с включенным wal_level=logical. Изменения преобразуются в читаемый формат через output plugin."
- Logical Decoder: "Компонент PostgreSQL, преобразующий бинарный WAL в структурированные операции INSERT/UPDATE/DELETE с данными строк."
- Consumer: "Любая система-потребитель: Debezium, другая БД PostgreSQL, custom application. Получает понятные события изменений."

**2. LogicalDecodingComponentsDiagram** - Pipeline of logical decoding components
- Horizontal flow: WAL -> Replication Slot -> Logical Decoder -> Output Plugin -> Debezium -> Kafka
- FlowNode variants: cluster (blue) for WAL, connector (amber) for Slot/Decoder/Plugin, connector (emerald) for Debezium, cluster (emerald) for Kafka

**Tooltip content:**
- WAL: "Write-Ahead Log — журнал транзакций PostgreSQL. При wal_level=logical содержит дополнительные данные для декодирования: OID таблиц, tuple data."
- Replication Slot: "Закладка в WAL, гарантирующая что изменения не будут удалены до прочтения. PostgreSQL хранит WAL сегменты пока slot их не обработает."
- Logical Decoder: "Ядро механизма — интерпретирует WAL записи в контексте транзакций. Группирует изменения по transaction ID, обеспечивает атомарность."
- Output Plugin: "pgoutput — стандартный плагин PostgreSQL 10+. Не требует установки, работает на Aurora/RDS/Cloud SQL. Формирует структурированный вывод."
- Debezium: "CDC коннектор, читающий pgoutput через streaming replication protocol. Преобразует в универсальный envelope-формат."
- Kafka: "Брокер сообщений, хранящий CDC-события в топиках. Обеспечивает durability и доставку потребителям."

**3. PublicationsDiagram** - Publication filtering concept
- DiagramContainer "База данных inventory" with 4 FlowNodes (database variant): customers, orders, products, audit_logs
- Two DiagramContainers below showing publications:
  - "FOR ALL TABLES" (emerald) - shows all tables included
  - "FOR TABLE orders, customers" (blue) - shows selective filtering
- Arrows showing which tables go to which publication

**Tooltip content:**
- Publication ALL: "Publication dbz_publication с FOR ALL TABLES включает все таблицы автоматически, включая созданные в будущем. Удобно для полного CDC."
- Publication SELECTIVE: "Selective publication включает только указанные таблицы. Меньше нагрузка, меньше топиков в Kafka, проще управление."
- Each table: Brief Russian description of table purpose in CDC context

**4. LogicalDecodingSequenceDiagram** - Complete flow sequence
- Use SequenceDiagram component with actors: App, PostgreSQL, WAL, Slot, pgoutput, Debezium, Kafka
- Messages showing UPDATE flow with REPLICA IDENTITY FULL, LSN positions, confirmation

**Tooltip content for actors:**
- App: "Приложение выполняет UPDATE customers SET name='Bob'. PostgreSQL обрабатывает в транзакции с учетом REPLICA IDENTITY."
- PostgreSQL: "СУБД записывает изменение в WAL с полными before/after данными (при REPLICA IDENTITY FULL)."
- WAL: "Transaction log хранит запись с LSN (Log Sequence Number) — уникальным идентификатором позиции."
- Slot: "Replication slot гарантирует сохранность WAL до чтения Debezium. Отслеживает restart_lsn и confirmed_flush_lsn."
- pgoutput: "Декодирует WAL записи в структурированный формат: relation OID, tuple data, operation type."
- Debezium: "Читает через streaming replication protocol, преобразует в CDC envelope с before/after/source/op полями."
- Kafka: "Получает событие в топик inventory.public.customers, подтверждает запись (ACK)."

Use responsive layout: `className="flex flex-col lg:flex-row gap-6"` for comparison diagrams.
  </action>
  <verify>
- File exists at src/components/diagrams/module2/LogicalDecodingDiagrams.tsx
- TypeScript compiles without errors: `npx tsc --noEmit`
- Exports PhysicalVsLogicalDiagram, LogicalDecodingComponentsDiagram, PublicationsDiagram, LogicalDecodingSequenceDiagram
  </verify>
  <done>
LogicalDecodingDiagrams.tsx exports four diagram components with full Russian tooltip content for all interactive elements.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ReplicationSlotsDiagrams and WalConfigDiagrams components</name>
  <files>
    src/components/diagrams/module2/ReplicationSlotsDiagrams.tsx
    src/components/diagrams/module2/WalConfigDiagrams.tsx
  </files>
  <action>
**1. Create `src/components/diagrams/module2/ReplicationSlotsDiagrams.tsx` with two exports:**

**A. WalRetentionDiagram** - WAL segments and slot retention
- DiagramContainer "WAL (Transaction Log)" with 5 FlowNodes representing segments (SEG1-SEG5 with LSN labels)
- FlowNode for Replication Slot with restart_lsn indicator
- Visual distinction: segments before slot position (rose/deletable) vs after (emerald/retained)
- Arrows showing data flow between segments

**Tooltip content:**
- Segment (deletable): "WAL сегмент уже прочитан слотом. PostgreSQL может удалить его при необходимости для освобождения места."
- Segment (retained): "WAL сегмент сохраняется для слота. Не будет удален пока slot не подтвердит чтение через confirmed_flush_lsn."
- Replication Slot: "Слот debezium_inventory с restart_lsn=0/3000000. Все сегменты после этой позиции гарантированно сохранены для CDC."

**B. SlotLifecycleDiagram** - State diagram as flowchart with status colors
- Use flowchart layout (not native stateDiagram - per Phase 28 decision)
- States as FlowNodes with colors: Created (blue), Active (emerald), Inactive (amber), Abandoned (rose), DiskFull (rose), Dropped (neutral)
- Arrows showing transitions with labels

**Tooltip content:**
- Created: "Debezium создает слот при первом запуске коннектора. PostgreSQL резервирует позицию в WAL."
- Active: "Коннектор подключен (active=true), читает изменения. Нормальное рабочее состояние CDC."
- Inactive: "Нет активного соединения (active=false). Может быть временным (rebalance) или постоянным (коннектор удален)."
- Abandoned: "ОПАСНО: Inactive слот, чей коннектор удален. WAL накапливается бесконечно без присмотра."
- DiskFull: "КРИТИЧНО: Abandoned slot заполнил диск WAL сегментами. PostgreSQL переходит в read-only или падает."
- Dropped: "Слот безопасно удален через pg_drop_replication_slot(). WAL сегменты освобождены."

**2. Create `src/components/diagrams/module2/WalConfigDiagrams.tsx` with two exports:**

**A. WalLevelHierarchyDiagram** - Three wal_level tiers
- Vertical stack of 3 DiagramContainers showing hierarchy: minimal -> replica -> logical
- Each level as FlowNode with color coding: minimal (rose), replica (blue), logical (emerald)
- Arrows showing progression
- Side annotations showing what each level enables

**Tooltip content:**
- minimal: "Минимальный уровень — только для crash recovery. Не поддерживает репликацию. Наименьший объем WAL."
- replica: "Стандартный уровень для physical replication и PITR (point-in-time recovery). +10-20% к объему WAL."
- logical: "Требуется для Debezium CDC. Добавляет данные для logical decoding: tuple data, relation OIDs. +5-15% к replica."
- Debezium Ready: "При wal_level=logical PostgreSQL готов к CDC. Изменение требует перезапуска сервера."

**B. WorkloadWalImpactDiagram** - Three workload types impact
- Three FlowNodes in row: INSERT-heavy, Mixed, UPDATE-heavy
- Arrows pointing to impact nodes: +5%, +10%, +15-30%
- Color coding by impact severity: emerald (low), blue (medium), rose (high)

**Tooltip content:**
- INSERT-heavy: "Нагрузка с преобладанием INSERT. Минимальный overhead от logical decoding — логируется только новая строка."
- Mixed: "Сбалансированная нагрузка INSERT + UPDATE + DELETE. Умеренное увеличение WAL при wal_level=logical."
- UPDATE-heavy: "Нагрузка с преобладанием UPDATE. Максимальный overhead — особенно при REPLICA IDENTITY FULL (логируется полная строка до и после)."
- Impact percentages: Explain that these are typical increases over wal_level=replica baseline
  </action>
  <verify>
- File exists at src/components/diagrams/module2/ReplicationSlotsDiagrams.tsx
- File exists at src/components/diagrams/module2/WalConfigDiagrams.tsx
- TypeScript compiles without errors: `npx tsc --noEmit`
- Exports WalRetentionDiagram, SlotLifecycleDiagram, WalLevelHierarchyDiagram, WorkloadWalImpactDiagram
  </verify>
  <done>
ReplicationSlotsDiagrams and WalConfigDiagrams export 4 diagram components covering replication slot lifecycle and WAL configuration concepts.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create AuroraParameterDiagrams component and barrel export</name>
  <files>
    src/components/diagrams/module2/AuroraParameterDiagrams.tsx
    src/components/diagrams/module2/index.ts
  </files>
  <action>
**1. Create `src/components/diagrams/module2/AuroraParameterDiagrams.tsx` with two exports:**

**A. AuroraParameterGroupDiagram** - Cluster vs Instance parameter groups
- Two DiagramContainers side-by-side:
  - "DB Cluster Parameter Group" (emerald, prominent) with FlowNodes: rds.logical_replication, max_replication_slots, max_wal_senders
  - "DB Instance Parameter Group" (blue) with FlowNodes: shared_buffers, work_mem, maintenance_work_mem
- Below: 3 FlowNodes representing Aurora instances: Writer (amber), Reader 1, Reader 2 (purple)
- Arrows showing Cluster params apply to ALL instances, Instance params apply to specific instance

**Tooltip content:**
- Cluster Parameter Group: "DB Cluster Parameter Group применяется ко ВСЕМУ кластеру Aurora. Здесь настраивается rds.logical_replication=1 для CDC."
- Instance Parameter Group: "DB Instance Parameter Group применяется к конкретному инстансу. Используется для memory tuning, не для репликации."
- rds.logical_replication: "Ключевой параметр для CDC в Aurora. Значение 1 включает logical replication (устанавливает wal_level=logical)."
- max_replication_slots: "Максимум слотов репликации. Минимум 1 на коннектор + 2-3 запаса. Рекомендуется 10."
- max_wal_senders: "Максимум соединений для чтения WAL. Должен быть >= max_replication_slots."
- Writer Instance: "Primary инстанс Aurora, обрабатывающий write операции. Debezium подключается к Writer."
- Reader Instance: "Read replica для read-only запросов. Не участвует в CDC напрямую."

**B. AuroraSetupProcessDiagram** - 5-step setup process
- Horizontal flow of 5 FlowNodes with numbered steps:
  1. "Создать Parameter Group" (blue)
  2. "Изменить параметры" (purple)
  3. "Применить к кластеру" (amber)
  4. "Reboot Writer Instance" (rose, emphasized - CRITICAL step)
  5. "Проверить конфигурацию" (emerald)
- Arrows connecting steps sequentially
- Step 4 should be visually emphasized (border, badge) as critical

**Tooltip content:**
- Step 1: "Создание DB Cluster Parameter Group (не DB Instance!) в AWS Console или через CLI. Важно: тип группы критичен."
- Step 2: "Настройка параметров: rds.logical_replication=1, max_replication_slots=10, max_wal_senders=10, max_logical_replication_workers=10."
- Step 3: "Применение parameter group к Aurora кластеру через Modify Cluster. Можно Apply Immediately или в maintenance window."
- Step 4: "КРИТИЧЕСКИ ВАЖНО: Reboot Writer Instance обязателен! Без reboot wal_level останется 'replica' и Debezium не подключится."
- Step 5: "Проверка: SHOW wal_level; должен вернуть 'logical'. Если 'replica' — reboot не был выполнен."

**2. Create `src/components/diagrams/module2/index.ts`:**

Barrel export file:
```typescript
export * from './LogicalDecodingDiagrams';
export * from './ReplicationSlotsDiagrams';
export * from './WalConfigDiagrams';
export * from './AuroraParameterDiagrams';
```
  </action>
  <verify>
- File exists at src/components/diagrams/module2/AuroraParameterDiagrams.tsx
- File exists at src/components/diagrams/module2/index.ts
- TypeScript compiles without errors: `npx tsc --noEmit`
- All 10 diagrams importable from index: PhysicalVsLogicalDiagram, LogicalDecodingComponentsDiagram, PublicationsDiagram, LogicalDecodingSequenceDiagram, WalRetentionDiagram, SlotLifecycleDiagram, WalLevelHierarchyDiagram, WorkloadWalImpactDiagram, AuroraParameterGroupDiagram, AuroraSetupProcessDiagram
  </verify>
  <done>
AuroraParameterDiagrams shows Aurora-specific CDC configuration, and index.ts provides clean barrel export for all 10 Module 2 diagrams (lessons 01-04).
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd "/Users/levoely/debezium course" && npx tsc --noEmit`
2. Verify all exports: Create a test file that imports all 10 components
3. Count exports matches expected (10 diagram components for lessons 01-04)
4. All tooltips use Russian text as per CONTEXT.md decisions
</verification>

<success_criteria>
- 10 diagram components created and exported for lessons 01-04
- All components use primitives from Phase 26-27 (FlowNode, Arrow, DiagramContainer, DiagramTooltip, SequenceDiagram)
- Detailed Russian tooltips on all interactive nodes (3-5 sentences each)
- TypeScript compiles without errors
- Components follow patterns established in Module 1 migration (forwardRef for FlowNode, DiagramTooltip wrapping)
- State diagrams implemented as flowcharts with status colors (per Phase 28 decision)
</success_criteria>

<output>
After completion, create `.planning/phases/29-module-2-diagram-migration/29-01-SUMMARY.md`
</output>
