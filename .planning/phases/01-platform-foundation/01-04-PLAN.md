---
phase: 01-platform-foundation
plan: 04
type: execute
wave: 4
depends_on: ["01-03"]
files_modified:
  - .github/workflows/deploy.yml
  - astro.config.mjs
autonomous: false

must_haves:
  truths:
    - "GitHub Actions workflow triggers on push to main"
    - "Site builds and deploys to GitHub Pages"
    - "All features work on deployed site (routing, highlighting, diagrams)"
  artifacts:
    - path: ".github/workflows/deploy.yml"
      provides: "GitHub Actions deployment workflow"
      contains: "actions/deploy-pages@v4"
    - path: "astro.config.mjs"
      provides: "Production site/base configuration"
      contains: "site:"
  key_links:
    - from: ".github/workflows/deploy.yml"
      to: "GitHub Pages"
      via: "actions/upload-pages-artifact + deploy-pages"
      pattern: "deploy-pages@v4"
    - from: "astro.config.mjs"
      to: "deployed site"
      via: "site + base config"
      pattern: "site:.*github.io"
---

<objective>
Configure GitHub Actions workflow for automatic deployment to GitHub Pages. Verify deployed site works correctly with all features.

Purpose: Makes the course accessible to students on the web. Validates the entire stack in production environment.
Output: Live course website at https://[username].github.io/[repo-name]
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-platform-foundation/01-RESEARCH.md
@.planning/phases/01-platform-foundation/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions deployment workflow</name>
  <files>
    .github/workflows/deploy.yml
    astro.config.mjs
  </files>
  <action>
Create GitHub Actions workflow for automated deployment to GitHub Pages.

First, get the repository information to configure site URL:

```bash
# Get remote URL (if exists)
git remote get-url origin 2>/dev/null || echo "No remote configured"
```

Create `.github/workflows/deploy.yml`:

```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build Astro site
        run: npm run build

      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
```

Update `astro.config.mjs` with production URL.

IMPORTANT: The `site` and `base` values depend on repository name and owner:

For repository `https://github.com/USERNAME/REPO-NAME`:
- site: `https://USERNAME.github.io`
- base: `/REPO-NAME`

If remote is not configured yet, use placeholders:

```javascript
// astro.config.mjs
import { defineConfig } from 'astro/config';
import react from '@astrojs/react';
import tailwind from '@astrojs/tailwind';
import mdx from '@astrojs/mdx';

export default defineConfig({
  // TODO: Update with actual GitHub username
  site: 'https://USERNAME.github.io',
  // TODO: Update with actual repository name
  base: '/debezium-course',
  integrations: [
    react(),
    tailwind(),
    mdx(),
  ],
  markdown: {
    shikiConfig: {
      theme: 'github-dark',
      langs: ['python', 'yaml', 'sql', 'json', 'javascript', 'typescript', 'java', 'bash', 'dockerfile'],
      wrap: true,
    },
  },
});
```

CRITICAL pitfall prevention:
- `base` MUST match repository name exactly (case-sensitive)
- Without correct `base`, all CSS/JS/links will 404 on GitHub Pages
- If using custom domain later, `base` should be removed or set to `/`
  </action>
  <verify>
1. Verify workflow file exists: `cat .github/workflows/deploy.yml`
2. Run local build to ensure it works: `npm run build`
3. Check dist folder created: `ls -la dist/`
4. Verify astro.config.mjs has site and base configured
  </verify>
  <done>
GitHub Actions workflow created. Astro config updated with site/base for GitHub Pages. Local build succeeds and generates dist/ folder.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete course website with:
- Astro 5 static site generator
- Syntax highlighting (Python, YAML, SQL, JSON)
- Mermaid diagrams (flowchart, sequence)
- Responsive layout (mobile and desktop)
- GitHub Pages deployment workflow

All code is ready locally. Deployment requires GitHub repository setup.
  </what-built>
  <how-to-verify>
**Step 1: Push to GitHub**

If remote not configured:
```bash
# Create repository on GitHub first (via github.com or gh CLI)
gh repo create debezium-course --public --source=. --push
# OR
git remote add origin https://github.com/USERNAME/debezium-course.git
git push -u origin main
```

**Step 2: Enable GitHub Pages**
1. Go to repository Settings > Pages
2. Source: Select "GitHub Actions"
3. Save

**Step 3: Trigger deployment**
Push any change or go to Actions tab and run "Deploy to GitHub Pages" manually.

**Step 4: Verify deployed site**
1. Wait for workflow to complete (check Actions tab)
2. Visit: https://USERNAME.github.io/debezium-course
3. Verify:
   - [ ] Landing page loads
   - [ ] Click lesson - navigates correctly
   - [ ] Code blocks have syntax highlighting
   - [ ] Mermaid diagrams render as SVG
   - [ ] Mobile view: toggle DevTools device mode, layout adapts
   - [ ] All links work (no 404s)
  </how-to-verify>
  <resume-signal>
Type "deployed" with the live URL, or describe any issues encountered.
  </resume-signal>
</task>

</tasks>

<verification>
1. GitHub Actions workflow file present at `.github/workflows/deploy.yml`
2. Workflow triggers on push to main branch
3. Site builds successfully in GitHub Actions
4. GitHub Pages deployment completes
5. Live site accessible at configured URL
6. All features work on deployed site:
   - Routing between pages
   - Syntax highlighting
   - Mermaid diagrams
   - Responsive layout
</verification>

<success_criteria>
- GitHub Actions workflow deploys on push to main
- Site accessible at https://[username].github.io/[repo-name]
- No 404 errors for CSS, JS, or navigation
- Code blocks display with syntax highlighting
- Mermaid diagrams render correctly
- Site displays properly on mobile (Chrome DevTools device mode)
</success_criteria>

<output>
After completion, create `.planning/phases/01-platform-foundation/01-04-SUMMARY.md`
</output>
