---
phase: 31-module-4-diagram-migration
plan: 04
type: execute
wave: 2
depends_on: ["31-01", "31-02", "31-03"]
files_modified:
  - src/content/course/04-module-4/01-jmx-metrics-interpretation.mdx
  - src/content/course/04-module-4/02-prometheus-metrics-collection.mdx
  - src/content/course/04-module-4/03-grafana-dashboard-lab.mdx
  - src/content/course/04-module-4/04-lag-detection-alerting.mdx
  - src/content/course/04-module-4/05-wal-bloat-heartbeat.mdx
  - src/content/course/04-module-4/06-connector-scaling-tasks.mdx
  - src/content/course/04-module-4/07-disaster-recovery-procedures.mdx
autonomous: true

must_haves:
  truths:
    - "All 7 Module 4 MDX files import glass diagram components"
    - "All Mermaid code blocks are removed from Module 4"
    - "Glass diagrams render with client:load directive"
    - "Import paths use ../../../components/diagrams/module4/ pattern"
    - "User sees interactive diagrams when viewing Module 4 lessons"
    - "Clicking diagram nodes shows tooltips with explanations"
  artifacts:
    - path: "src/content/course/04-module-4/01-jmx-metrics-interpretation.mdx"
      provides: "JMX metrics lesson with glass diagrams"
      contains: "client:load"
    - path: "src/content/course/04-module-4/02-prometheus-metrics-collection.mdx"
      provides: "Prometheus collection lesson with glass diagrams"
      contains: "client:load"
    - path: "src/content/course/04-module-4/03-grafana-dashboard-lab.mdx"
      provides: "Grafana dashboard lesson with glass diagrams"
      contains: "client:load"
    - path: "src/content/course/04-module-4/04-lag-detection-alerting.mdx"
      provides: "Alerting lesson with glass diagrams"
      contains: "client:load"
    - path: "src/content/course/04-module-4/05-wal-bloat-heartbeat.mdx"
      provides: "WAL bloat lesson with glass diagrams"
      contains: "client:load"
    - path: "src/content/course/04-module-4/06-connector-scaling-tasks.mdx"
      provides: "Scaling lesson with glass diagrams"
      contains: "client:load"
    - path: "src/content/course/04-module-4/07-disaster-recovery-procedures.mdx"
      provides: "DR lesson with glass diagrams"
      contains: "client:load"
  key_links:
    - from: "src/content/course/04-module-4/*.mdx"
      to: "src/components/diagrams/module4/"
      via: "import statement"
      pattern: "import.*from.*components/diagrams/module4"
---

<objective>
Migrate all 7 Module 4 MDX files to use glass diagram components, replacing all Mermaid code blocks.

Purpose: Completes Module 4 diagram migration by wiring glass components into lesson content, enabling interactive tooltips and removing Mermaid dependency from this module.
Output: 7 updated MDX files with zero Mermaid code blocks.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-module-4-diagram-migration/31-RESEARCH.md

# Diagram components (from plans 01-03)
@src/components/diagrams/module4/index.ts

# MDX files to update
@src/content/course/04-module-4/01-jmx-metrics-interpretation.mdx
@src/content/course/04-module-4/02-prometheus-metrics-collection.mdx
@src/content/course/04-module-4/03-grafana-dashboard-lab.mdx
@src/content/course/04-module-4/04-lag-detection-alerting.mdx
@src/content/course/04-module-4/05-wal-bloat-heartbeat.mdx
@src/content/course/04-module-4/06-connector-scaling-tasks.mdx
@src/content/course/04-module-4/07-disaster-recovery-procedures.mdx

# Prior MDX migration reference
@src/content/course/03-module-3/01-binlog-architecture.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update MDX files for lessons 01-04</name>
  <files>
    src/content/course/04-module-4/01-jmx-metrics-interpretation.mdx
    src/content/course/04-module-4/02-prometheus-metrics-collection.mdx
    src/content/course/04-module-4/03-grafana-dashboard-lab.mdx
    src/content/course/04-module-4/04-lag-detection-alerting.mdx
  </files>
  <action>
For each MDX file:

1. **Add imports** after frontmatter (before first heading):
   ```mdx
   import { ComponentName1, ComponentName2 } from '../../../components/diagrams/module4';
   ```

2. **Replace Mermaid code blocks** with React components:
   - Find each ```mermaid code block
   - Replace with: `<ComponentName client:load />`
   - Preserve surrounding text context

3. **Use correct component mapping**:

**01-jmx-metrics-interpretation.mdx** (4 diagrams):
- JmxMetricsPipelineDiagram
- LagCalculationDiagram
- StalenessScenariosDiagram
- DiagnosticDecisionTreeDiagram

**02-prometheus-metrics-collection.mdx** (1 diagram):
- PrometheusScrapingDiagram

**03-grafana-dashboard-lab.mdx** (3 diagrams):
- DashboardArchitectureDiagram
- PanelRowLayoutDiagram
- HealthStatesComparisonDiagram

**04-lag-detection-alerting.mdx** (4 diagrams):
- AlertComparisonDiagram
- AlertSeverityHierarchyDiagram
- BatchInsertSpikeDiagram
- NotificationRoutingDiagram

**Critical:** Always include `client:load` directive for React hydration.
**Import path:** `../../../components/diagrams/module4` (3 levels up from content/course/04-module-4/)
  </action>
  <verify>
    - grep -c "```mermaid" for each file returns 0
    - grep -c "client:load" for each file returns expected diagram count (4, 1, 3, 4)
    - Run `npm run build` - no errors
  </verify>
  <done>
    4 MDX files updated: 12 Mermaid blocks replaced with glass diagram components, all with client:load directive
  </done>
</task>

<task type="auto">
  <name>Task 2: Update MDX files for lessons 05-07</name>
  <files>
    src/content/course/04-module-4/05-wal-bloat-heartbeat.mdx
    src/content/course/04-module-4/06-connector-scaling-tasks.mdx
    src/content/course/04-module-4/07-disaster-recovery-procedures.mdx
  </files>
  <action>
For each MDX file, apply same pattern as Task 1:

**05-wal-bloat-heartbeat.mdx** (3 diagrams):
- LowTrafficWalScenarioDiagram
- MultiLayerDefenseDiagram
- HeartbeatFlowDiagram

**06-connector-scaling-tasks.mdx** (6 diagrams):
- TasksMaxMythDiagram
- WalSequentialDiagram
- SingleTaskArchitectureDiagram
- MultipleConnectorsDiagram
- DownstreamParallelizationDiagram
- ScalingDecisionFrameworkDiagram

**07-disaster-recovery-procedures.mdx** (3 diagrams):
- FailureModesDiagram
- StateStorageLocationsDiagram
- OrphanedSlotCleanupDiagram

**Note:** 07-disaster-recovery has a markdown checklist that is NOT a Mermaid diagram - leave it as markdown.

**Verify complete module migration:**
- Total 24 Mermaid blocks should be replaced across all 7 files
- All 7 files should have import statements
- All 7 files should have client:load directives
  </action>
  <verify>
    - grep -c "```mermaid" for each file returns 0
    - grep -c "client:load" for each file returns expected diagram count (3, 6, 3)
    - Run `npm run build` - no errors
    - grep -r "```mermaid" src/content/course/04-module-4/ returns empty (zero Mermaid in entire module)
  </verify>
  <done>
    3 MDX files updated: 12 Mermaid blocks replaced, Module 4 has zero Mermaid code blocks remaining
  </done>
</task>

</tasks>

<verification>
1. Run `npm run build` - zero errors
2. grep -r "```mermaid" src/content/course/04-module-4/ returns empty
3. grep -r "client:load" src/content/course/04-module-4/ shows 24 occurrences
4. All 7 MDX files have import statements from module4 diagrams
5. Dev server: navigate to Module 4 lessons, verify diagrams render with clickable tooltips
</verification>

<success_criteria>
- Zero Mermaid code blocks in Module 4 (grep returns empty)
- 24 glass diagram components integrated across 7 MDX files
- All diagrams have client:load directive
- Build passes with zero errors
- Diagrams render interactively with tooltips in browser
</success_criteria>

<output>
After completion, create `.planning/phases/31-module-4-diagram-migration/31-04-SUMMARY.md`
</output>
