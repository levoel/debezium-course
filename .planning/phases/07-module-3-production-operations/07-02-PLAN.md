---
phase: 07-module-3-production-operations
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/03-module-3/03-grafana-dashboard-lab.mdx
  - src/content/course/03-module-3/04-lag-detection-alerting.mdx
  - labs/monitoring/grafana/dashboards/debezium-production.json
autonomous: true

must_haves:
  truths:
    - "Students can deploy a Grafana dashboard showing CDC lag, throughput, and queue utilization"
    - "Students can create alert rules for lag exceeding SLO thresholds"
    - "Students understand alert hierarchy: warning (5s/2m) vs critical (30s/5m)"
    - "Students know to use 'for' duration to avoid alert storms during batch operations"
  artifacts:
    - path: "src/content/course/03-module-3/03-grafana-dashboard-lab.mdx"
      provides: "Dashboard building lab, panel configuration, visualization best practices"
      min_lines: 200
    - path: "src/content/course/03-module-3/04-lag-detection-alerting.mdx"
      provides: "Alert rule creation, threshold selection, noise reduction strategies"
      min_lines: 180
    - path: "labs/monitoring/grafana/dashboards/debezium-production.json"
      provides: "Production-ready dashboard JSON for import"
      min_lines: 200
  key_links:
    - from: "03-grafana-dashboard-lab.mdx"
      to: "04-lag-detection-alerting.mdx"
      via: "Dashboard panels serve as alert visualization"
    - from: "debezium-production.json"
      to: "labs/monitoring/grafana/dashboards/"
      via: "Provisioned alongside existing debezium-connect.json"
---

<objective>
Create visualization and alerting lessons covering Grafana dashboard building and CDC lag alerting configuration.

Purpose: After understanding metrics (Plan 07-01), students need to visualize them for operational awareness and set up proactive alerts. This plan delivers hands-on labs for building dashboards and configuring alert rules.

Output: Two MDX lessons (03, 04) covering MOD3-03 (Grafana dashboards) and MOD3-04 (lag alerting), plus a production-ready dashboard JSON file.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-module-3-production-operations/07-RESEARCH.md

# Existing Grafana infrastructure from Phase 4
@labs/monitoring/grafana/dashboards/debezium-connect.json
@labs/monitoring/grafana/provisioning/dashboards/dashboards.yml
@labs/monitoring/grafana/provisioning/datasources/datasources.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Grafana Dashboard Lab lesson</name>
  <files>src/content/course/03-module-3/03-grafana-dashboard-lab.mdx</files>
  <action>
Create hands-on lab lesson on building Grafana dashboards for CDC monitoring (MOD3-03):

**Structure:**
1. Lab setup verification:
   - Grafana at localhost:3000 (admin/admin)
   - Prometheus datasource pre-configured (from Phase 4)
   - Existing debezium-connect.json dashboard as reference
2. Dashboard architecture for CDC monitoring:
   - Row 1: Health overview (status, lag, throughput stats)
   - Row 2: Time series (lag trend, events/second, queue utilization)
   - Row 3: Detailed metrics (per-connector breakdown if multiple connectors)
3. Panel-by-panel build instructions:
   - Stat panel: Connector Status (Connected metric with value mapping)
   - Gauge: Current Lag (MilliSecondsBehindSource with thresholds)
   - Time series: Lag Trend (5m, 1h, 24h views)
   - Time series: Throughput (rate of TotalNumberOfEventsSeen)
   - Time series: Queue Utilization (calculated field)
4. PromQL for each panel with explanation
5. Variable configuration ($connector for multi-connector support)
6. Dashboard export and import (JSON format)

**Include:**
- Mermaid diagram: Dashboard layout wireframe showing panel placement
- Step-by-step screenshots (as placeholder comments for future addition)
- Complete panel JSON snippets for each visualization
- Callout: "Grafana datasource is non-editable via provisioning" (prior decision)
- Lab checkpoint: Student exports their dashboard, compares to reference

**Lab flow:**
1. Access Grafana UI
2. Create new dashboard
3. Add panels one by one (following instructions)
4. Configure variables
5. Export and compare to debezium-production.json reference

**Style:**
- Russian explanatory text, English Grafana config/PromQL
- Hands-on lab format with numbered steps
- Frontmatter: title, description, order: 3, difficulty: intermediate, duration: 40min, topics: [grafana, dashboards, visualization, prometheus]
  </action>
  <verify>
- File exists at src/content/course/03-module-3/03-grafana-dashboard-lab.mdx
- `npm run build` passes without errors
- File has step-by-step panel creation instructions
- File has 200+ lines
- File references Grafana at localhost:3000
  </verify>
  <done>Students can build a CDC monitoring dashboard from scratch with lag, throughput, and queue panels, and understand dashboard export/import workflow</done>
</task>

<task type="auto">
  <name>Task 2: Create Lag Detection and Alerting lesson</name>
  <files>src/content/course/03-module-3/04-lag-detection-alerting.mdx</files>
  <action>
Create comprehensive lesson on CDC lag detection and alerting (MOD3-04):

**Structure:**
1. Why alert on lag (not just visualize):
   - SLO compliance (freshness guarantees to downstream consumers)
   - Early warning before customer impact
   - Automated incident response triggers
2. Alert hierarchy design:
   - Warning: Lag > 5s for 2m (investigate)
   - Critical: Lag > 30s for 5m (SLO breach, page on-call)
   - Connector Disconnected: Connected == 0 for 1m (immediate action)
   - Queue Saturation: QueueRemainingCapacity < 10% for 5m (backpressure warning)
3. Common pitfall: Alert storms during batch operations
   - Use "for" duration to require sustained condition
   - Brief spikes are normal during bulk INSERT/UPDATE
   - Consider silencing windows for known ETL jobs
4. Grafana Alerting configuration:
   - Alert rule creation in UI
   - Contact points (email, Slack placeholders)
   - Notification policies (routing by severity)
5. PromQL for alert conditions with explanation
6. Testing alerts: How to trigger intentionally for validation

**Include:**
- Mermaid diagram: Alert escalation flow (metric -> rule -> contact point -> action)
- Complete Grafana alert rule JSON (from RESEARCH.md pattern)
- Table: Alert thresholds with severity, condition, duration, message template
- Callout: "MilliSecondsBehindSource is NEVER zero" - baseline understanding
- Lab exercise: Create warning alert, trigger with docker stop, observe alert fire

**Teaching points from RESEARCH.md pitfalls:**
- Don't alert on instantaneous metrics - use "for" clause
- Separate warning (2m) from critical (5m) durations
- Multiple alert/resolve cycles = threshold too aggressive

**Style:**
- Russian explanatory text, English alert config/PromQL
- Scenario-based learning: "What happens when..."
- Frontmatter: title, description, order: 4, difficulty: intermediate, duration: 35min, topics: [alerting, grafana, slo, incident-response]
  </action>
  <verify>
- File exists at src/content/course/03-module-3/04-lag-detection-alerting.mdx
- `npm run build` passes without errors
- File contains alert threshold table
- File has 180+ lines
- File explains "for" duration purpose
  </verify>
  <done>Students can design alert hierarchy for CDC pipeline, create Grafana alert rules, and understand noise reduction strategies for production alerting</done>
</task>

<task type="auto">
  <name>Task 3: Create Production Dashboard JSON</name>
  <files>labs/monitoring/grafana/dashboards/debezium-production.json</files>
  <action>
Create production-ready Grafana dashboard JSON for CDC monitoring:

**Dashboard structure:**
1. **Row: Health Overview**
   - Connector Status (stat panel, value mapping: 1=Running/green, 0=Failed/red)
   - Current Lag (gauge, thresholds: 0-5s green, 5-30s yellow, >30s red)
   - Events/sec (stat panel, sparkline)
   - Queue Usage % (gauge, thresholds: <50% green, 50-90% yellow, >90% red)

2. **Row: Time Series**
   - Lag Trend (MilliSecondsBehindSource over time)
   - Throughput (rate(TotalNumberOfEventsSeen[1m]))
   - Queue Utilization (calculated: 100 * (1 - QueueRemaining/QueueTotal))
   - Staleness (MilliSecondsSinceLastEvent)

3. **Row: Detailed Metrics** (collapsed by default)
   - Committed Transactions
   - Snapshot Progress (if active)

**Configuration:**
- Variables: $connector (regex: /.*/, default: inventory-connector)
- Time range: Last 1 hour default
- Auto-refresh: 15s (matches Prometheus scrape interval)
- Datasource variable: ${DS_PROMETHEUS} for portability

**Panel features:**
- Thresholds matching alert levels (visual consistency)
- Panel descriptions explaining metric meaning
- Links to Prometheus for deeper exploration

**JSON requirements:**
- Valid Grafana dashboard JSON format
- Uses templated datasource (${DS_PROMETHEUS})
- Includes __inputs for dashboard import
- Title: "Debezium Production Monitoring"
- UID: debezium-production

**Note:** This extends the existing debezium-connect.json with production-focused panels.
  </action>
  <verify>
- File exists at labs/monitoring/grafana/dashboards/debezium-production.json
- JSON is valid (can be parsed)
- File has 200+ lines
- Dashboard has $connector variable
- Includes MilliSecondsBehindSource and QueueRemainingCapacity panels
  </verify>
  <done>Production-ready dashboard JSON available for import, demonstrating best practices for CDC monitoring visualization</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Two lesson files exist in src/content/course/03-module-3/ (03-, 04-)
2. Dashboard JSON exists in labs/monitoring/grafana/dashboards/
3. `npm run build` passes without errors
4. Dashboard JSON is valid and can be imported to Grafana
5. Alert examples are complete and actionable
6. Content references existing lab infrastructure
</verification>

<success_criteria>
- 2 MDX files + 1 JSON file created
- Total 580+ lines across all files
- Dashboard JSON importable to Grafana
- Alert rule examples ready to copy-paste
- Build completes without errors
- Students can complete lab with running Docker environment
</success_criteria>

<output>
After completion, create `.planning/phases/07-module-3-production-operations/07-02-SUMMARY.md`
</output>
