---
phase: 07-module-3-production-operations
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/03-module-3/01-jmx-metrics-interpretation.mdx
  - src/content/course/03-module-3/02-prometheus-metrics-collection.mdx
autonomous: true

must_haves:
  truths:
    - "Students can identify MilliSecondsBehindSource as the primary lag metric"
    - "Students understand QueueRemainingCapacity indicates Kafka write bottleneck"
    - "Students know MilliSecondsSinceLastEvent detects stale connectors"
    - "Students can access Prometheus at localhost:9090 to query Debezium metrics"
  artifacts:
    - path: "src/content/course/03-module-3/01-jmx-metrics-interpretation.mdx"
      provides: "JMX metric categories, interpretation framework, troubleshooting scenarios"
      min_lines: 200
    - path: "src/content/course/03-module-3/02-prometheus-metrics-collection.mdx"
      provides: "JMX Exporter config, PromQL queries, metric naming patterns"
      min_lines: 180
  key_links:
    - from: "01-jmx-metrics-interpretation.mdx"
      to: "02-prometheus-metrics-collection.mdx"
      via: "JMX metrics exposed -> Prometheus scrapes via JMX Exporter"
    - from: "02-prometheus-metrics-collection.mdx"
      to: "labs/monitoring/prometheus/prometheus.yml"
      via: "Scrape configuration references existing lab infrastructure"
---

<objective>
Create metrics foundation lessons covering JMX metric interpretation and Prometheus collection configuration.

Purpose: Students must understand what Debezium metrics mean before building dashboards or alerts. These lessons teach the "language" of CDC observability - which metrics matter, what they indicate, and how to query them.

Output: Two MDX lessons (01, 02) in src/content/course/03-module-3/ directory covering MOD3-01 (JMX metrics) and MOD3-02 (Prometheus configuration).
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-module-3-production-operations/07-RESEARCH.md

# Established patterns from prior modules
@src/content/course/02-module-2/01-logical-decoding-deep-dive.mdx
@src/content/course/02-module-2/02-replication-slots-lifecycle.mdx

# Existing infrastructure from Phase 4
@labs/monitoring/prometheus/prometheus.yml
@labs/docker-compose.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create JMX Metrics Interpretation lesson</name>
  <files>src/content/course/03-module-3/01-jmx-metrics-interpretation.mdx</files>
  <action>
Create comprehensive lesson on Debezium JMX metrics interpretation (MOD3-01):

**Structure:**
1. Why metrics matter - CDC observability as operational necessity
2. JMX metric categories:
   - Streaming metrics (debezium.streaming context)
   - Snapshot metrics (debezium.snapshot context)
   - Kafka Connect worker metrics
3. Primary metrics for CDC health:
   - MilliSecondsBehindSource (lag - PRIMARY alert metric)
   - MilliSecondsSinceLastEvent (staleness indicator)
   - QueueRemainingCapacity (backpressure indicator)
   - Connected (boolean - database connection)
   - TotalNumberOfEventsSeen (throughput)
4. Metric interpretation framework - operational scenarios:
   - "Connector is lagging" -> check MilliSecondsBehindSource trend
   - "Connector appears stuck" -> check MilliSecondsSinceLastEvent
   - "Throughput degraded" -> check QueueRemainingCapacity
5. Common pitfalls:
   - MilliSecondsBehindSource is NEVER zero (processing time)
   - Metric only updates when events arrive
   - Combine lag + staleness for accurate picture

**Include:**
- Mermaid diagram: JMX metric flow (Debezium JVM -> JMX -> JMX Exporter -> Prometheus)
- Mermaid diagram: Decision tree for lag diagnosis
- Table: Key metrics with description, unit, alert threshold recommendation
- Callout box: "MilliSecondsBehindSource vs MilliSecondsSinceLastEvent" distinction
- Lab exercise: Access JMX via JConsole or curl to JMX Exporter endpoint

**Prior decisions to honor:**
- Debezium Connect 2.5.4 (project standard)
- Note that per-table metrics require Debezium 3.0+ (mention as future enhancement)

**Style:**
- Russian explanatory text, English code/config/metrics
- Progressive disclosure - start with "what to monitor" before deep dive
- Frontmatter: title, description, order: 1, difficulty: intermediate, duration: 30min, topics: [jmx, metrics, monitoring, observability]
  </action>
  <verify>
- File exists at src/content/course/03-module-3/01-jmx-metrics-interpretation.mdx
- `npm run build` passes without errors
- File has 2+ Mermaid diagrams
- File has 200+ lines
- File mentions MilliSecondsBehindSource, QueueRemainingCapacity, MilliSecondsSinceLastEvent
  </verify>
  <done>Students can identify primary Debezium metrics, understand what each indicates about pipeline health, and apply diagnostic framework for common operational scenarios</done>
</task>

<task type="auto">
  <name>Task 2: Create Prometheus Metrics Collection lesson</name>
  <files>src/content/course/03-module-3/02-prometheus-metrics-collection.mdx</files>
  <action>
Create comprehensive lesson on Prometheus metrics collection for Debezium (MOD3-02):

**Structure:**
1. JMX Exporter architecture - Java agent exposing JMX as Prometheus format
2. Lab infrastructure overview:
   - Debezium Connect at connect:9404 (JMX Exporter port)
   - Prometheus at localhost:9090 (scraping connect:9404)
   - 15s scrape interval (prior decision from Phase 4)
3. JMX Exporter configuration rules:
   - Pattern matching: kafka.connect, debezium.* namespaces
   - Label extraction: connector, task, server, context
   - Metric relabeling to kafka_connect_* and debezium_* only (prior decision)
4. PromQL query examples:
   - Current lag: debezium_metrics_MilliSecondsBehindSource{connector="inventory-connector"}
   - Queue utilization: 100 * (1 - (debezium_metrics_QueueRemainingCapacity / debezium_metrics_QueueTotalCapacity))
   - Events per second: rate(debezium_metrics_TotalNumberOfEventsSeen[5m])
   - Stale connector: debezium_metrics_MilliSecondsSinceLastEvent > 30000
5. Lab exercise: Query Prometheus UI to explore available metrics
6. Metric naming conventions and cardinality management

**Include:**
- Mermaid diagram: Prometheus scraping architecture (Connect -> JMX Exporter -> Prometheus -> Grafana)
- Full JMX Exporter config.yml with annotated patterns (from RESEARCH.md)
- PromQL examples with expected output format
- Screenshot placeholder: Prometheus UI targets page showing connect:9404
- Callout: Why 15s scrape interval is recommended (balance between freshness and overhead)

**Reference existing infrastructure:**
- @labs/monitoring/prometheus/prometheus.yml (show actual config)
- @labs/docker-compose.yml (KAFKA_JMX_PORT=9404 setting)

**Style:**
- Russian explanatory text, English configuration/PromQL
- Hands-on focus - students should run queries in Prometheus UI
- Frontmatter: title, description, order: 2, difficulty: intermediate, duration: 25min, topics: [prometheus, jmx-exporter, promql, metrics-collection]
  </action>
  <verify>
- File exists at src/content/course/03-module-3/02-prometheus-metrics-collection.mdx
- `npm run build` passes without errors
- File contains PromQL query examples
- File has 180+ lines
- File references existing Prometheus configuration from labs/
  </verify>
  <done>Students can explain Prometheus scraping architecture, write PromQL queries for Debezium metrics, and use lab infrastructure to explore available metrics</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Directory exists: src/content/course/03-module-3/
2. Two lesson files exist with correct naming (01-, 02-)
3. `npm run build` passes without errors
4. Each file has proper frontmatter with order, difficulty, duration
5. Mermaid diagrams render correctly
6. PromQL examples are syntactically correct
7. Content references existing lab infrastructure from Phase 4
</verification>

<success_criteria>
- 2 MDX files created in src/content/course/03-module-3/
- Total 380+ lines across both files
- 3+ Mermaid diagrams total
- All files pass content collection validation
- Build completes without errors
- Students can immediately use lab environment to practice queries
</success_criteria>

<output>
After completion, create `.planning/phases/07-module-3-production-operations/07-01-SUMMARY.md`
</output>
