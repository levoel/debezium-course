---
phase: 23-homepage-redesign-accordion-module-cards
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ModuleAccordion.tsx
  - src/styles/global.css
autonomous: true

must_haves:
  truths:
    - "Module cards display with glass effect (visible semi-transparent background with blur)"
    - "Click on module header expands/collapses that module"
    - "All modules collapsed by default on page load"
    - "Progress percentage visible on each module header"
    - "Expanded module shows all lessons with navigation links"
  artifacts:
    - path: "src/components/ModuleAccordion.tsx"
      provides: "React component for accordion module cards with glass effect"
      exports: ["ModuleAccordion"]
      min_lines: 120
    - path: "src/styles/global.css"
      provides: "Glass card utility class for module cards"
      contains: ".glass-card"
  key_links:
    - from: "ModuleAccordion.tsx"
      to: "$progress store"
      via: "useStore hook"
      pattern: "useStore.*\\$progress"
    - from: "ModuleAccordion.tsx"
      to: "moduleNames.ts"
      via: "import"
      pattern: "import.*getModuleName.*moduleNames"
---

<objective>
Create React ModuleAccordion component with glass-styled cards and per-module progress indicators

Purpose: This component provides the interactive accordion behavior for the homepage, with modules collapsed by default, glass card styling, and real-time progress tracking per module.

Output: ModuleAccordion.tsx component ready for homepage integration, plus glass-card CSS utility class
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-foundation-glass-design-system-module-naming/22-01-SUMMARY.md
@.planning/phases/22-foundation-glass-design-system-module-naming/22-02-SUMMARY.md

# Existing patterns to follow
@src/components/Navigation.tsx - Accordion pattern with expandedModules Set, toggleModule function
@src/stores/progress.ts - Progress store structure ($progress.completed array)
@src/utils/moduleNames.ts - getModuleName, getModuleNumber utilities
@src/styles/global.css - Glass utilities (.glass-panel, .glass-panel-elevated)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add glass-card CSS utility class to global.css</name>
  <files>src/styles/global.css</files>
  <action>
Add new glass utility class for module cards after existing .glass-sidebar class:

```css
/* Glass card for module cards - strong effect with hover lift */
.glass-card {
  background: rgba(255, 255, 255, var(--glass-bg-opacity));
  backdrop-filter: blur(var(--glass-blur-lg));
  -webkit-backdrop-filter: blur(var(--glass-blur-lg));
  border: 1px solid var(--glass-border-color);
  border-radius: var(--glass-border-radius);
  box-shadow: var(--glass-shadow);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.glass-card:hover {
  transform: translateY(-2px);
  box-shadow: var(--glass-shadow-elevated);
}
```

Also add accessibility handling in the existing @media (prefers-reduced-transparency) block:
- Add .glass-card to the backdrop-filter: none rule

Also add .glass-card to the @supports fallback block (for browsers without backdrop-filter)

Also add reduced-motion handling:
- In @media (prefers-reduced-motion) add .glass-card with transition: none
  </action>
  <verify>
Run `npm run build` - no errors
Grep for "glass-card" in global.css confirms class exists with hover state
  </verify>
  <done>
.glass-card class exists with 16px blur, hover lift animation (-2px transform), and accessibility/reduced-motion fallbacks
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ModuleAccordion React component</name>
  <files>src/components/ModuleAccordion.tsx</files>
  <action>
Create new React component following Navigation.tsx patterns:

1. **Props interface:**
```typescript
interface LessonItem {
  title: string;
  slug: string;
  difficulty: string;
  estimatedTime: number;
}

type ModuleEntry = [string, LessonItem[]];

interface ModuleAccordionProps {
  modules: ModuleEntry[];
  basePath?: string;
}
```

2. **State management:**
- `expandedModules: Set<string>` - starts empty (all collapsed by default)
- `mounted: boolean` - for SSR safety (progress only calculated client-side)

3. **Progress calculation per module:**
```typescript
const getModuleProgress = (lessons: LessonItem[]): { completed: number; total: number; percentage: number } => {
  const completedCount = lessons.filter(l => completed.includes(l.slug)).length;
  return {
    completed: completedCount,
    total: lessons.length,
    percentage: lessons.length > 0 ? Math.round((completedCount / lessons.length) * 100) : 0
  };
};
```

4. **Toggle function:**
```typescript
const toggleModule = (moduleId: string) => {
  setExpandedModules(prev => {
    const next = new Set(prev);
    if (next.has(moduleId)) {
      next.delete(moduleId);
    } else {
      next.add(moduleId);
    }
    return next;
  });
};
```

5. **Render structure for each module:**
```jsx
<div className="glass-card overflow-hidden">
  {/* Header button - always visible */}
  <button
    onClick={() => toggleModule(moduleId)}
    className="w-full px-6 py-4 flex items-center justify-between text-left"
    aria-expanded={isExpanded}
    aria-controls={`module-${moduleId}-content`}
  >
    <div className="flex items-center gap-4">
      <span className="text-2xl font-bold text-blue-400">{moduleNumber}</span>
      <div>
        <h3 className="text-lg font-semibold text-gray-100">{moduleName}</h3>
        <span className="text-sm text-gray-400">{lessons.length} уроков</span>
      </div>
    </div>
    <div className="flex items-center gap-4">
      {/* Progress indicator */}
      <div className="text-right">
        <span className="text-lg font-semibold text-gray-100">{progress.percentage}%</span>
        <div className="w-20 h-1.5 bg-gray-700 rounded-full mt-1">
          <div className="bg-blue-500 h-1.5 rounded-full" style={{ width: `${progress.percentage}%` }} />
        </div>
      </div>
      {/* Chevron */}
      <svg className={`w-5 h-5 text-gray-400 transition-transform duration-200 ${isExpanded ? 'rotate-180' : ''}`}>
        <path d="M19 9l-7 7-7-7" />
      </svg>
    </div>
  </button>

  {/* Expandable lesson list */}
  <div
    id={`module-${moduleId}-content`}
    className={`overflow-hidden transition-all duration-200 ${isExpanded ? 'max-h-[2000px]' : 'max-h-0'}`}
  >
    <div className="px-6 pb-4 pt-2 border-t border-white/10">
      <ul className="space-y-2">
        {lessons.map(lesson => (
          <li key={lesson.slug}>
            <a
              href={`${basePath}/course/${lesson.slug}`}
              className="flex items-center justify-between px-4 py-3 rounded-lg bg-gray-800/30 hover:bg-gray-800/50 transition-colors"
            >
              <div className="flex items-center gap-3">
                {isComplete && <CheckIcon />}
                <span className="text-gray-200">{lesson.title}</span>
              </div>
              <div className="flex items-center gap-2 text-sm text-gray-500">
                <span>{lesson.estimatedTime} мин</span>
                <DifficultyBadge difficulty={lesson.difficulty} />
              </div>
            </a>
          </li>
        ))}
      </ul>
    </div>
  </div>
</div>
```

6. **Helper functions:**
- `getDifficultyColor(difficulty)` - returns Tailwind classes for badge
- `translateDifficulty(difficulty)` - Russian translation

7. **Keyboard accessibility:**
- Button element for module header (Enter/Space to toggle)
- aria-expanded and aria-controls attributes
- Focus-visible styles on button

8. **SSR safety:**
- Show 0% progress during SSR
- useEffect to set mounted=true
- Only read progress store when mounted

Import from:
- `@nanostores/react` for useStore
- `../stores/progress` for $progress
- `../utils/moduleNames` for getModuleName, getModuleNumber
  </action>
  <verify>
Run `npm run build` - TypeScript compiles without errors
Component exports ModuleAccordion
Grep confirms useStore($progress) usage for progress tracking
  </verify>
  <done>
ModuleAccordion.tsx exists with:
- All modules collapsed by default (empty expandedModules Set)
- Click toggles expand/collapse
- Progress percentage per module (from $progress store)
- Glass card styling via glass-card class
- Keyboard accessible (button with aria-expanded)
- SSR-safe (mounted state for progress)
  </done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `src/components/ModuleAccordion.tsx` exists and exports ModuleAccordion
3. `src/styles/global.css` contains .glass-card with hover lift animation
4. ModuleAccordion imports from progress store and moduleNames utility
</verification>

<success_criteria>
- ModuleAccordion component created with glass card styling
- Progress indicator shows percentage per module
- All modules collapsed by default
- Click on header expands/collapses lessons
- Accessibility: keyboard navigation works (Enter/Space on headers)
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-homepage-redesign-accordion-module-cards/23-01-SUMMARY.md`
</output>
