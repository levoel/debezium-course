---
phase: 08-module-4-advanced-patterns
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/04-module-4/01-smt-overview.mdx
  - src/content/course/04-module-4/02-predicates-filtering.mdx
autonomous: true

must_haves:
  truths:
    - "Student can explain what SMTs are and when to use them"
    - "Student can list Debezium built-in SMTs with their purposes"
    - "Student can configure predicates to selectively apply transformations"
    - "Student can filter events by operation type using Filter SMT"
  artifacts:
    - path: "src/content/course/04-module-4/01-smt-overview.mdx"
      provides: "SMT introduction and built-in SMT catalog"
      contains: "Single Message Transformations"
    - path: "src/content/course/04-module-4/02-predicates-filtering.mdx"
      provides: "Predicate configuration and Filter SMT usage"
      contains: "predicates"
  key_links:
    - from: "01-smt-overview.mdx"
      to: "research findings"
      via: "SMT chaining pattern"
      pattern: "transforms.filter.type"
    - from: "02-predicates-filtering.mdx"
      to: "connector config"
      via: "predicate application"
      pattern: "TopicNameMatches"
---

<objective>
Create SMT foundation lessons covering Single Message Transformations overview and predicate-based filtering.

Purpose: Students need a solid foundation in SMT concepts before applying specific transformations like masking and routing.
Output: Two MDX lesson files teaching SMT fundamentals and selective transformation application.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-module-4-advanced-patterns/08-RESEARCH.md

# Pattern reference
@src/content/course/03-module-3/01-jmx-metrics-interpretation.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SMT Overview Lesson (01-smt-overview.mdx)</name>
  <files>src/content/course/04-module-4/01-smt-overview.mdx</files>
  <action>
Create lesson introducing Single Message Transformations (SMTs) for Debezium CDC pipelines.

Content structure:
1. **Why SMTs matter** - Transform events before Kafka (reduce consumer complexity)
2. **SMT execution model** - Synchronous, in Kafka Connect worker thread, ordered
3. **Built-in Debezium SMTs catalog:**
   - ExtractNewRecordState (flatten envelope)
   - Filter (drop events by condition)
   - ByLogicalTableRouter (rename topics)
   - ContentBasedRouter (route by field values)
   - OutboxEventRouter (Outbox pattern)
   - MaskField (PII masking)
4. **SMT chaining** - Order matters: Filter -> Unwrap -> Route -> Mask
5. **Performance considerations** - Keep SMTs simple (<10ms per record), offload complex logic to Kafka Streams/Flink
6. **When NOT to use SMTs** - Aggregations, joins, external service calls

Include Mermaid diagram showing SMT execution flow in Kafka Connect pipeline.

Configuration example showing transform chaining:
```json
{
  "transforms": "filter,unwrap,route",
  "transforms.filter.type": "io.debezium.transforms.Filter",
  "transforms.unwrap.type": "io.debezium.transforms.ExtractNewRecordState",
  "transforms.route.type": "io.debezium.transforms.ByLogicalTableRouter"
}
```

Frontmatter:
- title: "Single Message Transformations: Overview"
- description: "Understanding Debezium SMTs for inline event processing"
- order: 1
- difficulty: "intermediate"
- estimatedTime: 25
- topics: ["smt", "transformations", "kafka-connect"]
- prerequisites: ["module-3/07-disaster-recovery-procedures"]

Language: Russian explanatory text, English code/config.
  </action>
  <verify>File exists at src/content/course/04-module-4/01-smt-overview.mdx with valid frontmatter and Mermaid import</verify>
  <done>Lesson explains SMT concept, lists built-in SMTs, shows chaining pattern, warns about performance limits</done>
</task>

<task type="auto">
  <name>Task 2: Create Predicates and Filtering Lesson (02-predicates-filtering.mdx)</name>
  <files>src/content/course/04-module-4/02-predicates-filtering.mdx</files>
  <action>
Create lesson teaching predicate-based selective transformation and Filter SMT usage.

Content structure:
1. **The predicate problem** - SMTs fail on heartbeat/tombstone messages (no `op` field)
2. **What are predicates** - Conditions that control when SMTs apply
3. **Built-in predicate types:**
   - TopicNameMatches (regex on topic name)
   - RecordIsTombstone (check for tombstones)
   - HasHeaderKey (check message headers)
4. **Predicate configuration syntax:**
   ```json
   "transforms.unwrap.predicate": "IsDataEvent",
   "predicates": "IsDataEvent",
   "predicates.IsDataEvent.type": "org.apache.kafka.connect.transforms.predicates.TopicNameMatches",
   "predicates.IsDataEvent.pattern": "dbserver1.inventory.*"
   ```
5. **Filter SMT with Groovy** - JSR 223 scripting for complex conditions
   ```json
   "transforms.filter.type": "io.debezium.transforms.Filter",
   "transforms.filter.language": "jsr223.groovy",
   "transforms.filter.condition": "value.op == 'c' || value.op == 'u'"
   ```
6. **Negate predicates** - `negate: true` for inverse logic
7. **Lab: Filter only INSERT/UPDATE events** - Practical connector config

Include Mermaid diagram showing predicate decision tree.

Pitfall callout: Without predicates, SMTs that access `value.after` fail on heartbeat events.

Frontmatter:
- title: "Predicates and Event Filtering"
- description: "Selective SMT application with predicates and Filter SMT"
- order: 2
- difficulty: "intermediate"
- estimatedTime: 30
- topics: ["predicates", "filtering", "smt", "groovy"]
- prerequisites: ["module-4/01-smt-overview"]

Language: Russian explanatory text, English code/config.
  </action>
  <verify>File exists at src/content/course/04-module-4/02-predicates-filtering.mdx with valid frontmatter and predicate examples</verify>
  <done>Lesson explains predicate necessity, shows TopicNameMatches/RecordIsTombstone, demonstrates Filter SMT with Groovy</done>
</task>

</tasks>

<verification>
- Both MDX files exist in src/content/course/04-module-4/
- Frontmatter is valid YAML with required fields
- Mermaid diagrams import correctly
- Code blocks use correct language tags (json, sql, promql)
- Prerequisites chain correctly (01 -> module-3, 02 -> 01)
</verification>

<success_criteria>
- Lesson 01 covers SMT fundamentals with built-in SMT catalog
- Lesson 02 explains predicates and Filter SMT with Groovy
- Both lessons follow established pattern (Russian text, English code)
- Requirements MOD4-01 and MOD4-02 addressed
</success_criteria>

<output>
After completion, create `.planning/phases/08-module-4-advanced-patterns/08-01-SUMMARY.md`
</output>
