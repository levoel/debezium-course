---
phase: 28-module-1-diagram-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/diagrams/module1/CdcFundamentalsDiagrams.tsx
  - src/components/diagrams/module1/DebeziumArchitectureDiagrams.tsx
  - src/components/diagrams/module1/LabSetupDiagram.tsx
  - src/components/diagrams/module1/index.ts
autonomous: true

must_haves:
  truths:
    - "User can view CDC vs Polling comparison diagram in lesson 01"
    - "User can view CDC sequence flow diagram in lesson 01"
    - "User can view Debezium deployment modes diagram in lesson 02"
    - "User can view Kafka Connect cluster diagram in lesson 02"
    - "User can view CDC event flow sequence diagram in lesson 02"
    - "User can view Lab Setup architecture diagram with 4 subgroups in lesson 03"
    - "User can click any node to see detailed tooltip explanation"
  artifacts:
    - path: "src/components/diagrams/module1/CdcFundamentalsDiagrams.tsx"
      provides: "CDC comparison and sequence diagrams"
      exports: ["CdcComparisonDiagram", "CdcSequenceDiagram"]
    - path: "src/components/diagrams/module1/DebeziumArchitectureDiagrams.tsx"
      provides: "Debezium architecture diagrams"
      exports: ["DeploymentModesDiagram", "KafkaConnectClusterDiagram", "CdcEventFlowDiagram"]
    - path: "src/components/diagrams/module1/LabSetupDiagram.tsx"
      provides: "Lab setup architecture diagram"
      exports: ["LabSetupDiagram"]
    - path: "src/components/diagrams/module1/index.ts"
      provides: "Barrel export for module1 diagrams"
      contains: "export *"
  key_links:
    - from: "src/components/diagrams/module1/*.tsx"
      to: "src/components/diagrams/primitives"
      via: "import FlowNode, Arrow, DiagramContainer, DiagramTooltip, SequenceDiagram"
      pattern: "from.*primitives"
---

<objective>
Create glass diagram components for Module 1 lessons 01-03, replacing the first 6 Mermaid diagrams with interactive React components using established primitives.

Purpose: Migrate the most complex diagrams in Module 1 (CDC comparison, Debezium architecture, Lab Setup with 4 subgroups) to interactive glass components with detailed Russian tooltips.

Output: 3 component files + barrel export providing 6 diagram exports ready for MDX integration.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-module-1-diagram-migration/28-CONTEXT.md
@src/components/diagrams/primitives/types.ts
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx
@src/components/diagrams/primitives/SequenceDiagram.tsx
@src/content/course/01-module-1/01-cdc-fundamentals.mdx
@src/content/course/01-module-1/02-debezium-architecture.mdx
@src/content/course/01-module-1/03-lab-setup.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CdcFundamentalsDiagrams component</name>
  <files>
    src/components/diagrams/module1/CdcFundamentalsDiagrams.tsx
  </files>
  <action>
Create `src/components/diagrams/module1/CdcFundamentalsDiagrams.tsx` with two exported components:

**1. CdcComparisonDiagram** - Flowchart comparing Polling vs Log-based CDC
- Use two DiagramContainers side-by-side (flex row on desktop, column on mobile)
- Polling subgroup (rose color): APP -> DB -> APP flow with "SELECT каждые N минут" label
- CDC subgroup (emerald color): APP -> DB -> WAL -> Debezium -> Kafka flow
- FlowNode variants: app (rose for polling), database (purple), connector (emerald for Debezium), cluster (emerald for Kafka)
- Arrows with Russian labels describing data flow

**Tooltip content (detailed, 3-5 sentences):**
- Polling APP: "Приложение периодически опрашивает базу данных для поиска изменений. Этот подход создает постоянную нагрузку на БД и может пропускать быстрые изменения между интервалами опроса."
- CDC APP: "Приложение записывает данные в базу как обычно, не зная о CDC. Все изменения автоматически попадают в Kafka через Debezium без дополнительного кода."
- DB (both): "База данных хранит данные и ведет журнал транзакций (WAL). Для CDC используется этот встроенный механизм — никакой дополнительной нагрузки."
- WAL: "Write-Ahead Log — журнал транзакций, который PostgreSQL использует для durability. Каждое зафиксированное изменение гарантированно записано в WAL."
- Debezium: "Debezium читает WAL через logical replication и преобразует записи в события Kafka. Работает как источник истины для потока изменений."
- Kafka: "Apache Kafka хранит поток CDC-событий и доставляет их потребителям. События сохраняются и могут быть перечитаны при необходимости."

**2. CdcSequenceDiagram** - Sequence diagram showing CDC event flow
- Use SequenceDiagram component with actors and messages
- Actors: App (service), PostgreSQL (database), WAL (queue), Debezium (service), Kafka (queue), Consumer (external)
- Messages: INSERT -> Write to WAL -> OK -> Read changes -> Change event -> CDC Event -> ACK -> poll() -> CDC Event -> Process

**Tooltip content for actors:**
- App: "Приложение выполняет операции с базой данных (INSERT, UPDATE, DELETE). Не знает о CDC — просто работает с PostgreSQL как обычно."
- PostgreSQL: "СУБД принимает SQL-команды, выполняет их и записывает изменения в WAL. Подтверждает транзакцию после записи в журнал."
- WAL: "Transaction Log хранит последовательность всех изменений. Debezium читает этот журнал через механизм logical replication."
- Debezium: "CDC-коннектор читает WAL, преобразует изменения в структурированные события и отправляет в Kafka с гарантией доставки."
- Kafka: "Брокер сообщений хранит события в топиках. Подтверждает запись (ACK) и доставляет события потребителям по запросу."
- Consumer: "Потребитель получает CDC-события через poll(). Может обрабатывать в реальном времени или батчами."

Use responsive layout: `className="flex flex-col lg:flex-row gap-6"` for comparison diagram.
  </action>
  <verify>
- File exists at src/components/diagrams/module1/CdcFundamentalsDiagrams.tsx
- TypeScript compiles without errors: `npx tsc --noEmit`
- Exports CdcComparisonDiagram and CdcSequenceDiagram
  </verify>
  <done>
CdcFundamentalsDiagrams.tsx exports two diagram components with full tooltip content for all interactive elements.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DebeziumArchitectureDiagrams component</name>
  <files>
    src/components/diagrams/module1/DebeziumArchitectureDiagrams.tsx
  </files>
  <action>
Create `src/components/diagrams/module1/DebeziumArchitectureDiagrams.tsx` with three exported components:

**1. DeploymentModesDiagram** - Three deployment modes comparison
- Three DiagramContainers in a column (or row on xl screens)
- MODE1 "Kafka Connect" (emerald, recommended=true): DB -> Connector -> KC Cluster -> Kafka
- MODE2 "Debezium Server" (blue): DB -> Server -> Sink -> Cloud Services
- MODE3 "Embedded Engine" (rose): DB -> Java App -> Any Target
- Each mode should show the flow with appropriate FlowNode variants

**Tooltip content:**
- Kafka Connect mode: "Рекомендуемый режим для 90% случаев. Debezium работает как коннектор внутри Kafka Connect, который обеспечивает масштабирование, отказоустойчивость и управление offsets автоматически."
- Debezium Server: "Standalone приложение для сценариев без Kafka. Читает WAL и отправляет события напрямую в облачные сервисы: Google Pub/Sub, AWS Kinesis, Azure Event Hubs."
- Embedded Engine: "Максимальный контроль — Debezium встраивается как библиотека в Java-приложение. Минимальная latency, но вы сами отвечаете за offset management и отказоустойчивость."
- Database nodes: "Исходная база данных с включенной logical replication. Debezium подключается через replication slot."
- Kafka Connect Cluster: "Кластер workers, распределяющих нагрузку. REST API на порту 8083 для управления коннекторами."
- Cloud Sink: "Адаптер для отправки событий в облачные сервисы без промежуточного Kafka."

**2. KafkaConnectClusterDiagram** - Kafka Connect internal architecture
- Main container with CLUSTER subgroup showing Worker 1, 2, 3 interconnected
- TOPICS subgroup: connect-configs, connect-offsets, connect-status
- REST API node pointing to cluster
- Data Topics output

**Tooltip content:**
- Workers: "JVM процессы, выполняющие коннекторы. В distributed mode образуют кластер и автоматически распределяют tasks между собой."
- connect-configs: "Kafka топик хранящий конфигурации всех коннекторов. Реплицируется между workers."
- connect-offsets: "Топик с позициями чтения (где остановились в WAL). Критичен для exactly-once семантики."
- connect-status: "Статусы коннекторов и tasks. Используется для мониторинга и health checks."
- REST API: "HTTP API на порту 8083 для создания, настройки и управления коннекторами. Основной интерфейс администрирования."
- Data Topics: "Топики с CDC-событиями. Именование: {topic.prefix}.{schema}.{table}"

**3. CdcEventFlowDiagram** - Complete CDC event flow sequence diagram
- Use SequenceDiagram with actors: App, PostgreSQL, WAL, Debezium, KC, Kafka, Consumer
- Show full flow from UPDATE through publication to consumer processing
- Include note about Logical Replication Protocol

**Tooltip content for messages:**
- UPDATE command: "SQL команда изменения данных. PostgreSQL выполняет её в рамках транзакции."
- Write to WAL: "PostgreSQL записывает изменение в transaction log перед подтверждением. Гарантирует durability."
- Replication slot request: "Debezium читает WAL через replication slot — механизм, гарантирующий что изменения не будут удалены до прочтения."
- pgoutput format: "Встроенный плагин PostgreSQL для logical decoding. Преобразует WAL в читаемый формат без установки дополнительного ПО."
- CDC format conversion: "Debezium преобразует pgoutput в универсальный envelope-формат с полями before/after/op/source."
- Publication to topic: "Событие публикуется в Kafka топик inventory.public.customers. Kafka подтверждает запись."
- Offset save: "Kafka Connect сохраняет позицию в connect-offsets. При перезапуске продолжит с этого места."
  </action>
  <verify>
- File exists at src/components/diagrams/module1/DebeziumArchitectureDiagrams.tsx
- TypeScript compiles without errors: `npx tsc --noEmit`
- Exports DeploymentModesDiagram, KafkaConnectClusterDiagram, CdcEventFlowDiagram
  </verify>
  <done>
DebeziumArchitectureDiagrams.tsx exports three diagram components covering all Debezium architecture visualizations.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create LabSetupDiagram component and barrel export</name>
  <files>
    src/components/diagrams/module1/LabSetupDiagram.tsx
    src/components/diagrams/module1/index.ts
  </files>
  <action>
**1. Create `src/components/diagrams/module1/LabSetupDiagram.tsx`:**

Complex diagram with 4 nested DiagramContainers representing Docker Compose stack:

- Outer container: "Docker Compose Stack" (neutral)
- DATA subgroup (purple): PostgreSQL :5433
- STREAMING subgroup (blue): Kafka :9092, Schema Registry :8081, Debezium Connect :8083
- MONITORING subgroup (rose): Prometheus :9090, Grafana :3000
- EXERCISES subgroup (amber): JupyterLab :8888

**Layout:**
```
+------------------------------------------+
|           Docker Compose Stack           |
|  +--------+   +-----------------------+  |
|  | DATA   |   | STREAMING             |  |
|  | PG     |-->| Kafka  SR  Connect    |  |
|  +--------+   +-----------------------+  |
|  +--------------+   +-----------------+  |
|  | MONITORING   |   | EXERCISES       |  |
|  | Prom Grafana |   | JupyterLab      |  |
|  +--------------+   +-----------------+  |
+------------------------------------------+
```

Use CSS Grid or Flexbox for responsive layout:
- Mobile: single column
- Desktop: 2x2 grid for inner containers

**Arrows showing data flow:**
- PG -> Connect (WAL)
- Connect -> Kafka (Events)
- Kafka -> SR (Schema)
- Connect -> Prom (Metrics)
- Prom -> Grafana (Dashboard)
- Kafka -> JUP (Consume)
- PG -> JUP (Query)

**Tooltip content:**
- PostgreSQL: "База данных с wal_level=logical и настроенными replication slots. Порт 5433 (не 5432!) чтобы избежать конфликта с локальной установкой PostgreSQL."
- Kafka: "Apache Kafka в KRaft режиме (без ZooKeeper). Confluent Platform 7.8.1. Хранит CDC-события и internal топики Kafka Connect."
- Schema Registry: "Хранилище Avro/JSON схем. Позволяет эволюционировать структуру событий с проверкой совместимости."
- Debezium Connect: "Kafka Connect с установленным Debezium PostgreSQL коннектором. REST API на порту 8083 для управления."
- Prometheus: "Сбор метрик из Kafka Connect через JMX. Хранит time-series данные для мониторинга CDC pipeline."
- Grafana: "Дашборды для визуализации метрик. Логин: admin/admin. Подключен к Prometheus как data source."
- JupyterLab: "Python окружение для экспериментов. confluent-kafka библиотека уже установлена. Подключается к Kafka как kafka:9092 (внутренняя сеть Docker)."

**2. Create `src/components/diagrams/module1/index.ts`:**

Barrel export file:
```typescript
export * from './CdcFundamentalsDiagrams';
export * from './DebeziumArchitectureDiagrams';
export * from './LabSetupDiagram';
```
  </action>
  <verify>
- File exists at src/components/diagrams/module1/LabSetupDiagram.tsx
- File exists at src/components/diagrams/module1/index.ts
- TypeScript compiles without errors: `npx tsc --noEmit`
- All 6 diagrams importable from index: CdcComparisonDiagram, CdcSequenceDiagram, DeploymentModesDiagram, KafkaConnectClusterDiagram, CdcEventFlowDiagram, LabSetupDiagram
  </verify>
  <done>
LabSetupDiagram shows the complete Docker environment with 4 subgroups, and index.ts provides clean barrel export for all Module 1 diagrams.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `cd "/Users/levoely/debezium course" && npx tsc --noEmit`
2. Verify all exports: Create a test file that imports all 6 components
3. Count exports matches expected (6 diagram components)
4. All tooltips use Russian text as per CONTEXT.md decisions
</verification>

<success_criteria>
- 6 diagram components created and exported
- All components use primitives from Phase 26-27 (FlowNode, Arrow, DiagramContainer, DiagramTooltip, SequenceDiagram)
- Detailed Russian tooltips on all interactive nodes (3-5 sentences each)
- TypeScript compiles without errors
- Components follow patterns established in primitives (forwardRef for FlowNode, DiagramTooltip wrapping)
</success_criteria>

<output>
After completion, create `.planning/phases/28-module-1-diagram-migration/28-01-SUMMARY.md`
</output>
