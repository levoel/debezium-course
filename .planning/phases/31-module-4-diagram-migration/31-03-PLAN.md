---
phase: 31-module-4-diagram-migration
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/diagrams/module4/ConnectorScalingDiagrams.tsx
  - src/components/diagrams/module4/DisasterRecoveryDiagrams.tsx
  - src/components/diagrams/module4/index.ts
autonomous: true

must_haves:
  truths:
    - "tasks.max myth diagram shows myth (red, 4 parallel) vs reality (green, 1 task)"
    - "WAL sequential architecture shows why parallelization is impossible"
    - "Single-task architecture highlights reader as bottleneck"
    - "Multiple connectors strategy shows table-to-connector distribution"
    - "Downstream parallelization shows partition-based scaling"
    - "Decision framework diagram shows scaling strategy selection tree"
    - "Failure modes diagram shows 4 failure types with 4 impact types"
    - "State storage locations shows Kafka + PostgreSQL + Connect state distribution"
    - "Orphaned slot cleanup shows safe decision tree"
    - "User can click nodes to see scaling and DR explanations"
  artifacts:
    - path: "src/components/diagrams/module4/ConnectorScalingDiagrams.tsx"
      provides: "Connector scaling visualization (6 exports)"
      exports: ["TasksMaxMythDiagram", "WalSequentialDiagram", "SingleTaskArchitectureDiagram", "MultipleConnectorsDiagram", "DownstreamParallelizationDiagram", "ScalingDecisionFrameworkDiagram"]
    - path: "src/components/diagrams/module4/DisasterRecoveryDiagrams.tsx"
      provides: "Disaster recovery visualization (3 exports)"
      exports: ["FailureModesDiagram", "StateStorageLocationsDiagram", "OrphanedSlotCleanupDiagram"]
  key_links:
    - from: "src/components/diagrams/module4/ConnectorScalingDiagrams.tsx"
      to: "primitives/FlowNode"
      via: "import"
      pattern: "import.*FlowNode.*from.*primitives"
    - from: "src/components/diagrams/module4/DisasterRecoveryDiagrams.tsx"
      to: "primitives/DiagramContainer"
      via: "import"
      pattern: "import.*DiagramContainer.*from.*primitives"
---

<objective>
Create glass diagram components for Module 4 lessons 06-07: connector scaling strategies and disaster recovery procedures.

Purpose: Provides interactive diagrams explaining why tasks.max doesn't parallelize CDC, alternative scaling strategies, failure modes, and recovery procedures.
Output: 2 diagram files with 9 total diagram exports (6 scaling + 3 DR).
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-module-4-diagram-migration/31-RESEARCH.md

# Primitives reference
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx
@src/components/diagrams/primitives/types.ts

# Module 4 MDX files (diagram source)
@src/content/course/04-module-4/06-connector-scaling-tasks.mdx
@src/content/course/04-module-4/07-disaster-recovery-procedures.mdx

# Prior comparison diagram reference
@src/components/diagrams/module3/GtidDiagrams.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConnectorScalingDiagrams.tsx</name>
  <files>
    src/components/diagrams/module4/ConnectorScalingDiagrams.tsx
  </files>
  <action>
Create ConnectorScalingDiagrams.tsx with 6 diagram exports:

1. **TasksMaxMythDiagram** (2 subgraphs side-by-side):
   - Left (rose): "MYTH: tasks.max=4" - 4 parallel task boxes reading WAL
   - Right (emerald): "REALITY" - 1 task box, config ignored
   - Amber text showing "tasks.max=4 IGNORED"
   - Tooltips: "tasks.max is ignored for PostgreSQL - WAL is read sequentially"

2. **WalSequentialDiagram** (horizontal flowchart LR):
   - WAL events with LSN labels (LSN1, LSN2, LSN3...)
   - Single arrow through replication slot
   - Shows why parallelization impossible
   - Tooltips explain LSN ordering requirement

3. **SingleTaskArchitectureDiagram** (vertical flowchart TB):
   - PostgreSQL (database) -> Debezium container with 3 internal boxes:
     - Reader (rose, highlighted as bottleneck)
     - Queue
     - Writer
   - -> Kafka (cluster)
   - Tooltips highlight Reader as single-threaded bottleneck

4. **MultipleConnectorsDiagram** (horizontal flowchart LR):
   - 3 database tables (blue/purple/emerald) -> 3 separate connectors -> 3 Kafka topic groups
   - Color-coded by domain
   - Tooltips: "Separate connectors for independent table groups - horizontal scaling"

5. **DownstreamParallelizationDiagram** (horizontal flowchart LR):
   - Single connector -> Multi-partition Kafka topic -> Multiple consumer instances
   - Shows partition-based scaling
   - Tooltips: "Scaling via Kafka partitions - parallelization at consumer level"

6. **ScalingDecisionFrameworkDiagram** (decision tree TD):
   - Root: "Throughput bottleneck?"
   - Branches to: Tuning (amber), Multiple connectors (blue), Downstream (purple), Hybrid (emerald)
   - Each terminal node explains when to use that strategy
   - Tooltips: "Performance ceiling ~7,000 events/sec per connector"
  </action>
  <verify>
    - Run `npm run build` - no TypeScript errors
    - File exists at src/components/diagrams/module4/ConnectorScalingDiagrams.tsx
    - grep confirms 6 exports: TasksMaxMythDiagram, WalSequentialDiagram, SingleTaskArchitectureDiagram, MultipleConnectorsDiagram, DownstreamParallelizationDiagram, ScalingDecisionFrameworkDiagram
  </verify>
  <done>
    ConnectorScalingDiagrams.tsx exists with 6 exported diagram components covering tasks.max myth, WAL architecture, and scaling strategies
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DisasterRecoveryDiagrams.tsx and update index.ts</name>
  <files>
    src/components/diagrams/module4/DisasterRecoveryDiagrams.tsx
    src/components/diagrams/module4/index.ts
  </files>
  <action>
Create DisasterRecoveryDiagrams.tsx with 3 diagram exports:

1. **FailureModesDiagram** (flowchart TB with grid):
   - Top row: 4 failure types (blue/amber/rose/purple):
     - Connect crash (blue)
     - Accidental deletion (amber)
     - DB failover (rose)
     - Kafka loss (purple)
   - Bottom row: 4 impact types
   - Arrows connecting failure to impact
   - Tooltips explain each failure scenario and recovery path

2. **StateStorageLocationsDiagram** (horizontal flowchart LR):
   - Kafka section: configs topic, offsets topic, statuses topic
   - PostgreSQL section: replication slot, WAL segments
   - Connect section: running tasks
   - Use nested DiagramContainers for grouping
   - Tooltips: "State is distributed - recovery requires coordinating all locations"

3. **OrphanedSlotCleanupDiagram** (decision tree TD):
   - Root: "Slot without connector?"
   - Branches:
     - Connector exists? Yes -> WAIT
     - PAUSED? Yes -> WAIT
     - Documented? Yes -> ESCALATE
     - No -> DROP (safe)
   - Color-coded outcomes: emerald (safe), amber (escalate), rose (wait)
   - Tooltips: "wal_status='lost' means point of no return - full resnapshot required"

**Update index.ts** to include all 7 diagram files:
```typescript
export * from './JmxMetricsDiagrams';
export * from './PrometheusCollectionDiagrams';
export * from './GrafanaDashboardDiagrams';
export * from './AlertingDiagrams';
export * from './WalBloatHeartbeatDiagrams';
export * from './ConnectorScalingDiagrams';
export * from './DisasterRecoveryDiagrams';
```
  </action>
  <verify>
    - Run `npm run build` - no TypeScript errors
    - File exists at src/components/diagrams/module4/DisasterRecoveryDiagrams.tsx
    - grep DisasterRecoveryDiagrams.tsx confirms 3 exports
    - grep index.ts confirms 7 export statements
    - ls module4/ shows 8 files total (7 diagram files + index.ts)
  </verify>
  <done>
    DisasterRecoveryDiagrams.tsx exists with 3 exports, index.ts updated with all 7 diagram files, total 24 exports for all 7 lessons
  </done>
</task>

</tasks>

<verification>
1. Run `npm run build` - zero errors
2. ls src/components/diagrams/module4/ shows 8 files
3. All 9 new exports available from index.ts
4. Total 24 diagram exports across 7 files matches audit count
</verification>

<success_criteria>
- 9 diagram components created (6 scaling + 3 DR)
- TasksMaxMythDiagram uses side-by-side comparison pattern
- Decision trees use flex with nested divs for branching
- Russian tooltips explain scaling limitations and DR procedures
- Build passes with zero TypeScript errors
- 24 total exports matches Module 4 diagram audit
</success_criteria>

<output>
After completion, create `.planning/phases/31-module-4-diagram-migration/31-03-SUMMARY.md`
</output>
