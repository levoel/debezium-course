---
phase: 34-module-7-diagram-migration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/diagrams/primitives/types.ts
  - src/components/diagrams/module7/CloudSqlDiagrams.tsx
  - src/components/diagrams/module7/DebeziumServerDiagrams.tsx
autonomous: true

must_haves:
  truths:
    - "User can see Cloud SQL CDC architecture diagram"
    - "User can see Kafka vs Kafka-less comparison diagrams"
    - "User can see Debezium Server internal architecture"
    - "User can click GCP service nodes to see Russian explanations"
    - "GCP services have distinct colors matching GCP brand"
  artifacts:
    - path: "src/components/diagrams/primitives/types.ts"
      provides: "6 new GCP-specific FlowNode variants"
      exports: ["FlowNodeVariant type with gcp-* variants"]
    - path: "src/components/diagrams/module7/CloudSqlDiagrams.tsx"
      provides: "1 diagram for lesson 01"
      exports: ["CloudSqlCdcArchitectureDiagram"]
    - path: "src/components/diagrams/module7/DebeziumServerDiagrams.tsx"
      provides: "3 diagrams for lesson 02"
      exports: ["TraditionalKafkaArchitectureDiagram", "KafkalessArchitectureDiagram", "DebeziumServerInternalDiagram"]
  key_links:
    - from: "src/components/diagrams/module7/*.tsx"
      to: "src/components/diagrams/primitives"
      via: "import FlowNode, Arrow, DiagramContainer"
      pattern: "import.*from.*primitives"
    - from: "FlowNode components"
      to: "gcp-* variants"
      via: "variant prop"
      pattern: "variant=\"gcp-"
---

<objective>
Extend FlowNode primitives with GCP-specific variants and create foundation service diagrams for Module 7 lessons 01-02.

Purpose: Establish GCP service visualization system with brand-aligned colors and create initial diagrams showing Cloud SQL CDC architecture and Debezium Server patterns. This foundation enables subsequent Module 7 diagram creation.

Output:
- 6 new GCP FlowNode variants in primitives/types.ts
- CloudSqlDiagrams.tsx with 1 diagram
- DebeziumServerDiagrams.tsx with 3 diagrams
- 4 total diagrams with Russian tooltips for GCP concepts
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-module-7-diagram-migration/34-RESEARCH.md

# Reference primitives for extension
@src/components/diagrams/primitives/types.ts
@src/components/diagrams/primitives/FlowNode.tsx

# Source MDX files for diagram understanding
@src/content/course/07-module-7/01-cloud-sql-setup.mdx
@src/content/course/07-module-7/02-debezium-server-pubsub.mdx

# Reference existing module patterns
@src/components/diagrams/module6/FeatureEngineeringDiagrams.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend primitives with GCP variants</name>
  <files>
    src/components/diagrams/primitives/types.ts
    src/components/diagrams/primitives/FlowNode.tsx
  </files>
  <action>
**1. Update types.ts to add 6 GCP-specific variants:**

Add to FlowNodeVariant union type:
```typescript
export type FlowNodeVariant =
  // Existing variants
  | 'database' | 'connector' | 'cluster' | 'sink' | 'app' | 'target'
  | 'service' | 'queue' | 'external'
  // GCP-specific variants (NEW)
  | 'gcp-database'   // Cloud SQL - blue #4285f4
  | 'gcp-messaging'  // Pub/Sub - amber #fbbc04
  | 'gcp-compute'    // GKE/Cloud Run/Dataflow - emerald #34a853
  | 'gcp-storage'    // BigQuery/Cloud Storage - blue #4285f4
  | 'gcp-monitoring' // Cloud Monitoring - rose #ea4335
  | 'gcp-security'   // IAM/Workload Identity - purple #a142f4
```

**2. Update FlowNode.tsx to add variant styles:**

Add to variantStyles object (after existing variants):
```typescript
// GCP-specific variants (official GCP brand colors)
'gcp-database': 'bg-blue-500/20 border-blue-400/40 text-blue-100',
'gcp-messaging': 'bg-amber-500/20 border-amber-400/40 text-amber-100',
'gcp-compute': 'bg-emerald-500/20 border-emerald-400/40 text-emerald-100',
'gcp-storage': 'bg-blue-600/20 border-blue-500/40 text-blue-100',
'gcp-monitoring': 'bg-rose-500/20 border-rose-400/40 text-rose-100',
'gcp-security': 'bg-purple-500/20 border-purple-400/40 text-purple-100',
```

**Rationale for GCP brand colors:**
- Blue (#4285f4): Data services (Cloud SQL, BigQuery)
- Amber (#fbbc04): Messaging (Pub/Sub)
- Emerald (#34a853): Compute (GKE, Cloud Run, Dataflow)
- Rose (#ea4335): Monitoring/Alerts
- Purple (#a142f4): Security (IAM)

These are official GCP brand colors aligned with their service categories.
  </action>
  <verify>
- types.ts contains 6 new gcp-* variants in FlowNodeVariant union
- FlowNode.tsx variantStyles includes all 6 gcp-* variants
- TypeScript compiles without errors: `npm run build`
- No duplicate variant keys in variantStyles object
  </verify>
  <done>
6 GCP FlowNode variants added with official GCP brand colors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CloudSqlDiagrams.tsx (1 diagram)</name>
  <files>src/components/diagrams/module7/CloudSqlDiagrams.tsx</files>
  <action>
Create CloudSqlDiagrams.tsx with 1 diagram for lesson 01.

**CloudSqlCdcArchitectureDiagram** (simple horizontal flow):

Layout: Horizontal flow showing Cloud SQL → Debezium Server → Pub/Sub pipeline

```typescript
import React from 'react';
import { FlowNode } from '../primitives/FlowNode';
import { Arrow } from '../primitives/Arrow';
import { DiagramContainer } from '../primitives/DiagramContainer';
import { Tooltip } from '../primitives/Tooltip';

export function CloudSqlCdcArchitectureDiagram() {
  return (
    <DiagramContainer
      title="Архитектура CDC на Cloud SQL"
      color="blue"
      description="Kafka-less CDC с использованием Google Cloud Pub/Sub"
    >
      <div className="flex flex-col md:flex-row items-center justify-center gap-3">
        <Tooltip content={
          <div>
            <p className="font-semibold mb-1">Cloud SQL PostgreSQL</p>
            <p className="text-sm">Managed PostgreSQL с logical decoding.</p>
            <p className="text-sm mt-1">Logical Decoding преобразует WAL в структурированные события.</p>
          </div>
        }>
          <FlowNode variant="gcp-database">
            Cloud SQL<br />PostgreSQL
          </FlowNode>
        </Tooltip>

        <Arrow direction="right" label="WAL Events" />

        <Tooltip content={
          <div>
            <p className="font-semibold mb-1">Debezium Server</p>
            <p className="text-sm">Standalone Quarkus приложение с source connector + sink adapter.</p>
            <p className="text-sm mt-1">Читает события из replication slot и публикует в Pub/Sub.</p>
          </div>
        }>
          <FlowNode variant="connector">
            Debezium<br />Server
          </FlowNode>
        </Tooltip>

        <Arrow direction="right" label="CDC Events" />

        <Tooltip content={
          <div>
            <p className="font-semibold mb-1">Google Pub/Sub</p>
            <p className="text-sm">Managed message broker с автоматическим масштабированием.</p>
            <p className="text-sm mt-1">Заменяет Kafka в Kafka-less архитектуре.</p>
          </div>
        }>
          <FlowNode variant="gcp-messaging">
            Pub/Sub<br />Topics
          </FlowNode>
        </Tooltip>
      </div>

      <div className="mt-4 pt-3 border-t border-white/10 text-xs text-blue-200/70">
        <p>Replication Slot хранит позицию чтения и управляет удалением WAL файлов</p>
      </div>
    </DiagramContainer>
  );
}
```

**Key features:**
- Uses new `gcp-database` and `gcp-messaging` variants
- Russian tooltips explaining GCP services
- Responsive layout (vertical mobile, horizontal desktop)
- Footer note about replication slots
  </action>
  <verify>
- File exists at src/components/diagrams/module7/CloudSqlDiagrams.tsx
- Exports CloudSqlCdcArchitectureDiagram component
- Uses gcp-database and gcp-messaging variants
- All tooltips in Russian
- No TypeScript errors
  </verify>
  <done>
CloudSqlCdcArchitectureDiagram created with 3 nodes, GCP variants, Russian tooltips
  </done>
</task>

<task type="auto">
  <name>Task 3: Create DebeziumServerDiagrams.tsx (3 diagrams)</name>
  <files>src/components/diagrams/module7/DebeziumServerDiagrams.tsx</files>
  <action>
Create DebeziumServerDiagrams.tsx with 3 diagrams for lesson 02.

**1. TraditionalKafkaArchitectureDiagram** (side-by-side comparison pattern)

Vertical flow showing PostgreSQL → Debezium Connector → Kafka Connect → Kafka Cluster → Consumers

```typescript
<DiagramContainer
  title="Традиционная архитектура"
  color="amber"
  description="Kafka Connect с Kafka кластером"
>
  <div className="flex flex-col items-center gap-3">
    <FlowNode variant="database">PostgreSQL</FlowNode>
    <Arrow direction="down" label="WAL" />
    <FlowNode variant="connector">Debezium Connector</FlowNode>
    <Arrow direction="down" />
    <FlowNode variant="connector">Kafka Connect</FlowNode>
    <Arrow direction="down" />
    <Tooltip content="Требует развертывания и поддержки Zookeeper + brokers + Connect workers">
      <FlowNode variant="cluster" className="border-rose-400/50">
        Kafka Cluster
      </FlowNode>
    </Tooltip>
    <Arrow direction="down" />
    <div className="flex gap-2">
      <FlowNode variant="app" size="sm">Consumer 1</FlowNode>
      <FlowNode variant="app" size="sm">Consumer 2</FlowNode>
      <FlowNode variant="app" size="sm">Streams</FlowNode>
    </div>
  </div>
  <div className="mt-4 pt-3 border-t border-white/10 text-xs text-amber-200/70">
    <p>Высокая операционная сложность: Kafka + Zookeeper/KRaft + Connect</p>
  </div>
</DiagramContainer>
```

**2. KafkalessArchitectureDiagram** (parallel to Traditional, shows benefits)

Vertical flow showing Cloud SQL → Debezium Server → Pub/Sub → Consumers (Cloud Run, Dataflow, BigQuery)

```typescript
<DiagramContainer
  title="Kafka-less архитектура"
  color="emerald"
  description="Debezium Server + Pub/Sub (упрощенная инфраструктура)"
>
  <div className="flex flex-col items-center gap-3">
    <FlowNode variant="gcp-database">Cloud SQL PostgreSQL</FlowNode>
    <Arrow direction="down" label="WAL" />
    <Tooltip content="Standalone Quarkus приложение — один контейнер вместо Kafka cluster">
      <FlowNode variant="connector">Debezium Server</FlowNode>
    </Tooltip>
    <Arrow direction="down" label="CDC Events" />
    <Tooltip content="Pub/Sub автоматическое масштабирование заменяет Kafka партиции">
      <FlowNode variant="gcp-messaging">Google Pub/Sub</FlowNode>
    </Tooltip>
    <Arrow direction="down" />
    <div className="flex gap-2">
      <FlowNode variant="gcp-compute" size="sm">Cloud Run</FlowNode>
      <FlowNode variant="gcp-compute" size="sm">Dataflow</FlowNode>
      <FlowNode variant="gcp-storage" size="sm">BigQuery</FlowNode>
    </div>
  </div>
  <div className="mt-4 pt-3 border-t border-white/10 text-xs text-emerald-200/70">
    <p>Простая инфраструктура, serverless, низкие операционные затраты</p>
  </div>
</DiagramContainer>
```

**3. DebeziumServerInternalDiagram** (nested architecture showing internal components)

Shows Debezium Server internal structure: PostgreSQL Connector → Event Buffer → Sink Adapter, with offset storage options

```typescript
<DiagramContainer
  title="Debezium Server внутренняя архитектура"
  color="purple"
  description="Standalone Quarkus приложение с source connector + sink adapter"
>
  <div className="flex flex-col items-center gap-4">
    {/* External source */}
    <FlowNode variant="gcp-database">Cloud SQL PostgreSQL</FlowNode>
    <Arrow direction="down" label="WAL Stream" />

    {/* Debezium Server internals */}
    <DiagramContainer title="Debezium Server (Quarkus App)" color="blue" className="w-full">
      <div className="flex flex-col items-center gap-3">
        <Tooltip content="Source connector читает WAL через logical decoding">
          <FlowNode variant="connector" size="sm">PostgreSQL Connector</FlowNode>
        </Tooltip>
        <Arrow direction="down" />
        <Tooltip content="Буфер для batch обработки событий">
          <FlowNode variant="app" size="sm">Event Buffer</FlowNode>
        </Tooltip>
        <Arrow direction="down" />
        <Tooltip content="Sink adapter публикует события в Pub/Sub">
          <FlowNode variant="gcp-messaging" size="sm">Pub/Sub Sink Adapter</FlowNode>
        </Tooltip>
      </div>
    </DiagramContainer>

    <Arrow direction="down" />
    <FlowNode variant="gcp-messaging">Google Pub/Sub</FlowNode>

    {/* Offset storage options */}
    <div className="mt-4 pt-4 border-t border-white/10 w-full">
      <h3 className="text-sm font-semibold text-purple-200 mb-2 text-center">Offset Storage</h3>
      <div className="flex justify-center gap-3">
        <Tooltip content="File: offsets.dat — для single instance deployment">
          <FlowNode variant="app" size="sm" className="border-amber-400/50">
            File Storage
          </FlowNode>
        </Tooltip>
        <Tooltip content="Redis — для HA deployment с несколькими репликами">
          <FlowNode variant="sink" size="sm" className="border-emerald-400/50">
            Redis Storage
          </FlowNode>
        </Tooltip>
      </div>
      <p className="text-xs text-purple-200/70 mt-3 text-center">
        Offset storage критичен: без persistent storage при перезапуске pod потеряет позицию
      </p>
    </div>
  </div>
</DiagramContainer>
```

**Pattern used:**
- Comparison pattern: Traditional (amber, complexity warning) vs Kafka-less (emerald, simplicity emphasis)
- Nested DiagramContainer for internal structure
- Color-coded offset storage options with tooltips
- Russian tooltips explaining architecture trade-offs
  </action>
  <verify>
- File exists at src/components/diagrams/module7/DebeziumServerDiagrams.tsx
- Exports 3 diagram components: TraditionalKafkaArchitectureDiagram, KafkalessArchitectureDiagram, DebeziumServerInternalDiagram
- Uses gcp-database, gcp-messaging, gcp-compute, gcp-storage variants
- All tooltips in Russian
- No TypeScript errors
  </verify>
  <done>
3 Debezium Server diagrams created showing Kafka vs Kafka-less comparison and internal architecture
  </done>
</task>

</tasks>

<verification>
- primitives/types.ts contains 6 new gcp-* variants
- FlowNode.tsx has styles for all 6 gcp-* variants
- CloudSqlDiagrams.tsx exists with 1 diagram
- DebeziumServerDiagrams.tsx exists with 3 diagrams
- All 4 diagrams use GCP brand colors
- All tooltips in Russian
- TypeScript compiles: `npm run build`
- Dev server renders diagrams: `npm run dev`
- Module 7 folder structure created at src/components/diagrams/module7/
</verification>

<success_criteria>
- 6 GCP FlowNode variants added to primitives
- 4 foundation diagrams created (1 Cloud SQL + 3 Debezium Server)
- GCP services have distinct brand-aligned colors
- All diagrams have Russian tooltips
- Requirements MOD7-01 (audit) and MOD7-02 (create glass versions) partially complete for lessons 01-02
- Foundation established for Wave 2 diagrams
</success_criteria>

<output>
After completion, create `.planning/phases/34-module-7-diagram-migration/34-01-SUMMARY.md`
</output>
