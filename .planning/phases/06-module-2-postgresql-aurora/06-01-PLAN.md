---
phase: 06-module-2-postgresql-aurora
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/content/course/02-module-2/01-logical-decoding-deep-dive.mdx
  - src/content/course/02-module-2/02-replication-slots-lifecycle.mdx
  - src/content/course/02-module-2/03-wal-configuration-tuning.mdx
autonomous: true

must_haves:
  truths:
    - "Students can explain how pgoutput plugin converts WAL to logical changes"
    - "Students can query pg_replication_slots and interpret lag_bytes, wal_status"
    - "Students understand wal_level=logical performance impact (5-15% WAL increase)"
    - "Students know max_slot_wal_keep_size prevents disk exhaustion"
  artifacts:
    - path: "src/content/course/02-module-2/01-logical-decoding-deep-dive.mdx"
      provides: "pgoutput internals, WAL anatomy, logical decoding flow"
      min_lines: 150
    - path: "src/content/course/02-module-2/02-replication-slots-lifecycle.mdx"
      provides: "Slot creation, monitoring queries, cleanup procedures"
      min_lines: 180
    - path: "src/content/course/02-module-2/03-wal-configuration-tuning.mdx"
      provides: "WAL parameters, performance baseline, monitoring metrics"
      min_lines: 150
  key_links:
    - from: "01-logical-decoding-deep-dive.mdx"
      to: "02-replication-slots-lifecycle.mdx"
      via: "pgoutput creates slots, slots track consumption position"
    - from: "02-replication-slots-lifecycle.mdx"
      to: "03-wal-configuration-tuning.mdx"
      via: "max_slot_wal_keep_size limits slot WAL retention"
---

<objective>
Create PostgreSQL CDC foundation lessons covering logical decoding mechanics, replication slot lifecycle, and WAL configuration tuning.

Purpose: Students must understand PostgreSQL internals before configuring Debezium for production. These three lessons form the conceptual foundation for all subsequent CDC configuration.

Output: Three MDX lessons (01, 02, 03) in src/content/course/02-module-2/ directory with Mermaid diagrams, SQL monitoring queries, and performance impact explanations.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-module-2-postgresql-aurora/06-RESEARCH.md

# Established patterns from Module 1
@src/content/course/01-module-1/01-cdc-fundamentals.mdx
@src/content/course/01-module-1/02-debezium-architecture.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Logical Decoding Deep-Dive lesson</name>
  <files>src/content/course/02-module-2/01-logical-decoding-deep-dive.mdx</files>
  <action>
Create comprehensive lesson on PostgreSQL logical decoding (MOD2-01):

**Structure:**
1. What is logical decoding (vs physical replication)
2. pgoutput plugin internals - why it's the standard (built-in since PG 10+, no dependencies)
3. WAL anatomy for logical decoding - what gets logged, how changes are decoded
4. Publication/subscription model - CREATE PUBLICATION, table filtering
5. How Debezium uses pgoutput - connector configuration mapping

**Include:**
- Mermaid diagram: WAL -> Logical Decoding -> pgoutput -> Debezium flow
- Mermaid diagram: Publication scope (FOR ALL TABLES vs specific tables)
- SQL examples: CREATE PUBLICATION, pg_publication queries
- REPLICA IDENTITY explanation (DEFAULT vs FULL) with performance impact
- Comparison: pgoutput vs wal2json vs decoderbufs (pgoutput wins for Debezium)

**Style:**
- Russian explanatory text, English code/config
- Progressive disclosure - start with "what" before "how"
- Frontmatter: title, description, order: 1, difficulty: intermediate, duration: 25min, topics: [logical-decoding, pgoutput, wal, publications]
  </action>
  <verify>
- File exists at src/content/course/02-module-2/01-logical-decoding-deep-dive.mdx
- `npm run build` passes without errors
- File has 2+ Mermaid diagrams
- File has 150+ lines
  </verify>
  <done>Students can explain logical decoding pipeline from WAL through pgoutput to Debezium, understand publication configuration, and know when to use REPLICA IDENTITY FULL</done>
</task>

<task type="auto">
  <name>Task 2: Create Replication Slots Lifecycle lesson</name>
  <files>src/content/course/02-module-2/02-replication-slots-lifecycle.mdx</files>
  <action>
Create comprehensive lesson on replication slot management (MOD2-02):

**Structure:**
1. What are replication slots - WAL retention mechanism
2. Slot creation - automatic by Debezium vs manual
3. Critical danger: abandoned slots cause disk exhaustion
4. Monitoring queries from pg_replication_slots
5. Cleanup procedures - when and how to drop slots safely
6. max_slot_wal_keep_size - production safety net

**Include:**
- Mermaid diagram: Slot lifecycle (create -> active -> inactive -> cleanup decision tree)
- Complete monitoring query from RESEARCH.md (slot_name, lag_bytes, lag_pretty, wal_status)
- Warning callout box: "active=false does NOT mean safe to delete"
- SQL: pg_drop_replication_slot() with safety checks
- Prometheus/Grafana alert example for abandoned slots (>1GB lag, inactive)

**Critical teaching points (from RESEARCH.md pitfalls):**
- Slots prevent WAL deletion INDEFINITELY until consumed or dropped
- wal_status='lost' means connector has fallen too far behind
- Document which connector owns which slot (operational runbook)

**Style:**
- Russian explanatory text, English SQL/config
- Frontmatter: title, description, order: 2, difficulty: intermediate, duration: 30min, topics: [replication-slots, wal-management, monitoring, pg_replication_slots]
  </action>
  <verify>
- File exists at src/content/course/02-module-2/02-replication-slots-lifecycle.mdx
- `npm run build` passes without errors
- File contains pg_replication_slots monitoring query
- File has 180+ lines
- File mentions max_slot_wal_keep_size
  </verify>
  <done>Students can monitor replication slots with pg_replication_slots, identify abandoned slots, understand disk exhaustion risk, and know safe cleanup procedures</done>
</task>

<task type="auto">
  <name>Task 3: Create WAL Configuration Tuning lesson</name>
  <files>src/content/course/02-module-2/03-wal-configuration-tuning.mdx</files>
  <action>
Create comprehensive lesson on WAL configuration for CDC (MOD2-03):

**Structure:**
1. wal_level setting hierarchy (minimal < replica < logical)
2. Performance impact of wal_level=logical (5-15% increase baseline)
3. Required parameters: max_wal_senders, max_replication_slots
4. Safety parameter: max_slot_wal_keep_size (MANDATORY for production)
5. Baseline measurement before enabling logical replication
6. Monitoring WAL generation rate and disk usage

**Include:**
- Configuration block: Full postgresql.conf CDC settings with comments
- Mermaid diagram: WAL volume comparison (INSERT-heavy vs UPDATE-heavy workloads)
- SQL: Baseline WAL measurement query (pg_current_wal_lsn, pg_wal_lsn_diff)
- SQL: WAL disk usage monitoring (pg_ls_waldir)
- SQL: High-modification tables identification (pg_stat_user_tables)
- Performance table: REPLICA IDENTITY DEFAULT vs FULL overhead

**Critical teaching points (from RESEARCH.md):**
- REPLICA IDENTITY FULL causes significant overhead (full row logged)
- Use DEFAULT unless full row history needed
- Capacity planning: ensure disk I/O handles increased write rate

**Style:**
- Russian explanatory text, English configuration/SQL
- Frontmatter: title, description, order: 3, difficulty: intermediate, duration: 25min, topics: [wal-configuration, performance-tuning, postgresql-config]
  </action>
  <verify>
- File exists at src/content/course/02-module-2/03-wal-configuration-tuning.mdx
- `npm run build` passes without errors
- File contains wal_level=logical configuration
- File has 150+ lines
- File mentions performance impact percentages
  </verify>
  <done>Students can configure PostgreSQL WAL for CDC, understand performance implications, measure baseline WAL rate, and set appropriate safety limits</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Directory exists: src/content/course/02-module-2/
2. Three lesson files exist with correct naming (01-, 02-, 03-)
3. `npm run build` passes without errors
4. Each file has proper frontmatter with order, difficulty, duration
5. Mermaid diagrams render correctly (verify import path)
6. Content follows established pattern from Module 1 lessons
</verification>

<success_criteria>
- 3 MDX files created in src/content/course/02-module-2/
- Total 480+ lines across all three files
- 4+ Mermaid diagrams total
- All files pass content collection validation
- Build completes without errors
- Monitoring queries are complete and accurate (from RESEARCH.md)
</success_criteria>

<output>
After completion, create `.planning/phases/06-module-2-postgresql-aurora/06-01-SUMMARY.md`
</output>
