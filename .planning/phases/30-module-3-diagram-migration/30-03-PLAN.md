---
phase: 30-module-3-diagram-migration
plan: 03
type: execute
wave: 2
depends_on: ["30-01", "30-02"]
files_modified:
  - src/components/diagrams/module3/AuroraSnapshotDiagrams.tsx
  - src/components/diagrams/module3/MonitoringDiagrams.tsx
  - src/components/diagrams/module3/GtidFailoverDiagrams.tsx
  - src/components/diagrams/module3/IncrementalSnapshotDiagrams.tsx
autonomous: true

must_haves:
  truths:
    - "User can see Aurora snapshot strategy decision tree with interactive paths"
    - "User can see binlog lag monitoring architecture diagrams"
    - "User can see GTID failover procedure sequences (with/without GTID)"
    - "User can see incremental snapshot chunk processing diagrams"
  artifacts:
    - path: "src/components/diagrams/module3/AuroraSnapshotDiagrams.tsx"
      provides: "Aurora snapshot strategy diagrams (4 diagrams from lesson 09)"
      exports: ["SnapshotDecisionTreeDiagram", "InitialSnapshotDiagram", "SchemaOnlySnapshotDiagram", "NeverSnapshotDiagram"]
    - path: "src/components/diagrams/module3/MonitoringDiagrams.tsx"
      provides: "Binlog lag monitoring diagrams (2 diagrams from lesson 10)"
      exports: ["LagMetricsFlowDiagram", "MonitoringArchitectureDiagram"]
    - path: "src/components/diagrams/module3/GtidFailoverDiagrams.tsx"
      provides: "GTID failover procedure diagrams (7 diagrams from lesson 11)"
      exports: ["FailoverWithoutGtidSequence", "FailoverWithGtidSequence", "FailoverDecisionDiagram", "GtidSetComparisonDiagram", "ReplicaPromotionDiagram", "ConnectorReconfigurationDiagram", "FailoverTimelineDiagram"]
    - path: "src/components/diagrams/module3/IncrementalSnapshotDiagrams.tsx"
      provides: "Incremental snapshot diagrams (3 diagrams from lesson 12)"
      exports: ["IncrementalSnapshotFlowDiagram", "ChunkProcessingDiagram", "SignalTableDiagram"]
  key_links:
    - from: "src/components/diagrams/module3/GtidFailoverDiagrams.tsx"
      to: "src/components/diagrams/primitives/SequenceDiagram.tsx"
      via: "imports SequenceDiagram for failover sequences"
      pattern: "import.*SequenceDiagram.*from.*primitives"
---

<objective>
Create glass diagram components for Module 3 lessons 09-12, covering Aurora snapshots, monitoring, GTID failover, and incremental snapshots.

Purpose: Replace 16 Mermaid diagrams with interactive glass components, including sequence diagrams for failover procedures.
Output: 4 component files with 16 exported diagram functions ready for MDX integration.
</objective>

<execution_context>
@/Users/levoely/.claude/get-shit-done/workflows/execute-plan.md
@/Users/levoely/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-module-3-diagram-migration/30-RESEARCH.md

# Existing primitives to use
@src/components/diagrams/primitives/FlowNode.tsx
@src/components/diagrams/primitives/Arrow.tsx
@src/components/diagrams/primitives/DiagramContainer.tsx
@src/components/diagrams/primitives/Tooltip.tsx
@src/components/diagrams/primitives/SequenceDiagram.tsx
@src/components/diagrams/primitives/types.ts

# Module 2 patterns to follow (especially for sequence and snapshot diagrams)
@src/components/diagrams/module2/AuroraFailoverDiagrams.tsx
@src/components/diagrams/module2/SnapshotStrategyDiagrams.tsx
@src/components/diagrams/module2/IncrementalSnapshotDiagrams.tsx

# Source MDX files with Mermaid to convert
@src/content/course/03-module-3/09-aurora-snapshot-modes.mdx
@src/content/course/03-module-3/10-binlog-lag-monitoring.mdx
@src/content/course/03-module-3/11-gtid-failover-procedures.mdx
@src/content/course/03-module-3/12-incremental-snapshots.mdx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AuroraSnapshotDiagrams and MonitoringDiagrams</name>
  <files>
    src/components/diagrams/module3/AuroraSnapshotDiagrams.tsx
    src/components/diagrams/module3/MonitoringDiagrams.tsx
  </files>
  <action>
**AuroraSnapshotDiagrams.tsx** - 4 diagrams from lesson 09:

1. `SnapshotDecisionTreeDiagram`: Snapshot mode decision tree
   - Root: "New connector?" -> Yes: "Initial" / No: "Check schema"
   - Nested FlowNodes with color-coded paths (emerald=recommended, amber=caution, rose=danger)
   - Pattern from Phase 29: snapshot decision tree with nested FlowNodes

2. `InitialSnapshotDiagram`: Initial snapshot flow
   - Lock tables -> Snapshot data -> Release locks -> Stream binlog
   - Show blocking period with rose highlight
   - Tooltip: "Initial snapshot блокирует таблицы на время чтения"

3. `SchemaOnlySnapshotDiagram`: Schema-only snapshot flow
   - Read schema metadata -> Skip data -> Start streaming
   - Show fast path (no data read)
   - Tooltip: "Schema-only для восстановления с известной позиции binlog"

4. `NeverSnapshotDiagram`: No snapshot (streaming only)
   - Direct binlog streaming from position
   - Warning about data consistency
   - Tooltip: "Never snapshot требует гарантии консистентности данных"

**MonitoringDiagrams.tsx** - 2 diagrams from lesson 10:

1. `LagMetricsFlowDiagram`: Lag metrics data flow
   - Binlog position -> JMX metrics -> Prometheus -> Grafana
   - Show key metrics: MilliSecondsBehindSource, SecondsBehindSource
   - Tooltip explaining each metric's meaning

2. `MonitoringArchitectureDiagram`: Full monitoring architecture
   - Debezium connector -> JMX exporter -> Prometheus -> Grafana + Alertmanager
   - Include CloudWatch path for Aurora
   - Two-column layout for self-managed vs Aurora monitoring

Use decision tree pattern from Phase 29 SnapshotStrategyDiagrams.
  </action>
  <verify>
Files exist and TypeScript compiles without errors:
```bash
npx tsc --noEmit src/components/diagrams/module3/AuroraSnapshotDiagrams.tsx
npx tsc --noEmit src/components/diagrams/module3/MonitoringDiagrams.tsx
```
  </verify>
  <done>
AuroraSnapshotDiagrams exports 4 functions, MonitoringDiagrams exports 2 functions, all with Russian tooltips.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GtidFailoverDiagrams and IncrementalSnapshotDiagrams</name>
  <files>
    src/components/diagrams/module3/GtidFailoverDiagrams.tsx
    src/components/diagrams/module3/IncrementalSnapshotDiagrams.tsx
  </files>
  <action>
**GtidFailoverDiagrams.tsx** - 7 diagrams from lesson 11:

This is the most complex file with both flowcharts and sequence diagrams.

1. `FailoverWithoutGtidSequence`: Sequence diagram (position-based failover failure)
   - Actors: Primary, Replica, Debezium
   - Messages showing position mismatch after failover
   - Use SequenceDiagram primitive with SequenceActorDef, SequenceMessageDef
   - Tooltip: "Без GTID: позиция mysql-bin.000015:2548 бессмысленна на новом сервере"

2. `FailoverWithGtidSequence`: Sequence diagram (GTID failover success)
   - Actors: Primary, Replica, Debezium
   - Messages showing GTID continuity after failover
   - Tooltip: "С GTID: Debezium продолжает с той же позиции на любом сервере"

3. `FailoverDecisionDiagram`: Decision tree for failover handling
   - GTID enabled? -> Yes: auto-recovery / No: manual intervention
   - Color-coded paths

4. `GtidSetComparisonDiagram`: GTID set before/after failover
   - Side-by-side comparison of executed GTID sets
   - Show how sets merge after promotion

5. `ReplicaPromotionDiagram`: Replica promotion flow
   - Old primary failure -> Replica detection -> Promotion -> New primary
   - Critical steps highlighted

6. `ConnectorReconfigurationDiagram`: Connector reconfiguration steps
   - Stop connector -> Update config -> Restart -> Resume streaming
   - Show database.server.name and gtid.source.includes changes

7. `FailoverTimelineDiagram`: Timeline of failover events
   - Horizontal timeline showing: Failure -> Detection -> Promotion -> Resume
   - Time estimates for each phase

Use SequenceDiagram from primitives (see AuroraFailoverDiagrams.tsx for pattern).

**IncrementalSnapshotDiagrams.tsx** - 3 diagrams from lesson 12:

1. `IncrementalSnapshotFlowDiagram`: Incremental snapshot overview
   - Signal received -> Chunk selection -> Read chunk -> Emit events -> Next chunk
   - Show non-blocking nature
   - Tooltip: "Incremental snapshot не блокирует таблицы"

2. `ChunkProcessingDiagram`: Chunk processing detail
   - Chunk boundaries (watermarks) -> Read between watermarks -> Deduplicate with binlog
   - Show interleaving with binlog events

3. `SignalTableDiagram`: Signal table structure
   - Signal table columns: id, type, data
   - INSERT trigger -> Connector reads -> Execute action
   - Tooltip explaining signal mechanism

Use patterns from Module 2 IncrementalSnapshotDiagrams.tsx.
  </action>
  <verify>
Files exist and TypeScript compiles without errors:
```bash
npx tsc --noEmit src/components/diagrams/module3/GtidFailoverDiagrams.tsx
npx tsc --noEmit src/components/diagrams/module3/IncrementalSnapshotDiagrams.tsx
```
  </verify>
  <done>
GtidFailoverDiagrams exports 7 functions, IncrementalSnapshotDiagrams exports 3 functions, all with Russian tooltips. Total 16 diagrams for lessons 09-12 complete.
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. All 4 component files exist in src/components/diagrams/module3/
2. TypeScript compilation passes for all files
3. Total of 16 exported diagram functions ready for MDX import
4. Sequence diagrams use SequenceDiagram primitive correctly
5. All diagrams have Russian tooltips with failover/monitoring explanations
</verification>

<success_criteria>
- 16 diagrams created matching research inventory for lessons 09-12
- Sequence diagrams for failover procedures implemented correctly
- Decision trees follow Phase 29 patterns
- All tooltips contain contextual Russian explanations
- Code compiles without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/30-module-3-diagram-migration/30-03-SUMMARY.md`
</output>
